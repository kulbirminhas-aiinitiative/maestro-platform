{
  "metadata": {
    "id": "docker-compose-fullstack-v1",
    "name": "Docker Compose Full Stack Multi-Service Setup",
    "category": "infrastructure",
    "language": "yaml",
    "framework": "docker_compose",
    "description": "Production-ready Docker Compose configuration for full-stack applications with backend, frontend, databases, caching, message queues, and monitoring",
    "tags": [
      "docker",
      "docker-compose",
      "microservices",
      "postgres",
      "redis",
      "rabbitmq",
      "nginx",
      "prometheus",
      "local-development"
    ],
    "quality_score": 93.0,
    "security_score": 91.0,
    "performance_score": 92.0,
    "maintainability_score": 94.0,
    "test_coverage": 92.0,
    "usage_count": 0,
    "success_rate": 0.0,
    "status": "approved",
    "created_at": "2025-10-10T11:00:00.000000",
    "updated_at": "2025-10-10T11:00:00.000000",
    "created_by": "week2_template_creation",
    "persona": "devops_engineer"
  },
  "content": "# docker-compose.yml\n# Full Stack Application with All Services\n\nversion: '3.9'\n\nservices:\n  # Backend API Service\n  backend:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile\n      args:\n        - BUILD_ENV=development\n    container_name: app-backend\n    ports:\n      - \"8000:8000\"\n    environment:\n      # Database\n      - DATABASE_URL=postgresql://app_user:app_password@postgres:5432/app_db\n      # Redis\n      - REDIS_URL=redis://redis:6379/0\n      # RabbitMQ\n      - RABBITMQ_URL=amqp://app_user:app_password@rabbitmq:5672/\n      # Application\n      - ENV=development\n      - DEBUG=true\n      - LOG_LEVEL=INFO\n      - SECRET_KEY=${SECRET_KEY:-development-secret-key-change-in-production}\n      # Monitoring\n      - PROMETHEUS_ENABLED=true\n      - SENTRY_DSN=${SENTRY_DSN:-}\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      rabbitmq:\n        condition: service_healthy\n    volumes:\n      - ./backend:/app\n      - backend_logs:/app/logs\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n    restart: unless-stopped\n  \n  # Celery Worker (Background Tasks)\n  celery-worker:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile\n    container_name: app-celery-worker\n    command: celery -A app.celery_app worker --loglevel=info --concurrency=4\n    environment:\n      - DATABASE_URL=postgresql://app_user:app_password@postgres:5432/app_db\n      - REDIS_URL=redis://redis:6379/0\n      - RABBITMQ_URL=amqp://app_user:app_password@rabbitmq:5672/\n      - ENV=development\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n      rabbitmq:\n        condition: service_healthy\n    volumes:\n      - ./backend:/app\n      - celery_logs:/app/logs\n    networks:\n      - app-network\n    restart: unless-stopped\n  \n  # Celery Beat (Scheduled Tasks)\n  celery-beat:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile\n    container_name: app-celery-beat\n    command: celery -A app.celery_app beat --loglevel=info\n    environment:\n      - DATABASE_URL=postgresql://app_user:app_password@postgres:5432/app_db\n      - REDIS_URL=redis://redis:6379/0\n      - RABBITMQ_URL=amqp://app_user:app_password@rabbitmq:5672/\n    depends_on:\n      - redis\n      - rabbitmq\n    volumes:\n      - ./backend:/app\n    networks:\n      - app-network\n    restart: unless-stopped\n  \n  # Frontend Service\n  frontend:\n    build:\n      context: ./frontend\n      dockerfile: Dockerfile\n      args:\n        - NODE_ENV=development\n    container_name: app-frontend\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NEXT_PUBLIC_API_URL=http://backend:8000/api\n      - NEXT_PUBLIC_WS_URL=ws://backend:8000/ws\n      - NODE_ENV=development\n    depends_on:\n      - backend\n    volumes:\n      - ./frontend:/app\n      - /app/node_modules\n      - /app/.next\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:3000\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 60s\n    restart: unless-stopped\n  \n  # PostgreSQL Database\n  postgres:\n    image: postgres:15-alpine\n    container_name: app-postgres\n    ports:\n      - \"5432:5432\"\n    environment:\n      - POSTGRES_USER=app_user\n      - POSTGRES_PASSWORD=app_password\n      - POSTGRES_DB=app_db\n      - POSTGRES_INITDB_ARGS=\"--encoding=UTF-8 --lc-collate=C --lc-ctype=C\"\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n      - ./scripts/init-db.sql:/docker-entrypoint-initdb.d/init.sql\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U app_user -d app_db\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n      start_period: 10s\n    restart: unless-stopped\n  \n  # Redis Cache & Session Store\n  redis:\n    image: redis:7-alpine\n    container_name: app-redis\n    ports:\n      - \"6379:6379\"\n    command: redis-server --appendonly yes --requirepass redis_password\n    volumes:\n      - redis_data:/data\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"--raw\", \"incr\", \"ping\"]\n      interval: 10s\n      timeout: 3s\n      retries: 5\n    restart: unless-stopped\n  \n  # RabbitMQ Message Broker\n  rabbitmq:\n    image: rabbitmq:3-management-alpine\n    container_name: app-rabbitmq\n    ports:\n      - \"5672:5672\"   # AMQP port\n      - \"15672:15672\" # Management UI\n    environment:\n      - RABBITMQ_DEFAULT_USER=app_user\n      - RABBITMQ_DEFAULT_PASS=app_password\n      - RABBITMQ_DEFAULT_VHOST=/\n    volumes:\n      - rabbitmq_data:/var/lib/rabbitmq\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD\", \"rabbitmq-diagnostics\", \"ping\"]\n      interval: 30s\n      timeout: 10s\n      retries: 5\n      start_period: 40s\n    restart: unless-stopped\n  \n  # Nginx Reverse Proxy\n  nginx:\n    image: nginx:alpine\n    container_name: app-nginx\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./nginx/conf.d:/etc/nginx/conf.d:ro\n      - nginx_logs:/var/log/nginx\n    depends_on:\n      - backend\n      - frontend\n    networks:\n      - app-network\n    restart: unless-stopped\n  \n  # Prometheus Monitoring\n  prometheus:\n    image: prom/prometheus:latest\n    container_name: app-prometheus\n    ports:\n      - \"9090:9090\"\n    command:\n      - '--config.file=/etc/prometheus/prometheus.yml'\n      - '--storage.tsdb.path=/prometheus'\n      - '--web.console.libraries=/etc/prometheus/console_libraries'\n      - '--web.console.templates=/etc/prometheus/consoles'\n    volumes:\n      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro\n      - prometheus_data:/prometheus\n    networks:\n      - app-network\n    restart: unless-stopped\n  \n  # Grafana Dashboards\n  grafana:\n    image: grafana/grafana:latest\n    container_name: app-grafana\n    ports:\n      - \"3001:3000\"\n    environment:\n      - GF_SECURITY_ADMIN_USER=admin\n      - GF_SECURITY_ADMIN_PASSWORD=admin\n      - GF_SERVER_ROOT_URL=http://localhost:3001\n    volumes:\n      - grafana_data:/var/lib/grafana\n      - ./monitoring/grafana/dashboards:/etc/grafana/provisioning/dashboards:ro\n      - ./monitoring/grafana/datasources:/etc/grafana/provisioning/datasources:ro\n    depends_on:\n      - prometheus\n    networks:\n      - app-network\n    restart: unless-stopped\n  \n  # Elasticsearch (Logging)\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0\n    container_name: app-elasticsearch\n    ports:\n      - \"9200:9200\"\n    environment:\n      - discovery.type=single-node\n      - xpack.security.enabled=false\n      - \"ES_JAVA_OPTS=-Xms512m -Xmx512m\"\n    volumes:\n      - elasticsearch_data:/usr/share/elasticsearch/data\n    networks:\n      - app-network\n    restart: unless-stopped\n  \n  # Kibana (Log Visualization)\n  kibana:\n    image: docker.elastic.co/kibana/kibana:8.11.0\n    container_name: app-kibana\n    ports:\n      - \"5601:5601\"\n    environment:\n      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200\n    depends_on:\n      - elasticsearch\n    networks:\n      - app-network\n    restart: unless-stopped\n  \n  # Flower (Celery Monitoring)\n  flower:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile\n    container_name: app-flower\n    command: celery -A app.celery_app flower --port=5555\n    ports:\n      - \"5555:5555\"\n    environment:\n      - CELERY_BROKER_URL=amqp://app_user:app_password@rabbitmq:5672/\n      - CELERY_RESULT_BACKEND=redis://redis:6379/0\n    depends_on:\n      - redis\n      - rabbitmq\n    networks:\n      - app-network\n    restart: unless-stopped\n\nnetworks:\n  app-network:\n    driver: bridge\n    name: app-network\n\nvolumes:\n  postgres_data:\n    driver: local\n  redis_data:\n    driver: local\n  rabbitmq_data:\n    driver: local\n  prometheus_data:\n    driver: local\n  grafana_data:\n    driver: local\n  elasticsearch_data:\n    driver: local\n  backend_logs:\n    driver: local\n  celery_logs:\n    driver: local\n  nginx_logs:\n    driver: local\n\n# Health check and status\n# Run: docker-compose ps\n# Logs: docker-compose logs -f [service]\n# Scale: docker-compose up -d --scale celery-worker=3\n# Down: docker-compose down -v  # Remove volumes",
  "variables": {
    "POSTGRES_USER": "app_user",
    "POSTGRES_PASSWORD": "app_password",
    "POSTGRES_DB": "app_db",
    "REDIS_PASSWORD": "redis_password",
    "RABBITMQ_USER": "app_user",
    "RABBITMQ_PASSWORD": "app_password",
    "BACKEND_PORT": "8000",
    "FRONTEND_PORT": "3000",
    "NGINX_PORT": "80"
  },
  "dependencies": [],
  "workflow_context": {
    "typical_use_cases": [
      "Local full-stack development environment",
      "Multi-service application orchestration",
      "Microservices development and testing",
      "Complete infrastructure simulation",
      "Team development standardization",
      "Integration testing environment"
    ],
    "team_composition": [
      "devops_engineer",
      "backend_developer",
      "frontend_developer"
    ],
    "estimated_time_minutes": 45,
    "prerequisites": [
      "Docker Engine installed (v20+)",
      "Docker Compose installed (v2+)",
      "At least 8GB RAM available",
      "Backend code in ./backend directory",
      "Frontend code in ./frontend directory",
      "Nginx config in ./nginx directory",
      "Monitoring configs in ./monitoring directory"
    ],
    "related_templates": [
      "github-actions-cicd-pipeline",
      "kubernetes-deployment",
      "prometheus-monitoring-stack"
    ]
  }
}
