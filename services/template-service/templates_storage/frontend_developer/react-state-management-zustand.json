{
  "metadata": {
    "id": "react-zustand-state-v1",
    "name": "React State Management with Zustand",
    "category": "state-management",
    "language": "typescript",
    "framework": "react",
    "description": "Production-ready global state management with Zustand, middleware, persistence, devtools, and TypeScript",
    "tags": ["react", "zustand", "state-management", "typescript", "persistence", "devtools"],
    "quality_score": 90.0,
    "security_score": 84.0,
    "performance_score": 94.0,
    "maintainability_score": 92.0,
    "test_coverage": 88.0,
    "usage_count": 0,
    "success_rate": 0.0,
    "status": "approved",
    "created_at": "2025-10-04T20:00:00.000000",
    "updated_at": "2025-10-04T20:00:00.000000",
    "created_by": "template_enhancement_phase1",
    "persona": "frontend_developer"
  },
  "content": "import { create } from 'zustand';\nimport { devtools, persist, subscribeWithSelector } from 'zustand/middleware';\nimport { immer } from 'zustand/middleware/immer';\n\n// Types\ninterface User {\n  id: string;\n  email: string;\n  name: string;\n  role: 'admin' | 'user';\n}\n\ninterface AuthState {\n  user: User | null;\n  token: string | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  error: string | null;\n}\n\ninterface AuthActions {\n  login: (email: string, password: string) => Promise<void>;\n  logout: () => void;\n  refreshToken: () => Promise<void>;\n  setUser: (user: User) => void;\n  clearError: () => void;\n}\n\ntype AuthStore = AuthState & AuthActions;\n\n// Auth Store\nexport const useAuthStore = create<AuthStore>()(  \n  devtools(\n    persist(\n      subscribeWithSelector(\n        immer((set, get) => ({\n          // Initial state\n          user: null,\n          token: null,\n          isAuthenticated: false,\n          isLoading: false,\n          error: null,\n          \n          // Actions\n          login: async (email: string, password: string) => {\n            set({ isLoading: true, error: null });\n            \n            try {\n              const response = await fetch('/api/auth/login', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ email, password }),\n              });\n              \n              if (!response.ok) throw new Error('Login failed');\n              \n              const data = await response.json();\n              \n              set({\n                user: data.user,\n                token: data.token,\n                isAuthenticated: true,\n                isLoading: false,\n              });\n            } catch (error) {\n              set({\n                error: (error as Error).message,\n                isLoading: false,\n              });\n            }\n          },\n          \n          logout: () => {\n            set({\n              user: null,\n              token: null,\n              isAuthenticated: false,\n            });\n          },\n          \n          refreshToken: async () => {\n            const token = get().token;\n            if (!token) return;\n            \n            try {\n              const response = await fetch('/api/auth/refresh', {\n                headers: { Authorization: `Bearer ${token}` },\n              });\n              \n              if (!response.ok) throw new Error('Refresh failed');\n              \n              const data = await response.json();\n              set({ token: data.token });\n            } catch (error) {\n              set({ error: (error as Error).message });\n            }\n          },\n          \n          setUser: (user: User) => {\n            set({ user });\n          },\n          \n          clearError: () => {\n            set({ error: null });\n          },\n        }))\n      ),\n      {\n        name: 'auth-storage',\n        partialize: (state) => ({\n          user: state.user,\n          token: state.token,\n          isAuthenticated: state.isAuthenticated,\n        }),\n      }\n    ),\n    { name: 'AuthStore' }\n  )\n);\n\n// Cart Store with Immer\ninterface CartItem {\n  id: string;\n  name: string;\n  price: number;\n  quantity: number;\n}\n\ninterface CartStore {\n  items: CartItem[];\n  total: number;\n  addItem: (item: Omit<CartItem, 'quantity'>) => void;\n  removeItem: (id: string) => void;\n  updateQuantity: (id: string, quantity: number) => void;\n  clearCart: () => void;\n}\n\nexport const useCartStore = create<CartStore>()(  \n  devtools(\n    persist(\n      immer((set) => ({\n        items: [],\n        total: 0,\n        \n        addItem: (item) => {\n          set((state) => {\n            const existingItem = state.items.find((i) => i.id === item.id);\n            \n            if (existingItem) {\n              existingItem.quantity += 1;\n            } else {\n              state.items.push({ ...item, quantity: 1 });\n            }\n            \n            state.total = state.items.reduce(\n              (sum, i) => sum + i.price * i.quantity,\n              0\n            );\n          });\n        },\n        \n        removeItem: (id) => {\n          set((state) => {\n            state.items = state.items.filter((item) => item.id !== id);\n            state.total = state.items.reduce(\n              (sum, i) => sum + i.price * i.quantity,\n              0\n            );\n          });\n        },\n        \n        updateQuantity: (id, quantity) => {\n          set((state) => {\n            const item = state.items.find((i) => i.id === id);\n            if (item) {\n              item.quantity = quantity;\n              state.total = state.items.reduce(\n                (sum, i) => sum + i.price * i.quantity,\n                0\n              );\n            }\n          });\n        },\n        \n        clearCart: () => {\n          set({ items: [], total: 0 });\n        },\n      })),\n      { name: 'cart-storage' }\n    ),\n    { name: 'CartStore' }\n  )\n);\n\n// UI Store\ninterface UIStore {\n  theme: 'light' | 'dark';\n  sidebarOpen: boolean;\n  notifications: Array<{ id: string; message: string; type: 'success' | 'error' | 'info' }>;\n  toggleTheme: () => void;\n  toggleSidebar: () => void;\n  addNotification: (message: string, type: 'success' | 'error' | 'info') => void;\n  removeNotification: (id: string) => void;\n}\n\nexport const useUIStore = create<UIStore>()(  \n  persist(\n    (set) => ({\n      theme: 'light',\n      sidebarOpen: true,\n      notifications: [],\n      \n      toggleTheme: () => {\n        set((state) => ({ theme: state.theme === 'light' ? 'dark' : 'light' }));\n      },\n      \n      toggleSidebar: () => {\n        set((state) => ({ sidebarOpen: !state.sidebarOpen }));\n      },\n      \n      addNotification: (message, type) => {\n        const id = Date.now().toString();\n        set((state) => ({\n          notifications: [...state.notifications, { id, message, type }],\n        }));\n        \n        setTimeout(() => {\n          set((state) => ({\n            notifications: state.notifications.filter((n) => n.id !== id),\n          }));\n        }, 5000);\n      },\n      \n      removeNotification: (id) => {\n        set((state) => ({\n          notifications: state.notifications.filter((n) => n.id !== id),\n        }));\n      },\n    }),\n    { name: 'ui-storage', partialize: (state) => ({ theme: state.theme }) }\n  )\n);\n\n// Selectors\nexport const selectUser = (state: AuthStore) => state.user;\nexport const selectIsAuthenticated = (state: AuthStore) => state.isAuthenticated;\nexport const selectCartTotal = (state: CartStore) => state.total;\nexport const selectCartItemCount = (state: CartStore) =>\n  state.items.reduce((sum, item) => sum + item.quantity, 0);\n\n// Subscriptions (side effects)\nuseAuthStore.subscribe(\n  (state) => state.token,\n  (token) => {\n    if (token) {\n      // Set up token refresh interval\n      const interval = setInterval(() => {\n        useAuthStore.getState().refreshToken();\n      }, 14 * 60 * 1000); // 14 minutes\n      \n      return () => clearInterval(interval);\n    }\n  }\n);\n\n// Usage in components\nexport function LoginForm() {\n  const { login, isLoading, error } = useAuthStore();\n  const [email, setEmail] = React.useState('');\n  const [password, setPassword] = React.useState('');\n  \n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    await login(email, password);\n  };\n  \n  return (\n    <form onSubmit={handleSubmit}>\n      <input value={email} onChange={(e) => setEmail(e.target.value)} />\n      <input type=\"password\" value={password} onChange={(e) => setPassword(e.target.value)} />\n      <button type=\"submit\" disabled={isLoading}>\n        {isLoading ? 'Loading...' : 'Login'}\n      </button>\n      {error && <p>{error}</p>}\n    </form>\n  );\n}\n\nexport function Cart() {\n  const items = useCartStore((state) => state.items);\n  const total = useCartStore(selectCartTotal);\n  const removeItem = useCartStore((state) => state.removeItem);\n  \n  return (\n    <div>\n      {items.map((item) => (\n        <div key={item.id}>\n          <span>{item.name} - ${item.price} x {item.quantity}</span>\n          <button onClick={() => removeItem(item.id)}>Remove</button>\n        </div>\n      ))}\n      <p>Total: ${total.toFixed(2)}</p>\n    </div>\n  );\n}\n\n// Testing utilities\nexport const resetAllStores = () => {\n  useAuthStore.getState().logout();\n  useCartStore.getState().clearCart();\n};\n\nexport const mockAuthState = (user: User, token: string) => {\n  useAuthStore.setState({\n    user,\n    token,\n    isAuthenticated: true,\n    isLoading: false,\n    error: null,\n  });\n};",
  "variables": {},
  "dependencies": [
    "zustand@^4.4.7",
    "immer@^10.0.3"
  ],
  "workflow_context": {
    "typical_use_cases": [
      "Global state management in React",
      "Shopping cart implementation",
      "Authentication state",
      "UI preferences (theme, sidebar)",
      "Real-time notifications"
    ],
    "team_composition": ["frontend_developer"],
    "estimated_time_minutes": 40,
    "prerequisites": [
      "React 18+",
      "TypeScript",
      "Understanding of state management",
      "Basic Zustand knowledge"
    ],
    "related_templates": [
      "react-context-api",
      "redux-toolkit-patterns",
      "jotai-atoms"
    ]
  }
}
