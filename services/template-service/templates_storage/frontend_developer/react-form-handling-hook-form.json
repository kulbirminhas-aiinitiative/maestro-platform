{
  "metadata": {
    "id": "react-form-hook-form-v1",
    "name": "React Form Handling with react-hook-form & Zod",
    "category": "forms",
    "language": "typescript",
    "framework": "react",
    "description": "Production-ready form handling with react-hook-form, Zod validation, dynamic fields, conditional validation, and optimized performance",
    "tags": [
      "react",
      "forms",
      "validation",
      "react-hook-form",
      "zod",
      "typescript"
    ],
    "quality_score": 90.0,
    "security_score": 85.0,
    "performance_score": 92.0,
    "maintainability_score": 89.0,
    "test_coverage": 85.0,
    "usage_count": 0,
    "success_rate": 0.0,
    "status": "approved",
    "created_at": "2025-10-04T20:00:00.000000",
    "updated_at": "2025-10-04T20:00:00.000000",
    "created_by": "template_enhancement_phase1",
    "persona": "frontend_developer"
  },
  "content": "import React from 'react';\nimport { useForm, useFieldArray, Controller } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { useMutation } from '@tanstack/react-query';\nimport { toast } from 'react-hot-toast';\n\n// Zod validation schema\nconst userSchema = z.object({\n  firstName: z.string().min(2, 'First name must be at least 2 characters'),\n  lastName: z.string().min(2, 'Last name must be at least 2 characters'),\n  email: z.string().email('Invalid email address'),\n  age: z.number().min(18, 'Must be at least 18 years old').max(120),\n  phone: z.string().regex(/^\\+?[1-9]\\d{1,14}$/, 'Invalid phone number'),\n  role: z.enum(['user', 'admin', 'moderator']),\n  acceptTerms: z.boolean().refine((val) => val === true, {\n    message: 'You must accept the terms and conditions',\n  }),\n  addresses: z.array(\n    z.object({\n      street: z.string().min(1, 'Street is required'),\n      city: z.string().min(1, 'City is required'),\n      zipCode: z.string().regex(/^\\d{5}(-\\d{4})?$/, 'Invalid ZIP code'),\n      isPrimary: z.boolean(),\n    })\n  ).min(1, 'At least one address is required'),\n  preferences: z.object({\n    newsletter: z.boolean(),\n    notifications: z.boolean(),\n  }),\n}).refine(\n  (data) => {\n    // Ensure at least one address is primary\n    return data.addresses.some((addr) => addr.isPrimary);\n  },\n  {\n    message: 'At least one address must be marked as primary',\n    path: ['addresses'],\n  }\n);\n\ntype UserFormData = z.infer<typeof userSchema>;\n\ninterface UserFormProps {\n  initialData?: Partial<UserFormData>;\n  onSubmit: (data: UserFormData) => Promise<void>;\n}\n\nexport const UserForm: React.FC<UserFormProps> = ({ initialData, onSubmit }) => {\n  const {\n    register,\n    handleSubmit,\n    control,\n    watch,\n    reset,\n    formState: { errors, isSubmitting, isDirty, isValid },\n  } = useForm<UserFormData>({\n    resolver: zodResolver(userSchema),\n    defaultValues: initialData || {\n      firstName: '',\n      lastName: '',\n      email: '',\n      age: 18,\n      phone: '',\n      role: 'user',\n      acceptTerms: false,\n      addresses: [{ street: '', city: '', zipCode: '', isPrimary: true }],\n      preferences: { newsletter: false, notifications: true },\n    },\n    mode: 'onChange', // Validate on change for better UX\n  });\n\n  // useFieldArray for dynamic address fields\n  const { fields, append, remove } = useFieldArray({\n    control,\n    name: 'addresses',\n  });\n\n  // Watch specific fields for conditional rendering\n  const role = watch('role');\n  const acceptTerms = watch('acceptTerms');\n\n  // Mutation with React Query\n  const mutation = useMutation({\n    mutationFn: onSubmit,\n    onSuccess: () => {\n      toast.success('User saved successfully!');\n      reset();\n    },\n    onError: (error: Error) => {\n      toast.error(`Error: ${error.message}`);\n    },\n  });\n\n  const handleFormSubmit = async (data: UserFormData) => {\n    try {\n      await mutation.mutateAsync(data);\n    } catch (error) {\n      console.error('Form submission error:', error);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit(handleFormSubmit)} className=\"max-w-2xl mx-auto p-6 space-y-6\">\n      {/* Basic Information */}\n      <div className=\"space-y-4\">\n        <h2 className=\"text-2xl font-bold\">User Information</h2>\n        \n        {/* First Name */}\n        <div>\n          <label htmlFor=\"firstName\" className=\"block text-sm font-medium text-gray-700\">\n            First Name *\n          </label>\n          <input\n            {...register('firstName')}\n            type=\"text\"\n            id=\"firstName\"\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n          {errors.firstName && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.firstName.message}</p>\n          )}\n        </div>\n\n        {/* Last Name */}\n        <div>\n          <label htmlFor=\"lastName\" className=\"block text-sm font-medium text-gray-700\">\n            Last Name *\n          </label>\n          <input\n            {...register('lastName')}\n            type=\"text\"\n            id=\"lastName\"\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n          {errors.lastName && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.lastName.message}</p>\n          )}\n        </div>\n\n        {/* Email */}\n        <div>\n          <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700\">\n            Email *\n          </label>\n          <input\n            {...register('email')}\n            type=\"email\"\n            id=\"email\"\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n          {errors.email && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.email.message}</p>\n          )}\n        </div>\n\n        {/* Age */}\n        <div>\n          <label htmlFor=\"age\" className=\"block text-sm font-medium text-gray-700\">\n            Age *\n          </label>\n          <input\n            {...register('age', { valueAsNumber: true })}\n            type=\"number\"\n            id=\"age\"\n            min=\"18\"\n            max=\"120\"\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n          {errors.age && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.age.message}</p>\n          )}\n        </div>\n\n        {/* Phone */}\n        <div>\n          <label htmlFor=\"phone\" className=\"block text-sm font-medium text-gray-700\">\n            Phone *\n          </label>\n          <input\n            {...register('phone')}\n            type=\"tel\"\n            id=\"phone\"\n            placeholder=\"+1234567890\"\n            className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          />\n          {errors.phone && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.phone.message}</p>\n          )}\n        </div>\n\n        {/* Role - Controller for custom component */}\n        <div>\n          <label htmlFor=\"role\" className=\"block text-sm font-medium text-gray-700\">\n            Role *\n          </label>\n          <Controller\n            name=\"role\"\n            control={control}\n            render={({ field }) => (\n              <select\n                {...field}\n                className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n              >\n                <option value=\"user\">User</option>\n                <option value=\"moderator\">Moderator</option>\n                <option value=\"admin\">Admin</option>\n              </select>\n            )}\n          />\n          {errors.role && (\n            <p className=\"mt-1 text-sm text-red-600\">{errors.role.message}</p>\n          )}\n        </div>\n\n        {/* Admin-specific fields (conditional) */}\n        {role === 'admin' && (\n          <div className=\"p-4 bg-yellow-50 rounded-md\">\n            <p className=\"text-sm text-yellow-800\">\n              Admin users have full system access. Please review carefully.\n            </p>\n          </div>\n        )}\n      </div>\n\n      {/* Dynamic Addresses Array */}\n      <div className=\"space-y-4\">\n        <h3 className=\"text-xl font-semibold\">Addresses</h3>\n        {fields.map((field, index) => (\n          <div key={field.id} className=\"p-4 border rounded-md space-y-3\">\n            <div className=\"flex justify-between items-center\">\n              <h4 className=\"font-medium\">Address {index + 1}</h4>\n              {fields.length > 1 && (\n                <button\n                  type=\"button\"\n                  onClick={() => remove(index)}\n                  className=\"text-red-600 hover:text-red-800\"\n                >\n                  Remove\n                </button>\n              )}\n            </div>\n\n            <div>\n              <input\n                {...register(`addresses.${index}.street`)}\n                placeholder=\"Street\"\n                className=\"block w-full rounded-md border-gray-300\"\n              />\n              {errors.addresses?.[index]?.street && (\n                <p className=\"text-sm text-red-600\">\n                  {errors.addresses[index]?.street?.message}\n                </p>\n              )}\n            </div>\n\n            <div>\n              <input\n                {...register(`addresses.${index}.city`)}\n                placeholder=\"City\"\n                className=\"block w-full rounded-md border-gray-300\"\n              />\n              {errors.addresses?.[index]?.city && (\n                <p className=\"text-sm text-red-600\">\n                  {errors.addresses[index]?.city?.message}\n                </p>\n              )}\n            </div>\n\n            <div>\n              <input\n                {...register(`addresses.${index}.zipCode`)}\n                placeholder=\"ZIP Code\"\n                className=\"block w-full rounded-md border-gray-300\"\n              />\n              {errors.addresses?.[index]?.zipCode && (\n                <p className=\"text-sm text-red-600\">\n                  {errors.addresses[index]?.zipCode?.message}\n                </p>\n              )}\n            </div>\n\n            <label className=\"flex items-center\">\n              <input\n                {...register(`addresses.${index}.isPrimary`)}\n                type=\"checkbox\"\n                className=\"rounded border-gray-300\"\n              />\n              <span className=\"ml-2 text-sm\">Primary Address</span>\n            </label>\n          </div>\n        ))}\n\n        {errors.addresses?.root && (\n          <p className=\"text-sm text-red-600\">{errors.addresses.root.message}</p>\n        )}\n\n        <button\n          type=\"button\"\n          onClick={() => append({ street: '', city: '', zipCode: '', isPrimary: false })}\n          className=\"px-4 py-2 border border-blue-500 text-blue-500 rounded hover:bg-blue-50\"\n        >\n          + Add Address\n        </button>\n      </div>\n\n      {/* Preferences */}\n      <div className=\"space-y-3\">\n        <h3 className=\"text-xl font-semibold\">Preferences</h3>\n        <label className=\"flex items-center\">\n          <input\n            {...register('preferences.newsletter')}\n            type=\"checkbox\"\n            className=\"rounded border-gray-300\"\n          />\n          <span className=\"ml-2\">Subscribe to newsletter</span>\n        </label>\n        <label className=\"flex items-center\">\n          <input\n            {...register('preferences.notifications')}\n            type=\"checkbox\"\n            className=\"rounded border-gray-300\"\n          />\n          <span className=\"ml-2\">Enable notifications</span>\n        </label>\n      </div>\n\n      {/* Terms */}\n      <div>\n        <label className=\"flex items-center\">\n          <input\n            {...register('acceptTerms')}\n            type=\"checkbox\"\n            className=\"rounded border-gray-300\"\n          />\n          <span className=\"ml-2\">I accept the terms and conditions *</span>\n        </label>\n        {errors.acceptTerms && (\n          <p className=\"mt-1 text-sm text-red-600\">{errors.acceptTerms.message}</p>\n        )}\n      </div>\n\n      {/* Submit */}\n      <div className=\"flex gap-4\">\n        <button\n          type=\"submit\"\n          disabled={!isValid || isSubmitting}\n          className=\"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          {isSubmitting ? 'Submitting...' : 'Submit'}\n        </button>\n        <button\n          type=\"button\"\n          onClick={() => reset()}\n          disabled={!isDirty}\n          className=\"px-6 py-2 border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50\"\n        >\n          Reset\n        </button>\n      </div>\n    </form>\n  );\n};",
  "variables": {},
  "dependencies": [
    "react@^18.2.0",
    "react-hook-form@^7.49.0",
    "@hookform/resolvers@^3.3.3",
    "zod@^3.22.4",
    "@tanstack/react-query@^5.17.0",
    "react-hot-toast@^2.4.1"
  ],
  "workflow_context": {
    "typical_use_cases": [
      "Complex form handling with validation",
      "Dynamic form fields (arrays, nested objects)",
      "Conditional validation",
      "Form submission with API integration",
      "Multi-step forms"
    ],
    "team_composition": [
      "frontend_developer",
      "ui_ux_designer"
    ],
    "estimated_time_minutes": 50,
    "prerequisites": [
      "React 18+",
      "TypeScript setup",
      "Tailwind CSS (optional for styling)",
      "Understanding of form validation"
    ],
    "related_templates": [
      "react-custom-hooks",
      "zod-validation-patterns",
      "react-query-integration"
    ]
  }
}
