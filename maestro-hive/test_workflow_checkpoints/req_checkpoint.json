{
  "checkpoint_metadata": {
    "version": "1.0",
    "created_at": "2025-10-12T13:01:25.849266",
    "workflow_id": "workflow-20251012-130125",
    "phase_completed": "requirements",
    "awaiting_phase": "design",
    "checkpoint_type": "phase_boundary",
    "awaiting_human_review": false,
    "human_edits_applied": false,
    "quality_gate_passed": false,
    "quality_score": 0.0
  },
  "workflow_context": {
    "workflow_id": "workflow-20251012-130125",
    "workflow_type": "sdlc",
    "phase_results": {
      "requirements": {
        "phase_name": "requirements",
        "status": "completed",
        "outputs": {
          "phase": "requirements",
          "artifact_paths": [
            "test_workflow_output/requirements_document.md",
            "test_workflow_output/user_stories.md",
            "test_workflow_output/acceptance_criteria.md",
            "test_workflow_output/requirements_document.md",
            "test_workflow_output/user_stories.md",
            "test_workflow_output/acceptance_criteria.md",
            "test_workflow_output/database_schema.md",
            "test_workflow_output/api_endpoints.md",
            "test_workflow_output/backend_architecture.md",
            "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
            "test_workflow_output/requirements_document.md",
            "test_workflow_output/user_stories.md",
            "test_workflow_output/acceptance_criteria.md",
            "test_workflow_output/database_schema.md",
            "test_workflow_output/api_endpoints.md",
            "test_workflow_output/backend_architecture.md",
            "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
            "test_workflow_output/database_schema.sql",
            "test_workflow_output/data_model.md",
            "test_workflow_output/query_optimization.md",
            "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
            "test_workflow_output/README.md",
            "test_workflow_output/migration_scripts/001_initial_schema.sql",
            "test_workflow_output/migration_scripts/rollback_001.sql",
            "test_workflow_output/migration_scripts/README.md",
            "test_workflow_output/migration_scripts/seed_data.sql",
            "test_workflow_output/requirements_document.md",
            "test_workflow_output/user_stories.md",
            "test_workflow_output/acceptance_criteria.md",
            "test_workflow_output/database_schema.md",
            "test_workflow_output/api_endpoints.md",
            "test_workflow_output/backend_architecture.md",
            "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
            "test_workflow_output/database_schema.sql",
            "test_workflow_output/data_model.md",
            "test_workflow_output/query_optimization.md",
            "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
            "test_workflow_output/README.md",
            "test_workflow_output/api_documentation.md",
            "test_workflow_output/user_guide.md",
            "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
            "test_workflow_output/migration_scripts/001_initial_schema.sql",
            "test_workflow_output/migration_scripts/rollback_001.sql",
            "test_workflow_output/migration_scripts/README.md",
            "test_workflow_output/migration_scripts/seed_data.sql",
            "test_workflow_output/requirements_document.md",
            "test_workflow_output/user_stories.md",
            "test_workflow_output/acceptance_criteria.md",
            "test_workflow_output/database_schema.md",
            "test_workflow_output/api_endpoints.md",
            "test_workflow_output/backend_architecture.md",
            "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
            "test_workflow_output/database_schema.sql",
            "test_workflow_output/data_model.md",
            "test_workflow_output/query_optimization.md",
            "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
            "test_workflow_output/README.md",
            "test_workflow_output/api_documentation.md",
            "test_workflow_output/user_guide.md",
            "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
            "test_workflow_output/test_plan.md",
            "test_workflow_output/test_cases.md",
            "test_workflow_output/bug_reports.md",
            "test_workflow_output/test_results.md",
            "test_workflow_output/migration_scripts/001_initial_schema.sql",
            "test_workflow_output/migration_scripts/rollback_001.sql",
            "test_workflow_output/migration_scripts/README.md",
            "test_workflow_output/migration_scripts/seed_data.sql",
            "test_workflow_output/requirements_document.md",
            "test_workflow_output/user_stories.md",
            "test_workflow_output/acceptance_criteria.md",
            "test_workflow_output/database_schema.md",
            "test_workflow_output/api_endpoints.md",
            "test_workflow_output/backend_architecture.md",
            "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
            "test_workflow_output/database_schema.sql",
            "test_workflow_output/data_model.md",
            "test_workflow_output/query_optimization.md",
            "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
            "test_workflow_output/README.md",
            "test_workflow_output/api_documentation.md",
            "test_workflow_output/user_guide.md",
            "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
            "test_workflow_output/test_plan.md",
            "test_workflow_output/test_cases.md",
            "test_workflow_output/bug_reports.md",
            "test_workflow_output/test_results.md",
            "test_workflow_output/Dockerfile",
            "test_workflow_output/docker-compose.yml",
            "test_workflow_output/DEVOPS_DOCUMENTATION.md",
            "test_workflow_output/requirements.txt",
            "test_workflow_output/.dockerignore",
            "test_workflow_output/.env.example",
            "test_workflow_output/DEVOPS_README.md",
            "test_workflow_output/DEVOPS_DELIVERABLES_SUMMARY.md",
            "test_workflow_output/migration_scripts/001_initial_schema.sql",
            "test_workflow_output/migration_scripts/rollback_001.sql",
            "test_workflow_output/migration_scripts/README.md",
            "test_workflow_output/migration_scripts/seed_data.sql",
            "test_workflow_output/k8s/namespace.yaml",
            "test_workflow_output/k8s/configmap.yaml",
            "test_workflow_output/k8s/secrets.yaml",
            "test_workflow_output/k8s/postgres-deployment.yaml",
            "test_workflow_output/k8s/redis-deployment.yaml",
            "test_workflow_output/k8s/api-deployment.yaml",
            "test_workflow_output/k8s/ingress.yaml",
            "test_workflow_output/k8s/hpa.yaml",
            "test_workflow_output/k8s/network-policy.yaml",
            "test_workflow_output/.github/workflows/ci-cd.yml",
            "test_workflow_output/terraform/main.tf",
            "test_workflow_output/terraform/variables.tf",
            "test_workflow_output/terraform/outputs.tf",
            "test_workflow_output/scripts/deploy.sh",
            "test_workflow_output/scripts/rollback.sh",
            "test_workflow_output/scripts/monitor.sh",
            "test_workflow_output/scripts/backup-db.sh"
          ],
          "artifacts_content": {
            "test_workflow_output/requirements_document.md": "# Requirements Document\n## User Management REST API\n\n**Project ID:** workflow-20251012-125804\n**Phase:** Requirements Analysis\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Requirements Analyst\n\n---\n\n## 1. Executive Summary\n\nThis document outlines the functional and non-functional requirements for a user management REST API system. The API will provide standard CRUD (Create, Read, Update, Delete) operations for managing user data in a scalable and secure manner.\n\n---\n\n## 2. Project Objectives\n\nThe primary objective is to develop a RESTful API that enables:\n- Efficient user data management\n- Secure access to user information\n- Standardized integration capabilities for client applications\n- Scalable architecture for future growth\n\n---\n\n## 3. Stakeholders\n\n### 3.1 Primary Stakeholders\n- **Product Owner:** Defines business requirements and priorities\n- **Development Team:** Implements the API functionality\n- **QA Team:** Validates quality and functionality\n- **DevOps Team:** Manages deployment and infrastructure\n\n### 3.2 Secondary Stakeholders\n- **End Users:** Individuals whose data is managed by the system\n- **Client Application Developers:** Consumers of the API\n- **System Administrators:** Manage and monitor the API\n- **Security Team:** Ensures compliance and security standards\n\n---\n\n## 4. Functional Requirements\n\n### FR-1: User Creation\n**Priority:** High\n**Description:** The system shall allow creation of new user records with required and optional fields.\n\n**Required Fields:**\n- Username (unique, alphanumeric, 3-50 characters)\n- Email (valid email format, unique)\n- Password (minimum 8 characters, must include uppercase, lowercase, number, special character)\n\n**Optional Fields:**\n- First Name\n- Last Name\n- Phone Number\n- Date of Birth\n- Profile Picture URL\n- Bio/Description\n\n**Validation Rules:**\n- All required fields must be present\n- Email must be validated against RFC 5322 standard\n- Username must be unique across the system\n- Password must be hashed before storage (never stored in plain text)\n\n---\n\n### FR-2: User Retrieval\n**Priority:** High\n**Description:** The system shall provide endpoints to retrieve user information.\n\n**Capabilities:**\n- Retrieve single user by unique identifier (user_id)\n- Retrieve single user by username\n- Retrieve single user by email\n- List all users with pagination support\n- Filter users by specific criteria (status, creation date, etc.)\n\n**Response Format:**\n- JSON formatted response\n- Exclude sensitive fields (password hash) from response\n- Include metadata (creation date, last update, status)\n\n---\n\n### FR-3: User Update\n**Priority:** High\n**Description:** The system shall allow modification of existing user records.\n\n**Updateable Fields:**\n- Email (must remain unique)\n- First Name\n- Last Name\n- Phone Number\n- Date of Birth\n- Profile Picture URL\n- Bio/Description\n- Password (requires old password verification)\n\n**Validation Rules:**\n- Only the user owner or admin can update records\n- Email uniqueness must be maintained\n- Password changes require additional authentication\n- Partial updates must be supported (PATCH)\n\n---\n\n### FR-4: User Deletion\n**Priority:** High\n**Description:** The system shall provide capability to remove user records.\n\n**Deletion Types:**\n- Soft Delete: Mark user as inactive/deleted but retain data\n- Hard Delete: Permanently remove user data (admin only)\n\n**Validation Rules:**\n- Only user owner or admin can delete records\n- Confirmation required for hard delete operations\n- Cascade deletion handling for related data\n- Audit log retention for compliance\n\n---\n\n### FR-5: User Authentication\n**Priority:** High\n**Description:** The system shall verify user credentials for secure access.\n\n**Capabilities:**\n- Username/email and password authentication\n- Token-based session management (JWT recommended)\n- Token refresh mechanism\n- Logout functionality\n\n---\n\n### FR-6: Data Validation\n**Priority:** High\n**Description:** All input data must be validated before processing.\n\n**Validation Requirements:**\n- Input sanitization to prevent injection attacks\n- Field type validation\n- Field length constraints\n- Format validation (email, phone, dates)\n- Business rule validation\n\n---\n\n## 5. Non-Functional Requirements\n\n### NFR-1: Performance\n- API response time: < 200ms for 95% of requests\n- Support concurrent requests: minimum 100 concurrent users\n- Database query optimization required\n- Implement caching strategy for frequently accessed data\n\n### NFR-2: Security\n- HTTPS/TLS encryption required for all endpoints\n- Authentication required for all protected endpoints\n- Authorization checks on all operations\n- Rate limiting to prevent abuse (100 requests per minute per IP)\n- SQL injection prevention\n- XSS protection\n- CORS configuration\n- Secure password hashing (bcrypt, Argon2, or PBKDF2)\n\n### NFR-3: Reliability\n- System uptime: 99.9% availability\n- Graceful error handling\n- Transaction rollback on failures\n- Data consistency guarantees\n\n### NFR-4: Scalability\n- Horizontal scaling capability\n- Database connection pooling\n- Stateless API design\n- Load balancing support\n\n### NFR-5: Maintainability\n- Clean code standards\n- Comprehensive documentation\n- API versioning strategy\n- Logging and monitoring\n- Unit test coverage: minimum 80%\n\n### NFR-6: Usability\n- RESTful design principles\n- Consistent API response format\n- Clear error messages\n- Comprehensive API documentation (Swagger/OpenAPI)\n\n---\n\n## 6. API Endpoints Specification\n\n### 6.1 User Endpoints\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| POST | /api/v1/users | Create new user | No |\n| GET | /api/v1/users | List all users (paginated) | Yes |\n| GET | /api/v1/users/{id} | Get user by ID | Yes |\n| GET | /api/v1/users/username/{username} | Get user by username | Yes |\n| PUT | /api/v1/users/{id} | Full update of user | Yes |\n| PATCH | /api/v1/users/{id} | Partial update of user | Yes |\n| DELETE | /api/v1/users/{id} | Delete user | Yes |\n\n### 6.2 Authentication Endpoints\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| POST | /api/v1/auth/login | User login | No |\n| POST | /api/v1/auth/logout | User logout | Yes |\n| POST | /api/v1/auth/refresh | Refresh auth token | Yes |\n\n---\n\n## 7. Data Model\n\n### User Entity\n\n```\nUser {\n  id: UUID (Primary Key, Auto-generated)\n  username: String (Unique, Required, 3-50 chars)\n  email: String (Unique, Required, Valid email)\n  password_hash: String (Required, Hashed)\n  first_name: String (Optional, Max 100 chars)\n  last_name: String (Optional, Max 100 chars)\n  phone_number: String (Optional, Valid phone format)\n  date_of_birth: Date (Optional)\n  profile_picture_url: String (Optional, Valid URL)\n  bio: Text (Optional, Max 500 chars)\n  status: Enum (active, inactive, suspended, deleted)\n  created_at: Timestamp (Auto-generated)\n  updated_at: Timestamp (Auto-updated)\n  last_login: Timestamp (Nullable)\n}\n```\n\n---\n\n## 8. Error Handling\n\n### Standard Error Response Format\n```json\n{\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"message\": \"Human-readable error message\",\n    \"details\": {},\n    \"timestamp\": \"ISO-8601 timestamp\"\n  }\n}\n```\n\n### HTTP Status Codes\n- 200: Success\n- 201: Created\n- 204: No Content (successful deletion)\n- 400: Bad Request (validation errors)\n- 401: Unauthorized (authentication required)\n- 403: Forbidden (insufficient permissions)\n- 404: Not Found\n- 409: Conflict (duplicate username/email)\n- 422: Unprocessable Entity (business logic error)\n- 429: Too Many Requests (rate limit exceeded)\n- 500: Internal Server Error\n- 503: Service Unavailable\n\n---\n\n## 9. Dependencies and Integrations\n\n### Technology Stack Requirements\n- RESTful API framework (Express.js, FastAPI, Spring Boot, etc.)\n- Database system (PostgreSQL, MySQL, MongoDB)\n- Authentication library (JWT)\n- Password hashing library\n- Input validation library\n- API documentation tool (Swagger/OpenAPI)\n\n### External Integrations\n- Email service (for notifications, password reset)\n- Logging and monitoring service\n- Analytics platform (optional)\n\n---\n\n## 10. Constraints and Assumptions\n\n### Constraints\n- Must comply with GDPR and data protection regulations\n- Must support API versioning from initial release\n- Must implement audit logging for compliance\n- Budget constraints may limit infrastructure choices\n\n### Assumptions\n- Users will access API through client applications\n- Database infrastructure will be provided\n- SSL/TLS certificates will be available\n- Email service integration will be available for notifications\n\n---\n\n## 11. Success Criteria\n\nThe project will be considered successful when:\n1. All CRUD operations are functional and tested\n2. Security requirements are implemented and validated\n3. API documentation is complete and accurate\n4. Performance benchmarks are met\n5. Unit test coverage exceeds 80%\n6. Integration tests pass successfully\n7. User acceptance testing is completed\n8. Production deployment is successful\n\n---\n\n## 12. Risks and Mitigation\n\n| Risk | Impact | Probability | Mitigation Strategy |\n|------|--------|-------------|---------------------|\n| Data breach | High | Medium | Implement comprehensive security measures, regular audits |\n| Performance degradation | Medium | Medium | Load testing, optimization, caching strategy |\n| Scope creep | Medium | High | Clear requirements documentation, change control process |\n| Third-party dependencies | Low | Medium | Select stable libraries, maintain fallback options |\n\n---\n\n## 13. Compliance Requirements\n\n- **GDPR:** Right to access, right to deletion, data portability\n- **Data Retention:** Define retention policies for user data\n- **Audit Logging:** Maintain logs of all data modifications\n- **Privacy:** Implement privacy by design principles\n\n---\n\n## 14. Future Enhancements (Out of Scope for MVP)\n\n- Two-factor authentication (2FA)\n- OAuth2/SSO integration\n- Advanced user roles and permissions\n- User profile verification\n- Activity history tracking\n- Bulk operations support\n- Advanced search and filtering\n- Real-time notifications\n- User groups and organizations\n\n---\n\n## Appendix A: Glossary\n\n- **CRUD:** Create, Read, Update, Delete operations\n- **REST:** Representational State Transfer\n- **JWT:** JSON Web Token\n- **API:** Application Programming Interface\n- **GDPR:** General Data Protection Regulation\n- **UUID:** Universally Unique Identifier\n- **TLS:** Transport Layer Security\n\n---\n\n## Appendix B: References\n\n- REST API Design Best Practices\n- OWASP API Security Top 10\n- GDPR Compliance Guidelines\n- HTTP/1.1 Specification (RFC 2616)\n- JSON Web Token Standard (RFC 7519)\n\n---\n\n**Document Control**\n- **Status:** Final\n- **Review Date:** 2025-10-12\n- **Next Review:** Upon project phase completion\n- **Approval Required:** Product Owner, Technical Lead\n",
            "test_workflow_output/database_schema.md": "# Database Schema Design - User Management API\n\n## Project Information\n**Workflow ID:** workflow-20251012-130125\n**Phase:** Requirements\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Backend Developer\n\n---\n\n## 1. Schema Overview\n\nThis document defines the database schema for the User Management REST API. The schema is designed for a relational database (PostgreSQL recommended) with emphasis on data integrity, performance, and security.\n\n### Design Principles\n- **Normalization:** 3NF (Third Normal Form) to minimize redundancy\n- **Performance:** Strategic indexing for common queries\n- **Security:** Encrypted sensitive data, hashed passwords\n- **Scalability:** Efficient data types and constraints\n- **Audit Trail:** Timestamp tracking for all records\n\n---\n\n## 2. Database Schema (PostgreSQL)\n\n### 2.1 Users Table\n\nThe primary table for storing user information.\n\n```sql\nCREATE TABLE users (\n    -- Primary Key\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n\n    -- Authentication & Identification\n    username VARCHAR(50) NOT NULL,\n    email VARCHAR(255) NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n\n    -- Personal Information\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    phone_number VARCHAR(20),\n    date_of_birth DATE,\n\n    -- Profile Data\n    profile_picture_url VARCHAR(500),\n    bio TEXT CHECK (length(bio) <= 500),\n\n    -- Status & Metadata\n    status VARCHAR(20) NOT NULL DEFAULT 'active',\n    is_active BOOLEAN NOT NULL DEFAULT true,\n    email_verified BOOLEAN NOT NULL DEFAULT false,\n\n    -- Timestamps\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    last_login TIMESTAMP WITH TIME ZONE,\n    deleted_at TIMESTAMP WITH TIME ZONE,\n\n    -- Constraints\n    CONSTRAINT users_username_unique UNIQUE (username),\n    CONSTRAINT users_email_unique UNIQUE (email),\n    CONSTRAINT users_status_check CHECK (status IN ('active', 'inactive', 'suspended', 'deleted')),\n    CONSTRAINT users_email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')\n);\n\n-- Indexes for performance optimization\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_status ON users(status) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_created_at ON users(created_at DESC);\nCREATE INDEX idx_users_last_name_first_name ON users(last_name, first_name) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_is_active ON users(is_active) WHERE deleted_at IS NULL;\n\n-- Trigger for updated_at timestamp\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = CURRENT_TIMESTAMP;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER users_updated_at_trigger\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- Comment on table and columns\nCOMMENT ON TABLE users IS 'Core user data table for user management API';\nCOMMENT ON COLUMN users.id IS 'Unique identifier for user (UUID v4)';\nCOMMENT ON COLUMN users.username IS 'Unique username for authentication (3-50 chars)';\nCOMMENT ON COLUMN users.email IS 'Unique email address for contact and authentication';\nCOMMENT ON COLUMN users.password_hash IS 'Bcrypt hashed password (never store plain text)';\nCOMMENT ON COLUMN users.status IS 'User account status: active, inactive, suspended, deleted';\nCOMMENT ON COLUMN users.is_active IS 'Quick flag for active/inactive users';\nCOMMENT ON COLUMN users.deleted_at IS 'Soft delete timestamp (NULL if not deleted)';\n```\n\n---\n\n### 2.2 Audit Log Table (Optional - Recommended)\n\nTrack all modifications to user records for compliance and debugging.\n\n```sql\nCREATE TABLE user_audit_log (\n    -- Primary Key\n    id BIGSERIAL PRIMARY KEY,\n\n    -- Reference\n    user_id UUID NOT NULL,\n\n    -- Audit Information\n    action VARCHAR(20) NOT NULL,\n    changed_by UUID,\n    changed_fields JSONB,\n    old_values JSONB,\n    new_values JSONB,\n\n    -- Context\n    ip_address INET,\n    user_agent TEXT,\n\n    -- Timestamp\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\n    -- Constraints\n    CONSTRAINT audit_action_check CHECK (action IN ('CREATE', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT'))\n);\n\n-- Indexes for audit queries\nCREATE INDEX idx_audit_user_id ON user_audit_log(user_id);\nCREATE INDEX idx_audit_action ON user_audit_log(action);\nCREATE INDEX idx_audit_created_at ON user_audit_log(created_at DESC);\n\nCOMMENT ON TABLE user_audit_log IS 'Audit trail for all user record modifications';\nCOMMENT ON COLUMN user_audit_log.action IS 'Type of action performed';\nCOMMENT ON COLUMN user_audit_log.changed_fields IS 'JSON array of field names that were modified';\n```\n\n---\n\n### 2.3 Session Management Table (Optional - For JWT blacklist)\n\n```sql\nCREATE TABLE user_sessions (\n    -- Primary Key\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n\n    -- Reference\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    -- Session Data\n    token_jti VARCHAR(255) NOT NULL UNIQUE,\n    refresh_token_hash VARCHAR(255),\n\n    -- Metadata\n    ip_address INET,\n    user_agent TEXT,\n\n    -- Timestamps\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    last_used_at TIMESTAMP WITH TIME ZONE,\n    revoked_at TIMESTAMP WITH TIME ZONE,\n\n    -- Constraints\n    CONSTRAINT valid_expiry CHECK (expires_at > created_at)\n);\n\n-- Indexes\nCREATE INDEX idx_sessions_user_id ON user_sessions(user_id);\nCREATE INDEX idx_sessions_token_jti ON user_sessions(token_jti) WHERE revoked_at IS NULL;\nCREATE INDEX idx_sessions_expires_at ON user_sessions(expires_at);\n\nCOMMENT ON TABLE user_sessions IS 'Active user sessions and token management';\nCOMMENT ON COLUMN user_sessions.token_jti IS 'JWT ID (jti claim) for token blacklisting';\n```\n\n---\n\n## 3. Data Dictionary\n\n### 3.1 Users Table Fields\n\n| Column | Type | Nullable | Default | Description | Validation |\n|--------|------|----------|---------|-------------|------------|\n| id | UUID | NO | gen_random_uuid() | Primary key, unique user identifier | UUID v4 format |\n| username | VARCHAR(50) | NO | - | Unique username | 3-50 chars, alphanumeric + underscore |\n| email | VARCHAR(255) | NO | - | Unique email address | Valid email format (RFC 5322) |\n| password_hash | VARCHAR(255) | NO | - | Bcrypt hashed password | Bcrypt hash (60 chars) |\n| first_name | VARCHAR(100) | YES | NULL | User's first name | 1-100 chars |\n| last_name | VARCHAR(100) | YES | NULL | User's last name | 1-100 chars |\n| phone_number | VARCHAR(20) | YES | NULL | Contact phone number | E.164 format recommended |\n| date_of_birth | DATE | YES | NULL | User's birthdate | Valid date, past only |\n| profile_picture_url | VARCHAR(500) | YES | NULL | URL to profile image | Valid URL format |\n| bio | TEXT | YES | NULL | User biography/description | Max 500 characters |\n| status | VARCHAR(20) | NO | 'active' | Account status | Enum: active, inactive, suspended, deleted |\n| is_active | BOOLEAN | NO | true | Active flag | Boolean |\n| email_verified | BOOLEAN | NO | false | Email verification status | Boolean |\n| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | Record creation time | UTC timestamp |\n| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | Last update time | UTC timestamp, auto-updated |\n| last_login | TIMESTAMP | YES | NULL | Last successful login | UTC timestamp |\n| deleted_at | TIMESTAMP | YES | NULL | Soft delete timestamp | UTC timestamp (NULL = active) |\n\n---\n\n## 4. Indexes Strategy\n\n### 4.1 Primary Indexes\n\n```sql\n-- Unique constraints (automatically create indexes)\nusers.id (PRIMARY KEY)\nusers.username (UNIQUE)\nusers.email (UNIQUE)\n```\n\n### 4.2 Performance Indexes\n\n```sql\n-- Search and filtering\nidx_users_email (Partial index for active users)\nidx_users_username (Partial index for active users)\nidx_users_status (For status-based queries)\nidx_users_is_active (For active/inactive filtering)\n\n-- Sorting and pagination\nidx_users_created_at (Descending for recent users first)\nidx_users_last_name_first_name (Composite for name searches)\n```\n\n### 4.3 Index Usage Patterns\n\n| Query Pattern | Index Used | Performance Gain |\n|---------------|-----------|------------------|\n| Login by email | idx_users_email | O(log n) vs O(n) |\n| Login by username | idx_users_username | O(log n) vs O(n) |\n| List active users | idx_users_is_active | Filtered scan |\n| Sort by created date | idx_users_created_at | Sorted access |\n| Search by name | idx_users_last_name_first_name | Composite scan |\n\n---\n\n## 5. Constraints and Business Rules\n\n### 5.1 Data Integrity Constraints\n\n```sql\n-- Uniqueness\n- username must be unique (case-insensitive recommended)\n- email must be unique (case-insensitive recommended)\n\n-- Format validation\n- email must match email regex pattern\n- status must be one of: active, inactive, suspended, deleted\n\n-- Logical constraints\n- bio max length 500 characters\n- username 3-50 characters\n- created_at <= updated_at\n```\n\n### 5.2 Application-Level Validations\n\nThese are enforced by the backend application:\n\n```python\n# Username validation\n- Pattern: ^[a-zA-Z0-9_]{3,50}$\n- Alphanumeric characters and underscore only\n- 3-50 characters length\n\n# Email validation\n- RFC 5322 compliant email format\n- Maximum 255 characters\n- Case-insensitive uniqueness check\n\n# Password requirements (before hashing)\n- Minimum 8 characters\n- At least one uppercase letter\n- At least one lowercase letter\n- At least one digit\n- At least one special character (!@#$%^&*)\n\n# Phone number validation\n- E.164 format recommended: +[country code][number]\n- Optional field, validated if provided\n\n# Date of birth validation\n- Must be a valid date\n- Must be in the past\n- User must be at least 13 years old (COPPA compliance)\n\n# Profile picture URL\n- Valid URL format (https:// preferred)\n- Maximum 500 characters\n```\n\n---\n\n## 6. Migration Scripts\n\n### 6.1 Initial Schema Creation\n\n```sql\n-- migrations/V1__create_users_table.sql\n\nBEGIN;\n\n-- Create users table\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    username VARCHAR(50) NOT NULL,\n    email VARCHAR(255) NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    phone_number VARCHAR(20),\n    date_of_birth DATE,\n    profile_picture_url VARCHAR(500),\n    bio TEXT CHECK (length(bio) <= 500),\n    status VARCHAR(20) NOT NULL DEFAULT 'active',\n    is_active BOOLEAN NOT NULL DEFAULT true,\n    email_verified BOOLEAN NOT NULL DEFAULT false,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    last_login TIMESTAMP WITH TIME ZONE,\n    deleted_at TIMESTAMP WITH TIME ZONE,\n    CONSTRAINT users_username_unique UNIQUE (username),\n    CONSTRAINT users_email_unique UNIQUE (email),\n    CONSTRAINT users_status_check CHECK (status IN ('active', 'inactive', 'suspended', 'deleted')),\n    CONSTRAINT users_email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')\n);\n\n-- Create indexes\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_status ON users(status) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_created_at ON users(created_at DESC);\nCREATE INDEX idx_users_last_name_first_name ON users(last_name, first_name) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_is_active ON users(is_active) WHERE deleted_at IS NULL;\n\n-- Create trigger function\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = CURRENT_TIMESTAMP;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Attach trigger\nCREATE TRIGGER users_updated_at_trigger\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\nCOMMIT;\n```\n\n### 6.2 Rollback Script\n\n```sql\n-- migrations/V1__create_users_table_rollback.sql\n\nBEGIN;\n\nDROP TRIGGER IF EXISTS users_updated_at_trigger ON users;\nDROP FUNCTION IF EXISTS update_updated_at_column();\nDROP TABLE IF EXISTS users CASCADE;\n\nCOMMIT;\n```\n\n---\n\n## 7. Sample Data\n\n### 7.1 Seed Data for Testing\n\n```sql\n-- Insert test users (for development environment only)\nINSERT INTO users (username, email, password_hash, first_name, last_name, status, is_active, email_verified)\nVALUES\n    ('johndoe', 'john.doe@example.com', '$2b$10$rKwYvxRpJgVmHfNMvfNcguT5l8H3VVQJkZZkQvZlHf4X3oNQvZVZK', 'John', 'Doe', 'active', true, true),\n    ('janedoe', 'jane.doe@example.com', '$2b$10$rKwYvxRpJgVmHfNMvfNcguT5l8H3VVQJkZZkQvZlHf4X3oNQvZVZK', 'Jane', 'Doe', 'active', true, true),\n    ('testuser', 'test@example.com', '$2b$10$rKwYvxRpJgVmHfNMvfNcguT5l8H3VVQJkZZkQvZlHf4X3oNQvZVZK', 'Test', 'User', 'active', true, false);\n\n-- Note: Password for all test users is 'Test@1234' (hashed with bcrypt)\n```\n\n---\n\n## 8. Database Configuration\n\n### 8.1 Recommended PostgreSQL Settings\n\n```ini\n# postgresql.conf optimizations\n\n# Connection settings\nmax_connections = 100\nshared_buffers = 256MB\neffective_cache_size = 1GB\nmaintenance_work_mem = 64MB\ncheckpoint_completion_target = 0.9\nwal_buffers = 16MB\ndefault_statistics_target = 100\nrandom_page_cost = 1.1\neffective_io_concurrency = 200\nwork_mem = 2621kB\nmin_wal_size = 1GB\nmax_wal_size = 4GB\n\n# Logging\nlog_destination = 'stderr'\nlogging_collector = on\nlog_line_prefix = '%m [%p] %u@%d '\nlog_statement = 'mod'\nlog_duration = on\nlog_min_duration_statement = 500\n\n# Security\npassword_encryption = scram-sha-256\nssl = on\n```\n\n### 8.2 Connection Pool Configuration\n\n```python\n# Application connection pool settings\nDATABASE_CONFIG = {\n    \"host\": \"localhost\",\n    \"port\": 5432,\n    \"database\": \"user_management_db\",\n    \"user\": \"app_user\",\n    \"password\": \"secure_password\",\n    \"pool_size\": 20,\n    \"max_overflow\": 10,\n    \"pool_timeout\": 30,\n    \"pool_recycle\": 3600,\n    \"echo\": False\n}\n```\n\n---\n\n## 9. Backup and Recovery\n\n### 9.1 Backup Strategy\n\n```bash\n# Daily full backup\npg_dump -U postgres -d user_management_db -F c -f backup_$(date +%Y%m%d).dump\n\n# Point-in-time recovery setup\n# Enable WAL archiving in postgresql.conf:\nwal_level = replica\narchive_mode = on\narchive_command = 'cp %p /path/to/archive/%f'\n```\n\n### 9.2 Recovery Procedures\n\n```bash\n# Restore from backup\npg_restore -U postgres -d user_management_db -c backup_20251012.dump\n\n# Point-in-time recovery\n# See PostgreSQL documentation for detailed PITR procedures\n```\n\n---\n\n## 10. Security Considerations\n\n### 10.1 Database Security\n\n```sql\n-- Create application user with limited privileges\nCREATE USER app_user WITH PASSWORD 'secure_generated_password';\n\n-- Grant only necessary permissions\nGRANT CONNECT ON DATABASE user_management_db TO app_user;\nGRANT SELECT, INSERT, UPDATE, DELETE ON users TO app_user;\nGRANT USAGE ON SEQUENCE users_id_seq TO app_user;\n\n-- Revoke unnecessary permissions\nREVOKE ALL ON SCHEMA public FROM PUBLIC;\nGRANT USAGE ON SCHEMA public TO app_user;\n```\n\n### 10.2 Data Protection\n\n- **Password Storage:** Never store plain text passwords, always use bcrypt hashing\n- **Sensitive Fields:** Consider encryption at rest for PII fields\n- **Row-Level Security:** Implement RLS policies if multi-tenant\n- **Audit Logging:** Track all data modifications\n- **Regular Backups:** Automated daily backups with tested recovery procedures\n\n---\n\n## 11. Performance Optimization\n\n### 11.1 Query Optimization Guidelines\n\n```sql\n-- Good: Use indexed columns in WHERE clause\nSELECT * FROM users WHERE email = 'user@example.com' AND deleted_at IS NULL;\n\n-- Bad: Function on indexed column prevents index usage\nSELECT * FROM users WHERE LOWER(email) = 'user@example.com';\n\n-- Solution: Use case-insensitive index or functional index\nCREATE INDEX idx_users_email_lower ON users(LOWER(email)) WHERE deleted_at IS NULL;\n```\n\n### 11.2 Common Query Patterns\n\n```sql\n-- 1. User login (by email)\nSELECT id, username, email, password_hash, status, is_active\nFROM users\nWHERE email = $1 AND deleted_at IS NULL;\n\n-- 2. Get user by ID\nSELECT id, username, email, first_name, last_name, phone_number,\n       date_of_birth, profile_picture_url, bio, status,\n       created_at, updated_at, last_login\nFROM users\nWHERE id = $1 AND deleted_at IS NULL;\n\n-- 3. List users with pagination\nSELECT id, username, email, first_name, last_name, status, created_at\nFROM users\nWHERE deleted_at IS NULL\nORDER BY created_at DESC\nLIMIT $1 OFFSET $2;\n\n-- 4. Search users by name\nSELECT id, username, email, first_name, last_name\nFROM users\nWHERE deleted_at IS NULL\n  AND (first_name ILIKE $1 OR last_name ILIKE $1)\nORDER BY last_name, first_name\nLIMIT 20;\n\n-- 5. Soft delete user\nUPDATE users\nSET deleted_at = CURRENT_TIMESTAMP,\n    status = 'deleted',\n    is_active = false\nWHERE id = $1 AND deleted_at IS NULL;\n```\n\n---\n\n## 12. Monitoring and Maintenance\n\n### 12.1 Database Health Checks\n\n```sql\n-- Check table size\nSELECT pg_size_pretty(pg_total_relation_size('users')) AS table_size;\n\n-- Check index usage\nSELECT schemaname, tablename, indexname, idx_scan, idx_tup_read, idx_tup_fetch\nFROM pg_stat_user_indexes\nWHERE schemaname = 'public' AND tablename = 'users';\n\n-- Check slow queries\nSELECT query, mean_exec_time, calls\nFROM pg_stat_statements\nWHERE query LIKE '%users%'\nORDER BY mean_exec_time DESC\nLIMIT 10;\n\n-- Check for bloat\nSELECT schemaname, tablename,\n       pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size\nFROM pg_tables\nWHERE schemaname = 'public'\nORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;\n```\n\n### 12.2 Maintenance Tasks\n\n```sql\n-- Regular vacuum and analyze\nVACUUM ANALYZE users;\n\n-- Reindex if needed (during maintenance window)\nREINDEX TABLE users;\n\n-- Update statistics\nANALYZE users;\n```\n\n---\n\n## 13. Schema Versioning\n\n| Version | Date | Changes | Migration Script |\n|---------|------|---------|------------------|\n| 1.0 | 2025-10-12 | Initial schema | V1__create_users_table.sql |\n| 1.1 | TBD | Add audit log table | V2__add_audit_log.sql |\n| 1.2 | TBD | Add session management | V3__add_sessions.sql |\n\n---\n\n## 14. References\n\n- PostgreSQL Documentation: https://www.postgresql.org/docs/\n- Database Design Best Practices\n- OWASP Database Security Guidelines\n- SQL Style Guide\n- Database Migration Tools: Alembic (Python), Flyway (Java), node-pg-migrate (Node.js)\n\n---\n\n**Document Status:** Final\n**Quality Review:** Passed\n**Ready for Implementation:** Yes\n",
            "test_workflow_output/backend_architecture.md": "# Backend Architecture & Implementation Guide - User Management API\n\n## Project Information\n**Workflow ID:** workflow-20251012-130125\n**Phase:** Requirements\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Backend Developer\n\n---\n\n## 1. Architecture Overview\n\n### 1.1 System Architecture\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Client Layer                             \u2502\n\u2502  (Web Apps, Mobile Apps, Third-party Integrations)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u2502 HTTPS/TLS\n                         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Load Balancer / API Gateway                   \u2502\n\u2502              (Rate Limiting, SSL Termination)                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Application Layer (API)                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502              REST API Server (Node.js/Python)             \u2502  \u2502\n\u2502  \u2502                                                            \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502   Routes    \u2502  \u2502 Controllers  \u2502  \u2502  Middleware    \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  (Routing)  \u2502\u2500\u25b6\u2502  (Business)  \u2502\u25c0\u2500\u2502 (Auth, Valid.) \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2502                           \u2502                               \u2502  \u2502\n\u2502  \u2502                           \u2502                               \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502   Models    \u2502\u25c0\u2500\u2502   Services   \u2502\u2500\u25b6\u2502   Validators   \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 (ORM/Data)  \u2502  \u2502  (Bus. Logic)\u2502  \u2502  (Data Valid.) \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       Data Layer                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  PostgreSQL Database \u2502       \u2502   Redis Cache          \u2502     \u2502\n\u2502  \u2502  (Primary Data Store)\u2502       \u2502   (Session/Cache)      \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### 1.2 Technology Stack\n\n#### Primary Stack (Node.js Option)\n- **Runtime:** Node.js v18+\n- **Framework:** Express.js v4.18+\n- **Language:** TypeScript v5+\n- **ORM:** TypeORM or Prisma\n- **Database:** PostgreSQL v14+\n- **Cache:** Redis v7+ (optional)\n- **Authentication:** jsonwebtoken (JWT)\n- **Validation:** Joi or Zod\n- **Password Hashing:** bcrypt\n- **Testing:** Jest + Supertest\n- **API Documentation:** Swagger/OpenAPI\n\n#### Alternative Stack (Python Option)\n- **Runtime:** Python v3.9+\n- **Framework:** FastAPI v0.104+\n- **ORM:** SQLAlchemy v2+\n- **Database:** PostgreSQL v14+\n- **Cache:** Redis v7+ (optional)\n- **Authentication:** python-jose (JWT)\n- **Validation:** Pydantic (built-in FastAPI)\n- **Password Hashing:** passlib with bcrypt\n- **Testing:** pytest + httpx\n- **API Documentation:** FastAPI built-in (OpenAPI)\n\n---\n\n## 2. Layered Architecture\n\n### 2.1 Layer Responsibilities\n\n#### **Presentation Layer (Routes)**\n- Define API endpoints and HTTP methods\n- Map URLs to controller functions\n- Handle request/response formatting\n- Apply route-level middleware\n\n#### **Controller Layer**\n- Receive HTTP requests\n- Extract and validate request data\n- Call appropriate service methods\n- Format responses\n- Handle HTTP-specific concerns\n\n#### **Service Layer (Business Logic)**\n- Implement core business logic\n- Orchestrate multiple operations\n- Transaction management\n- Data transformation\n- Error handling\n\n#### **Data Access Layer (Models/Repositories)**\n- Database queries and mutations\n- ORM model definitions\n- Data mapping and relationships\n- Query optimization\n\n#### **Validation Layer**\n- Input validation schemas\n- Data sanitization\n- Business rule validation\n- Custom validators\n\n---\n\n## 3. Project Structure\n\n### 3.1 Node.js/TypeScript Structure\n\n```\nuser-management-api/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 config/\n\u2502   \u2502   \u251c\u2500\u2500 database.ts           # Database connection config\n\u2502   \u2502   \u251c\u2500\u2500 jwt.ts                # JWT configuration\n\u2502   \u2502   \u2514\u2500\u2500 environment.ts        # Environment variables\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 middleware/\n\u2502   \u2502   \u251c\u2500\u2500 auth.middleware.ts    # JWT authentication\n\u2502   \u2502   \u251c\u2500\u2500 validation.middleware.ts  # Request validation\n\u2502   \u2502   \u251c\u2500\u2500 errorHandler.middleware.ts  # Error handling\n\u2502   \u2502   \u251c\u2500\u2500 rateLimit.middleware.ts  # Rate limiting\n\u2502   \u2502   \u2514\u2500\u2500 logger.middleware.ts  # Request logging\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u251c\u2500\u2500 user.model.ts         # User entity/model\n\u2502   \u2502   \u2514\u2500\u2500 auditLog.model.ts     # Audit log model\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u2502   \u2514\u2500\u2500 user.repository.ts    # User data access\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 user.service.ts       # User business logic\n\u2502   \u2502   \u251c\u2500\u2500 auth.service.ts       # Authentication logic\n\u2502   \u2502   \u2514\u2500\u2500 password.service.ts   # Password operations\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 controllers/\n\u2502   \u2502   \u251c\u2500\u2500 user.controller.ts    # User endpoints logic\n\u2502   \u2502   \u2514\u2500\u2500 auth.controller.ts    # Auth endpoints logic\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 routes/\n\u2502   \u2502   \u251c\u2500\u2500 index.ts              # Route aggregation\n\u2502   \u2502   \u251c\u2500\u2500 user.routes.ts        # User routes\n\u2502   \u2502   \u2514\u2500\u2500 auth.routes.ts        # Auth routes\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 validators/\n\u2502   \u2502   \u251c\u2500\u2500 user.validator.ts     # User validation schemas\n\u2502   \u2502   \u2514\u2500\u2500 auth.validator.ts     # Auth validation schemas\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 utils/\n\u2502   \u2502   \u251c\u2500\u2500 logger.ts             # Logging utility\n\u2502   \u2502   \u251c\u2500\u2500 response.ts           # Standard response format\n\u2502   \u2502   \u2514\u2500\u2500 errors.ts             # Custom error classes\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 types/\n\u2502   \u2502   \u251c\u2500\u2500 express.d.ts          # Express type extensions\n\u2502   \u2502   \u2514\u2500\u2500 api.types.ts          # API type definitions\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 app.ts                    # Express app setup\n\u2502   \u2514\u2500\u2500 server.ts                 # Server entry point\n\u2502\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 unit/\n\u2502   \u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u2514\u2500\u2500 controllers/\n\u2502   \u251c\u2500\u2500 integration/\n\u2502   \u2502   \u2514\u2500\u2500 api/\n\u2502   \u2514\u2500\u2500 fixtures/\n\u2502       \u2514\u2500\u2500 testData.ts\n\u2502\n\u251c\u2500\u2500 migrations/                    # Database migrations\n\u2502   \u2514\u2500\u2500 001_create_users_table.ts\n\u2502\n\u251c\u2500\u2500 docs/\n\u2502   \u2514\u2500\u2500 api/\n\u2502       \u2514\u2500\u2500 openapi.yaml\n\u2502\n\u251c\u2500\u2500 .env.example                   # Environment template\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u251c\u2500\u2500 jest.config.js\n\u2514\u2500\u2500 README.md\n```\n\n### 3.2 Python/FastAPI Structure\n\n```\nuser_management_api/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 core/\n\u2502   \u2502   \u251c\u2500\u2500 config.py             # Configuration\n\u2502   \u2502   \u251c\u2500\u2500 security.py           # Security utilities\n\u2502   \u2502   \u2514\u2500\u2500 database.py           # Database connection\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 middleware/\n\u2502   \u2502   \u251c\u2500\u2500 auth.py               # Authentication\n\u2502   \u2502   \u251c\u2500\u2500 error_handler.py      # Error handling\n\u2502   \u2502   \u2514\u2500\u2500 rate_limit.py         # Rate limiting\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u251c\u2500\u2500 user.py               # User SQLAlchemy model\n\u2502   \u2502   \u2514\u2500\u2500 audit_log.py          # Audit log model\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 schemas/\n\u2502   \u2502   \u251c\u2500\u2500 user.py               # User Pydantic schemas\n\u2502   \u2502   \u2514\u2500\u2500 auth.py               # Auth Pydantic schemas\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u2502   \u2514\u2500\u2500 user_repository.py    # User data access\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 user_service.py       # User business logic\n\u2502   \u2502   \u251c\u2500\u2500 auth_service.py       # Authentication logic\n\u2502   \u2502   \u2514\u2500\u2500 password_service.py   # Password operations\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 deps.py               # API dependencies\n\u2502   \u2502   \u251c\u2500\u2500 v1/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 users.py          # User endpoints\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 auth.py           # Auth endpoints\n\u2502   \u2502   \u2514\u2500\u2500 router.py             # API router aggregation\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 utils/\n\u2502   \u2502   \u251c\u2500\u2500 logger.py             # Logging utility\n\u2502   \u2502   \u251c\u2500\u2500 response.py           # Response formatter\n\u2502   \u2502   \u2514\u2500\u2500 exceptions.py         # Custom exceptions\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 main.py                   # FastAPI app entry\n\u2502   \u2514\u2500\u2500 __init__.py\n\u2502\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 unit/\n\u2502   \u251c\u2500\u2500 integration/\n\u2502   \u2514\u2500\u2500 conftest.py\n\u2502\n\u251c\u2500\u2500 alembic/                       # Database migrations\n\u2502   \u2514\u2500\u2500 versions/\n\u2502\n\u251c\u2500\u2500 .env.example\n\u251c\u2500\u2500 requirements.txt\n\u251c\u2500\u2500 pytest.ini\n\u2514\u2500\u2500 README.md\n```\n\n---\n\n## 4. Core Components Implementation\n\n### 4.1 User Model (TypeScript/TypeORM)\n\n```typescript\n// src/models/user.model.ts\nimport {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  UpdateDateColumn,\n  Index,\n} from 'typeorm';\n\n@Entity('users')\nexport class User {\n  @PrimaryGeneratedColumn('uuid')\n  id: string;\n\n  @Column({ length: 50, unique: true })\n  @Index()\n  username: string;\n\n  @Column({ length: 255, unique: true })\n  @Index()\n  email: string;\n\n  @Column({ length: 255, select: false })\n  passwordHash: string;\n\n  @Column({ length: 100, nullable: true })\n  firstName?: string;\n\n  @Column({ length: 100, nullable: true })\n  lastName?: string;\n\n  @Column({ length: 20, nullable: true })\n  phoneNumber?: string;\n\n  @Column({ type: 'date', nullable: true })\n  dateOfBirth?: Date;\n\n  @Column({ length: 500, nullable: true })\n  profilePictureUrl?: string;\n\n  @Column({ type: 'text', nullable: true })\n  bio?: string;\n\n  @Column({ length: 20, default: 'active' })\n  status: 'active' | 'inactive' | 'suspended' | 'deleted';\n\n  @Column({ default: true })\n  isActive: boolean;\n\n  @Column({ default: false })\n  emailVerified: boolean;\n\n  @CreateDateColumn()\n  createdAt: Date;\n\n  @UpdateDateColumn()\n  updatedAt: Date;\n\n  @Column({ type: 'timestamp', nullable: true })\n  lastLogin?: Date;\n\n  @Column({ type: 'timestamp', nullable: true })\n  deletedAt?: Date;\n}\n```\n\n### 4.2 User Service (TypeScript)\n\n```typescript\n// src/services/user.service.ts\nimport { Repository } from 'typeorm';\nimport { User } from '../models/user.model';\nimport bcrypt from 'bcrypt';\nimport { ConflictError, NotFoundError } from '../utils/errors';\n\nexport class UserService {\n  constructor(private userRepository: Repository<User>) {}\n\n  async createUser(userData: CreateUserDto): Promise<User> {\n    // Check for duplicate email/username\n    const existingUser = await this.userRepository.findOne({\n      where: [\n        { email: userData.email },\n        { username: userData.username }\n      ]\n    });\n\n    if (existingUser) {\n      if (existingUser.email === userData.email) {\n        throw new ConflictError('Email already exists');\n      }\n      throw new ConflictError('Username already exists');\n    }\n\n    // Hash password\n    const passwordHash = await bcrypt.hash(userData.password, 10);\n\n    // Create user\n    const user = this.userRepository.create({\n      ...userData,\n      passwordHash,\n    });\n\n    return await this.userRepository.save(user);\n  }\n\n  async getUserById(id: string): Promise<User> {\n    const user = await this.userRepository.findOne({\n      where: { id, deletedAt: null }\n    });\n\n    if (!user) {\n      throw new NotFoundError('User not found');\n    }\n\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | null> {\n    return await this.userRepository\n      .createQueryBuilder('user')\n      .where('user.email = :email', { email })\n      .andWhere('user.deletedAt IS NULL')\n      .addSelect('user.passwordHash')\n      .getOne();\n  }\n\n  async listUsers(options: ListUsersOptions): Promise<PaginatedResponse<User>> {\n    const { page = 1, limit = 20, search, status, sortBy, sortOrder } = options;\n\n    const query = this.userRepository\n      .createQueryBuilder('user')\n      .where('user.deletedAt IS NULL');\n\n    // Apply filters\n    if (search) {\n      query.andWhere(\n        '(user.firstName ILIKE :search OR user.lastName ILIKE :search OR user.email ILIKE :search)',\n        { search: `%${search}%` }\n      );\n    }\n\n    if (status) {\n      query.andWhere('user.status = :status', { status });\n    }\n\n    // Apply sorting\n    const sortColumn = sortBy || 'createdAt';\n    const sortDirection = sortOrder?.toUpperCase() === 'ASC' ? 'ASC' : 'DESC';\n    query.orderBy(`user.${sortColumn}`, sortDirection);\n\n    // Apply pagination\n    const skip = (page - 1) * limit;\n    query.skip(skip).take(limit);\n\n    // Execute query\n    const [users, total] = await query.getManyAndCount();\n\n    return {\n      data: users,\n      pagination: {\n        currentPage: page,\n        perPage: limit,\n        totalPages: Math.ceil(total / limit),\n        totalItems: total,\n        hasNext: page * limit < total,\n        hasPrevious: page > 1,\n      },\n    };\n  }\n\n  async updateUser(id: string, updateData: UpdateUserDto): Promise<User> {\n    const user = await this.getUserById(id);\n\n    // Check email uniqueness if email is being updated\n    if (updateData.email && updateData.email !== user.email) {\n      const existingUser = await this.userRepository.findOne({\n        where: { email: updateData.email }\n      });\n      if (existingUser) {\n        throw new ConflictError('Email already exists');\n      }\n    }\n\n    // Update user\n    Object.assign(user, updateData);\n    return await this.userRepository.save(user);\n  }\n\n  async deleteUser(id: string): Promise<void> {\n    const user = await this.getUserById(id);\n\n    // Soft delete\n    user.deletedAt = new Date();\n    user.status = 'deleted';\n    user.isActive = false;\n\n    await this.userRepository.save(user);\n  }\n\n  async verifyPassword(user: User, password: string): Promise<boolean> {\n    return await bcrypt.compare(password, user.passwordHash);\n  }\n\n  async updatePassword(\n    userId: string,\n    currentPassword: string,\n    newPassword: string\n  ): Promise<void> {\n    const user = await this.userRepository\n      .createQueryBuilder('user')\n      .where('user.id = :userId', { userId })\n      .addSelect('user.passwordHash')\n      .getOne();\n\n    if (!user) {\n      throw new NotFoundError('User not found');\n    }\n\n    // Verify current password\n    const isValid = await this.verifyPassword(user, currentPassword);\n    if (!isValid) {\n      throw new UnauthorizedError('Current password is incorrect');\n    }\n\n    // Hash and save new password\n    user.passwordHash = await bcrypt.hash(newPassword, 10);\n    await this.userRepository.save(user);\n  }\n}\n```\n\n### 4.3 User Controller (TypeScript)\n\n```typescript\n// src/controllers/user.controller.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { UserService } from '../services/user.service';\nimport { successResponse } from '../utils/response';\n\nexport class UserController {\n  constructor(private userService: UserService) {}\n\n  createUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const user = await this.userService.createUser(req.body);\n      return successResponse(res, user, 'User created successfully', 201);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  getUserById = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const user = await this.userService.getUserById(req.params.id);\n      return successResponse(res, { user });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  listUsers = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const result = await this.userService.listUsers(req.query);\n      return successResponse(res, result);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  updateUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const user = await this.userService.updateUser(req.params.id, req.body);\n      return successResponse(res, { user }, 'User updated successfully');\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  deleteUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      await this.userService.deleteUser(req.params.id);\n      return res.status(204).send();\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  updatePassword = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n      await this.userService.updatePassword(\n        req.params.id,\n        currentPassword,\n        newPassword\n      );\n      return successResponse(res, null, 'Password updated successfully');\n    } catch (error) {\n      next(error);\n    }\n  };\n}\n```\n\n### 4.4 Authentication Middleware (TypeScript)\n\n```typescript\n// src/middleware/auth.middleware.ts\nimport { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\nimport { UnauthorizedError } from '../utils/errors';\nimport { config } from '../config/environment';\n\nexport interface JWTPayload {\n  userId: string;\n  email: string;\n  iat: number;\n  exp: number;\n}\n\nexport const authMiddleware = async (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    // Extract token from Authorization header\n    const authHeader = req.headers.authorization;\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\n      throw new UnauthorizedError('No token provided');\n    }\n\n    const token = authHeader.substring(7);\n\n    // Verify token\n    const decoded = jwt.verify(token, config.jwtSecret) as JWTPayload;\n\n    // Attach user info to request\n    req.user = {\n      userId: decoded.userId,\n      email: decoded.email,\n    };\n\n    next();\n  } catch (error) {\n    if (error instanceof jwt.JsonWebTokenError) {\n      next(new UnauthorizedError('Invalid token'));\n    } else if (error instanceof jwt.TokenExpiredError) {\n      next(new UnauthorizedError('Token expired'));\n    } else {\n      next(error);\n    }\n  }\n};\n```\n\n### 4.5 Validation Schemas (TypeScript with Joi)\n\n```typescript\n// src/validators/user.validator.ts\nimport Joi from 'joi';\n\nexport const createUserSchema = Joi.object({\n  username: Joi.string()\n    .alphanum()\n    .min(3)\n    .max(50)\n    .required()\n    .messages({\n      'string.alphanum': 'Username must contain only alphanumeric characters',\n      'string.min': 'Username must be at least 3 characters',\n      'string.max': 'Username must not exceed 50 characters',\n    }),\n\n  email: Joi.string()\n    .email()\n    .max(255)\n    .required()\n    .messages({\n      'string.email': 'Invalid email format',\n    }),\n\n  password: Joi.string()\n    .min(8)\n    .pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]/)\n    .required()\n    .messages({\n      'string.pattern.base': 'Password must contain uppercase, lowercase, number, and special character',\n      'string.min': 'Password must be at least 8 characters',\n    }),\n\n  firstName: Joi.string().max(100).optional(),\n  lastName: Joi.string().max(100).optional(),\n  phoneNumber: Joi.string().pattern(/^\\+?[1-9]\\d{1,14}$/).optional(),\n  dateOfBirth: Joi.date().max('now').optional(),\n});\n\nexport const updateUserSchema = Joi.object({\n  email: Joi.string().email().max(255).optional(),\n  firstName: Joi.string().max(100).optional(),\n  lastName: Joi.string().max(100).optional(),\n  phoneNumber: Joi.string().pattern(/^\\+?[1-9]\\d{1,14}$/).optional(),\n  dateOfBirth: Joi.date().max('now').optional(),\n  profilePictureUrl: Joi.string().uri().max(500).optional(),\n  bio: Joi.string().max(500).optional(),\n}).min(1);\n\nexport const listUsersSchema = Joi.object({\n  page: Joi.number().integer().min(1).default(1),\n  limit: Joi.number().integer().min(1).max(100).default(20),\n  search: Joi.string().min(2).optional(),\n  status: Joi.string().valid('active', 'inactive', 'suspended').optional(),\n  sortBy: Joi.string().valid('createdAt', 'email', 'username', 'lastName').default('createdAt'),\n  sortOrder: Joi.string().valid('asc', 'desc').default('desc'),\n});\n```\n\n---\n\n## 5. Security Implementation\n\n### 5.1 Password Hashing\n\n```typescript\n// src/services/password.service.ts\nimport bcrypt from 'bcrypt';\n\nexport class PasswordService {\n  private readonly saltRounds = 10;\n\n  async hashPassword(password: string): Promise<string> {\n    return await bcrypt.hash(password, this.saltRounds);\n  }\n\n  async comparePassword(password: string, hash: string): Promise<boolean> {\n    return await bcrypt.compare(password, hash);\n  }\n\n  validatePasswordStrength(password: string): boolean {\n    const minLength = 8;\n    const hasUpperCase = /[A-Z]/.test(password);\n    const hasLowerCase = /[a-z]/.test(password);\n    const hasNumbers = /\\d/.test(password);\n    const hasSpecialChar = /[@$!%*?&]/.test(password);\n\n    return (\n      password.length >= minLength &&\n      hasUpperCase &&\n      hasLowerCase &&\n      hasNumbers &&\n      hasSpecialChar\n    );\n  }\n}\n```\n\n### 5.2 JWT Authentication\n\n```typescript\n// src/services/auth.service.ts\nimport jwt from 'jsonwebtoken';\nimport { config } from '../config/environment';\n\nexport interface TokenPayload {\n  userId: string;\n  email: string;\n}\n\nexport class AuthService {\n  generateAccessToken(payload: TokenPayload): string {\n    return jwt.sign(payload, config.jwtSecret, {\n      expiresIn: config.jwtExpiresIn, // '1h'\n    });\n  }\n\n  generateRefreshToken(payload: TokenPayload): string {\n    return jwt.sign(payload, config.jwtRefreshSecret, {\n      expiresIn: config.jwtRefreshExpiresIn, // '7d'\n    });\n  }\n\n  verifyAccessToken(token: string): TokenPayload {\n    return jwt.verify(token, config.jwtSecret) as TokenPayload;\n  }\n\n  verifyRefreshToken(token: string): TokenPayload {\n    return jwt.verify(token, config.jwtRefreshSecret) as TokenPayload;\n  }\n}\n```\n\n### 5.3 Rate Limiting\n\n```typescript\n// src/middleware/rateLimit.middleware.ts\nimport rateLimit from 'express-rate-limit';\n\nexport const apiRateLimiter = rateLimit({\n  windowMs: 60 * 1000, // 1 minute\n  max: 100, // 100 requests per window\n  message: {\n    success: false,\n    error: {\n      code: 'RATE_LIMIT_EXCEEDED',\n      message: 'Too many requests. Please try again later.',\n    },\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nexport const authRateLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 5, // 5 login attempts\n  message: {\n    success: false,\n    error: {\n      code: 'RATE_LIMIT_EXCEEDED',\n      message: 'Too many login attempts. Please try again later.',\n    },\n  },\n  skipSuccessfulRequests: true,\n});\n```\n\n---\n\n## 6. Error Handling\n\n### 6.1 Custom Error Classes\n\n```typescript\n// src/utils/errors.ts\nexport class AppError extends Error {\n  constructor(\n    public statusCode: number,\n    public code: string,\n    public message: string,\n    public details?: any\n  ) {\n    super(message);\n    this.name = this.constructor.name;\n    Error.captureStackTrace(this, this.constructor);\n  }\n}\n\nexport class ValidationError extends AppError {\n  constructor(message: string, details?: any) {\n    super(400, 'VALIDATION_ERROR', message, details);\n  }\n}\n\nexport class UnauthorizedError extends AppError {\n  constructor(message: string = 'Unauthorized') {\n    super(401, 'UNAUTHORIZED', message);\n  }\n}\n\nexport class ForbiddenError extends AppError {\n  constructor(message: string = 'Forbidden') {\n    super(403, 'FORBIDDEN', message);\n  }\n}\n\nexport class NotFoundError extends AppError {\n  constructor(message: string = 'Resource not found') {\n    super(404, 'RESOURCE_NOT_FOUND', message);\n  }\n}\n\nexport class ConflictError extends AppError {\n  constructor(message: string, details?: any) {\n    super(409, 'DUPLICATE_RESOURCE', message, details);\n  }\n}\n```\n\n### 6.2 Error Handler Middleware\n\n```typescript\n// src/middleware/errorHandler.middleware.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { AppError } from '../utils/errors';\nimport { logger } from '../utils/logger';\n\nexport const errorHandler = (\n  err: Error,\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  // Log error\n  logger.error({\n    message: err.message,\n    stack: err.stack,\n    path: req.path,\n    method: req.method,\n  });\n\n  // Handle known errors\n  if (err instanceof AppError) {\n    return res.status(err.statusCode).json({\n      success: false,\n      error: {\n        code: err.code,\n        message: err.message,\n        details: err.details,\n        timestamp: new Date().toISOString(),\n      },\n    });\n  }\n\n  // Handle unknown errors\n  return res.status(500).json({\n    success: false,\n    error: {\n      code: 'INTERNAL_SERVER_ERROR',\n      message: 'An unexpected error occurred',\n      timestamp: new Date().toISOString(),\n    },\n  });\n};\n```\n\n---\n\n## 7. Testing Strategy\n\n### 7.1 Unit Tests (Jest)\n\n```typescript\n// tests/unit/services/user.service.test.ts\nimport { UserService } from '../../../src/services/user.service';\nimport { User } from '../../../src/models/user.model';\nimport { ConflictError, NotFoundError } from '../../../src/utils/errors';\n\ndescribe('UserService', () => {\n  let userService: UserService;\n  let mockRepository: jest.Mocked<Repository<User>>;\n\n  beforeEach(() => {\n    mockRepository = {\n      findOne: jest.fn(),\n      create: jest.fn(),\n      save: jest.fn(),\n      createQueryBuilder: jest.fn(),\n    } as any;\n\n    userService = new UserService(mockRepository);\n  });\n\n  describe('createUser', () => {\n    it('should create a new user successfully', async () => {\n      const userData = {\n        username: 'testuser',\n        email: 'test@example.com',\n        password: 'Test@1234',\n        firstName: 'Test',\n        lastName: 'User',\n      };\n\n      mockRepository.findOne.mockResolvedValue(null);\n      mockRepository.create.mockReturnValue(userData as any);\n      mockRepository.save.mockResolvedValue({ ...userData, id: 'uuid' } as any);\n\n      const result = await userService.createUser(userData);\n\n      expect(result).toHaveProperty('id');\n      expect(mockRepository.findOne).toHaveBeenCalled();\n      expect(mockRepository.save).toHaveBeenCalled();\n    });\n\n    it('should throw ConflictError if email exists', async () => {\n      const userData = {\n        username: 'testuser',\n        email: 'existing@example.com',\n        password: 'Test@1234',\n      };\n\n      mockRepository.findOne.mockResolvedValue({ email: userData.email } as any);\n\n      await expect(userService.createUser(userData)).rejects.toThrow(ConflictError);\n    });\n  });\n\n  describe('getUserById', () => {\n    it('should return user if found', async () => {\n      const userId = 'uuid';\n      const mockUser = { id: userId, email: 'test@example.com' };\n\n      mockRepository.findOne.mockResolvedValue(mockUser as any);\n\n      const result = await userService.getUserById(userId);\n\n      expect(result).toEqual(mockUser);\n    });\n\n    it('should throw NotFoundError if user not found', async () => {\n      mockRepository.findOne.mockResolvedValue(null);\n\n      await expect(userService.getUserById('uuid')).rejects.toThrow(NotFoundError);\n    });\n  });\n});\n```\n\n### 7.2 Integration Tests\n\n```typescript\n// tests/integration/api/users.test.ts\nimport request from 'supertest';\nimport { app } from '../../../src/app';\nimport { setupTestDatabase, teardownTestDatabase } from '../../fixtures/database';\n\ndescribe('User API Integration Tests', () => {\n  beforeAll(async () => {\n    await setupTestDatabase();\n  });\n\n  afterAll(async () => {\n    await teardownTestDatabase();\n  });\n\n  describe('POST /api/v1/users', () => {\n    it('should create a new user', async () => {\n      const response = await request(app)\n        .post('/api/v1/users')\n        .send({\n          username: 'testuser',\n          email: 'test@example.com',\n          password: 'Test@1234',\n          firstName: 'Test',\n          lastName: 'User',\n        });\n\n      expect(response.status).toBe(201);\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.user).toHaveProperty('id');\n      expect(response.body.data.user.email).toBe('test@example.com');\n    });\n\n    it('should return 409 for duplicate email', async () => {\n      // Create first user\n      await request(app)\n        .post('/api/v1/users')\n        .send({\n          username: 'user1',\n          email: 'duplicate@example.com',\n          password: 'Test@1234',\n        });\n\n      // Try to create with same email\n      const response = await request(app)\n        .post('/api/v1/users')\n        .send({\n          username: 'user2',\n          email: 'duplicate@example.com',\n          password: 'Test@1234',\n        });\n\n      expect(response.status).toBe(409);\n      expect(response.body.error.code).toBe('DUPLICATE_RESOURCE');\n    });\n  });\n});\n```\n\n---\n\n## 8. Deployment Configuration\n\n### 8.1 Environment Variables\n\n```bash\n# .env.example\n\n# Server Configuration\nNODE_ENV=development\nPORT=3000\nAPI_VERSION=v1\n\n# Database Configuration\nDB_HOST=localhost\nDB_PORT=5432\nDB_NAME=user_management_db\nDB_USER=app_user\nDB_PASSWORD=secure_password\nDB_POOL_MIN=2\nDB_POOL_MAX=10\n\n# JWT Configuration\nJWT_SECRET=your-super-secret-jwt-key-change-in-production\nJWT_EXPIRES_IN=1h\nJWT_REFRESH_SECRET=your-refresh-token-secret\nJWT_REFRESH_EXPIRES_IN=7d\n\n# Security\nBCRYPT_ROUNDS=10\nRATE_LIMIT_WINDOW_MS=60000\nRATE_LIMIT_MAX_REQUESTS=100\n\n# Logging\nLOG_LEVEL=info\nLOG_FORMAT=json\n\n# CORS\nCORS_ORIGIN=http://localhost:3000,https://yourdomain.com\n```\n\n### 8.2 Docker Configuration\n\n```dockerfile\n# Dockerfile\nFROM node:18-alpine AS builder\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci\n\nCOPY . .\nRUN npm run build\n\nFROM node:18-alpine\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci --only=production\n\nCOPY --from=builder /app/dist ./dist\n\nEXPOSE 3000\n\nCMD [\"node\", \"dist/server.js\"]\n```\n\n```yaml\n# docker-compose.yml\nversion: '3.8'\n\nservices:\n  api:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - DB_HOST=postgres\n      - DB_PORT=5432\n      - DB_NAME=user_management_db\n      - DB_USER=app_user\n      - DB_PASSWORD=secure_password\n    depends_on:\n      - postgres\n    restart: unless-stopped\n\n  postgres:\n    image: postgres:14-alpine\n    environment:\n      - POSTGRES_DB=user_management_db\n      - POSTGRES_USER=app_user\n      - POSTGRES_PASSWORD=secure_password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - \"5432:5432\"\n    restart: unless-stopped\n\nvolumes:\n  postgres_data:\n```\n\n---\n\n## 9. Performance Optimization\n\n### 9.1 Database Query Optimization\n- Use indexes on frequently queried columns\n- Implement connection pooling\n- Use query result caching for static data\n- Avoid N+1 queries with eager loading\n\n### 9.2 API Response Optimization\n- Implement response compression (gzip)\n- Use HTTP caching headers (ETag, Cache-Control)\n- Paginate large result sets\n- Exclude unnecessary fields from responses\n\n### 9.3 Caching Strategy\n- Cache user profiles (5-minute TTL)\n- Cache authentication tokens\n- Implement Redis for session management\n\n---\n\n## 10. Monitoring and Observability\n\n### 10.1 Logging\n- Structured logging (JSON format)\n- Log levels: ERROR, WARN, INFO, DEBUG\n- Request/response logging\n- Performance metrics logging\n\n### 10.2 Health Checks\n```typescript\n// Health check endpoint\napp.get('/api/v1/health', async (req, res) => {\n  const health = {\n    status: 'healthy',\n    version: process.env.API_VERSION,\n    timestamp: new Date().toISOString(),\n    services: {\n      database: await checkDatabaseConnection(),\n      cache: await checkCacheConnection(),\n    },\n  };\n  res.json(health);\n});\n```\n\n---\n\n**Document Status:** Final\n**Quality Review:** Passed\n**Ready for Implementation:** Yes\n",
            "test_workflow_output/database_schema.sql": "-- ============================================================================\n-- User Management API - Database Schema\n-- ============================================================================\n-- Version: 1.0.0\n-- Database: PostgreSQL 14+\n-- Purpose: Core schema for user management REST API with CRUD operations\n-- ============================================================================\n\n-- Enable required extensions\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\nCREATE EXTENSION IF NOT EXISTS \"pgcrypto\";\n\n-- ============================================================================\n-- TABLES\n-- ============================================================================\n\n-- Users table: Core entity for user management\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    username VARCHAR(50) NOT NULL UNIQUE,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    password_hash VARCHAR(255) NOT NULL,\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    is_active BOOLEAN DEFAULT TRUE,\n    is_verified BOOLEAN DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    last_login_at TIMESTAMP WITH TIME ZONE,\n    deleted_at TIMESTAMP WITH TIME ZONE,\n\n    -- Constraints\n    CONSTRAINT username_length CHECK (LENGTH(username) >= 3),\n    CONSTRAINT email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')\n);\n\n-- User profiles: Extended user information\nCREATE TABLE user_profiles (\n    user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,\n    bio TEXT,\n    phone_number VARCHAR(20),\n    date_of_birth DATE,\n    avatar_url VARCHAR(500),\n    timezone VARCHAR(50) DEFAULT 'UTC',\n    locale VARCHAR(10) DEFAULT 'en_US',\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\n-- User roles: Role-based access control\nCREATE TABLE roles (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    name VARCHAR(50) NOT NULL UNIQUE,\n    description TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT role_name_lowercase CHECK (name = LOWER(name))\n);\n\n-- User role assignments: Many-to-many relationship\nCREATE TABLE user_roles (\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    role_id UUID REFERENCES roles(id) ON DELETE CASCADE,\n    assigned_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    assigned_by UUID REFERENCES users(id) ON DELETE SET NULL,\n\n    PRIMARY KEY (user_id, role_id)\n);\n\n-- Audit log: Track all user changes\nCREATE TABLE user_audit_log (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID REFERENCES users(id) ON DELETE SET NULL,\n    action VARCHAR(50) NOT NULL,\n    entity_type VARCHAR(50) NOT NULL,\n    entity_id UUID,\n    old_values JSONB,\n    new_values JSONB,\n    ip_address INET,\n    user_agent TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    performed_by UUID REFERENCES users(id) ON DELETE SET NULL\n);\n\n-- Password reset tokens\nCREATE TABLE password_reset_tokens (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    token VARCHAR(255) NOT NULL UNIQUE,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    used_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT token_not_expired CHECK (used_at IS NULL OR used_at < expires_at)\n);\n\n-- Email verification tokens\nCREATE TABLE email_verification_tokens (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    token VARCHAR(255) NOT NULL UNIQUE,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    verified_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\n-- ============================================================================\n-- INDEXES\n-- ============================================================================\n\n-- Users table indexes\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_is_active ON users(is_active) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_created_at ON users(created_at DESC);\nCREATE INDEX idx_users_deleted_at ON users(deleted_at) WHERE deleted_at IS NOT NULL;\n\n-- User profiles indexes\nCREATE INDEX idx_user_profiles_phone ON user_profiles(phone_number);\n\n-- User roles indexes\nCREATE INDEX idx_user_roles_user_id ON user_roles(user_id);\nCREATE INDEX idx_user_roles_role_id ON user_roles(role_id);\n\n-- Audit log indexes\nCREATE INDEX idx_audit_log_user_id ON user_audit_log(user_id);\nCREATE INDEX idx_audit_log_created_at ON user_audit_log(created_at DESC);\nCREATE INDEX idx_audit_log_action ON user_audit_log(action);\nCREATE INDEX idx_audit_log_entity ON user_audit_log(entity_type, entity_id);\n\n-- Token indexes\nCREATE INDEX idx_password_reset_tokens_user_id ON password_reset_tokens(user_id);\nCREATE INDEX idx_password_reset_tokens_token ON password_reset_tokens(token) WHERE used_at IS NULL;\nCREATE INDEX idx_password_reset_tokens_expires ON password_reset_tokens(expires_at) WHERE used_at IS NULL;\n\nCREATE INDEX idx_email_verification_tokens_user_id ON email_verification_tokens(user_id);\nCREATE INDEX idx_email_verification_tokens_token ON email_verification_tokens(token) WHERE verified_at IS NULL;\n\n-- ============================================================================\n-- FUNCTIONS AND TRIGGERS\n-- ============================================================================\n\n-- Function: Update timestamp on row modification\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = CURRENT_TIMESTAMP;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Trigger: Auto-update updated_at for users\nCREATE TRIGGER update_users_updated_at\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- Trigger: Auto-update updated_at for user_profiles\nCREATE TRIGGER update_user_profiles_updated_at\n    BEFORE UPDATE ON user_profiles\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- Function: Soft delete user\nCREATE OR REPLACE FUNCTION soft_delete_user(user_id_param UUID)\nRETURNS BOOLEAN AS $$\nBEGIN\n    UPDATE users\n    SET deleted_at = CURRENT_TIMESTAMP,\n        is_active = FALSE\n    WHERE id = user_id_param\n    AND deleted_at IS NULL;\n\n    RETURN FOUND;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Function: Clean expired tokens\nCREATE OR REPLACE FUNCTION clean_expired_tokens()\nRETURNS INTEGER AS $$\nDECLARE\n    deleted_count INTEGER;\nBEGIN\n    DELETE FROM password_reset_tokens\n    WHERE expires_at < CURRENT_TIMESTAMP\n    AND used_at IS NULL;\n\n    GET DIAGNOSTICS deleted_count = ROW_COUNT;\n\n    DELETE FROM email_verification_tokens\n    WHERE expires_at < CURRENT_TIMESTAMP\n    AND verified_at IS NULL;\n\n    RETURN deleted_count;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- ============================================================================\n-- VIEWS\n-- ============================================================================\n\n-- View: Complete user information with profile and roles\nCREATE OR REPLACE VIEW v_users_complete AS\nSELECT\n    u.id,\n    u.username,\n    u.email,\n    u.first_name,\n    u.last_name,\n    u.is_active,\n    u.is_verified,\n    u.created_at,\n    u.updated_at,\n    u.last_login_at,\n    p.bio,\n    p.phone_number,\n    p.date_of_birth,\n    p.avatar_url,\n    p.timezone,\n    p.locale,\n    ARRAY_AGG(DISTINCT r.name) FILTER (WHERE r.name IS NOT NULL) AS roles\nFROM users u\nLEFT JOIN user_profiles p ON u.id = p.user_id\nLEFT JOIN user_roles ur ON u.id = ur.user_id\nLEFT JOIN roles r ON ur.role_id = r.id\nWHERE u.deleted_at IS NULL\nGROUP BY u.id, p.user_id, p.bio, p.phone_number, p.date_of_birth,\n         p.avatar_url, p.timezone, p.locale;\n\n-- View: Active users summary\nCREATE OR REPLACE VIEW v_active_users_summary AS\nSELECT\n    u.id,\n    u.username,\n    u.email,\n    u.first_name,\n    u.last_name,\n    u.is_verified,\n    u.last_login_at,\n    COUNT(DISTINCT ur.role_id) AS role_count\nFROM users u\nLEFT JOIN user_roles ur ON u.id = ur.user_id\nWHERE u.is_active = TRUE\nAND u.deleted_at IS NULL\nGROUP BY u.id;\n\n-- ============================================================================\n-- INITIAL DATA\n-- ============================================================================\n\n-- Insert default roles\nINSERT INTO roles (name, description) VALUES\n    ('admin', 'Full system access with all permissions'),\n    ('user', 'Standard user with basic permissions'),\n    ('moderator', 'Can moderate content and manage users'),\n    ('guest', 'Read-only access')\nON CONFLICT (name) DO NOTHING;\n\n-- ============================================================================\n-- GRANTS AND PERMISSIONS\n-- ============================================================================\n\n-- Grant usage on schema\nGRANT USAGE ON SCHEMA public TO PUBLIC;\n\n-- Grant select on views\nGRANT SELECT ON v_users_complete TO PUBLIC;\nGRANT SELECT ON v_active_users_summary TO PUBLIC;\n\n-- ============================================================================\n-- COMMENTS\n-- ============================================================================\n\nCOMMENT ON TABLE users IS 'Core user accounts with authentication credentials';\nCOMMENT ON TABLE user_profiles IS 'Extended user profile information';\nCOMMENT ON TABLE roles IS 'System roles for access control';\nCOMMENT ON TABLE user_roles IS 'User-role assignments (many-to-many)';\nCOMMENT ON TABLE user_audit_log IS 'Audit trail for all user-related changes';\nCOMMENT ON TABLE password_reset_tokens IS 'Temporary tokens for password reset flow';\nCOMMENT ON TABLE email_verification_tokens IS 'Tokens for email verification';\n\nCOMMENT ON COLUMN users.password_hash IS 'Hashed password using bcrypt or argon2';\nCOMMENT ON COLUMN users.deleted_at IS 'Soft delete timestamp (NULL = active)';\nCOMMENT ON COLUMN users.is_verified IS 'Email verification status';\n",
            "test_workflow_output/data_model.md": "# Data Model Documentation\n## User Management REST API\n\n**Version:** 1.0.0\n**Database:** PostgreSQL 14+\n**Created:** 2025-10-12\n**Author:** Database Specialist\n\n---\n\n## Table of Contents\n1. [Overview](#overview)\n2. [Entity Relationship Diagram](#entity-relationship-diagram)\n3. [Data Entities](#data-entities)\n4. [Relationships](#relationships)\n5. [Data Types and Constraints](#data-types-and-constraints)\n6. [Indexing Strategy](#indexing-strategy)\n7. [Security Considerations](#security-considerations)\n\n---\n\n## Overview\n\nThis data model supports a comprehensive user management system with CRUD operations, role-based access control (RBAC), audit logging, and user verification workflows.\n\n### Key Features\n- **User Management**: Core user accounts with soft delete support\n- **Profile Management**: Extended user information storage\n- **Role-Based Access Control**: Flexible role assignment system\n- **Audit Trail**: Complete history of user-related changes\n- **Token Management**: Password reset and email verification flows\n- **Soft Deletes**: Data retention for compliance and recovery\n\n---\n\n## Entity Relationship Diagram\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     USERS       \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 PK: id (UUID)   \u2502\n\u2502 UK: username    \u2502\n\u2502 UK: email       \u2502\n\u2502 password_hash   \u2502\n\u2502 first_name      \u2502\n\u2502 last_name       \u2502\n\u2502 is_active       \u2502\n\u2502 is_verified     \u2502\n\u2502 created_at      \u2502\n\u2502 updated_at      \u2502\n\u2502 last_login_at   \u2502\n\u2502 deleted_at      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502 1:1\n         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 USER_PROFILES   \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502PK,FK: user_id   \u2502\n\u2502 bio             \u2502\n\u2502 phone_number    \u2502\n\u2502 date_of_birth   \u2502\n\u2502 avatar_url      \u2502\n\u2502 timezone        \u2502\n\u2502 locale          \u2502\n\u2502 created_at      \u2502\n\u2502 updated_at      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n         \u2502\n         \u2502 M:N\n         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   USER_ROLES    \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2502     ROLES       \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  M:1 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502PK,FK: user_id   \u2502      \u2502 PK: id (UUID)   \u2502\n\u2502PK,FK: role_id   \u2502      \u2502 UK: name        \u2502\n\u2502 assigned_at     \u2502      \u2502 description     \u2502\n\u2502 assigned_by     \u2502      \u2502 created_at      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502USER_AUDIT_LOG   \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 PK: id (UUID)   \u2502\n\u2502 FK: user_id     \u2502\n\u2502 action          \u2502\n\u2502 entity_type     \u2502\n\u2502 entity_id       \u2502\n\u2502 old_values      \u2502\n\u2502 new_values      \u2502\n\u2502 ip_address      \u2502\n\u2502 user_agent      \u2502\n\u2502 created_at      \u2502\n\u2502 performed_by    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502PASSWORD_RESET_TOKENS    \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 PK: id (UUID)           \u2502\n\u2502 FK: user_id             \u2502\n\u2502 UK: token               \u2502\n\u2502 expires_at              \u2502\n\u2502 used_at                 \u2502\n\u2502 created_at              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502EMAIL_VERIFICATION_TOKENS\u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 PK: id (UUID)           \u2502\n\u2502 FK: user_id             \u2502\n\u2502 UK: token               \u2502\n\u2502 expires_at              \u2502\n\u2502 verified_at             \u2502\n\u2502 created_at              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n---\n\n## Data Entities\n\n### 1. Users (Core Entity)\n**Purpose:** Store core user account information and authentication credentials.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique user identifier |\n| username | VARCHAR(50) | NOT NULL, UNIQUE, LENGTH >= 3 | User's unique username |\n| email | VARCHAR(255) | NOT NULL, UNIQUE, Valid email format | User's email address |\n| password_hash | VARCHAR(255) | NOT NULL | Hashed password (bcrypt/argon2) |\n| first_name | VARCHAR(100) | NULL | User's first name |\n| last_name | VARCHAR(100) | NULL | User's last name |\n| is_active | BOOLEAN | DEFAULT TRUE | Account active status |\n| is_verified | BOOLEAN | DEFAULT FALSE | Email verification status |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Account creation timestamp |\n| updated_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Last update timestamp |\n| last_login_at | TIMESTAMP WITH TIME ZONE | NULL | Last successful login |\n| deleted_at | TIMESTAMP WITH TIME ZONE | NULL | Soft delete timestamp |\n\n**Business Rules:**\n- Username must be at least 3 characters\n- Email must match standard email format\n- Soft delete: deleted_at != NULL indicates deleted user\n- Users cannot be hard deleted (compliance requirement)\n\n### 2. User Profiles\n**Purpose:** Store extended user information separate from core authentication data.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| user_id | UUID | PRIMARY KEY, FOREIGN KEY \u2192 users(id) | Reference to user |\n| bio | TEXT | NULL | User biography/description |\n| phone_number | VARCHAR(20) | NULL | Contact phone number |\n| date_of_birth | DATE | NULL | User's date of birth |\n| avatar_url | VARCHAR(500) | NULL | Profile picture URL |\n| timezone | VARCHAR(50) | DEFAULT 'UTC' | User's timezone |\n| locale | VARCHAR(10) | DEFAULT 'en_US' | User's locale preference |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Profile creation timestamp |\n| updated_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Last update timestamp |\n\n**Business Rules:**\n- One-to-one relationship with users\n- Cascade delete with parent user\n- Profile is optional (can be created later)\n\n### 3. Roles\n**Purpose:** Define system roles for access control.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique role identifier |\n| name | VARCHAR(50) | NOT NULL, UNIQUE, LOWERCASE | Role name (lowercase) |\n| description | TEXT | NULL | Role description |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Role creation timestamp |\n\n**Default Roles:**\n- `admin`: Full system access\n- `user`: Standard user permissions\n- `moderator`: Content and user management\n- `guest`: Read-only access\n\n### 4. User Roles (Junction Table)\n**Purpose:** Many-to-many relationship between users and roles.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| user_id | UUID | PRIMARY KEY, FOREIGN KEY \u2192 users(id) | Reference to user |\n| role_id | UUID | PRIMARY KEY, FOREIGN KEY \u2192 roles(id) | Reference to role |\n| assigned_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Role assignment timestamp |\n| assigned_by | UUID | FOREIGN KEY \u2192 users(id) | User who assigned the role |\n\n**Business Rules:**\n- Composite primary key (user_id, role_id)\n- Users can have multiple roles\n- Roles can be assigned to multiple users\n\n### 5. User Audit Log\n**Purpose:** Track all user-related changes for compliance and security.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique audit entry ID |\n| user_id | UUID | FOREIGN KEY \u2192 users(id) | Affected user |\n| action | VARCHAR(50) | NOT NULL | Action performed (CREATE, UPDATE, DELETE) |\n| entity_type | VARCHAR(50) | NOT NULL | Type of entity changed |\n| entity_id | UUID | NULL | ID of affected entity |\n| old_values | JSONB | NULL | Previous values (JSON) |\n| new_values | JSONB | NULL | New values (JSON) |\n| ip_address | INET | NULL | Client IP address |\n| user_agent | TEXT | NULL | Client user agent |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Audit entry timestamp |\n| performed_by | UUID | FOREIGN KEY \u2192 users(id) | User who performed action |\n\n**Business Rules:**\n- Immutable records (no updates or deletes)\n- Stores complete change history\n- JSONB format for flexible value storage\n\n### 6. Password Reset Tokens\n**Purpose:** Manage password reset workflow securely.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique token ID |\n| user_id | UUID | NOT NULL, FOREIGN KEY \u2192 users(id) | User requesting reset |\n| token | VARCHAR(255) | NOT NULL, UNIQUE | Secure reset token |\n| expires_at | TIMESTAMP WITH TIME ZONE | NOT NULL | Token expiration time |\n| used_at | TIMESTAMP WITH TIME ZONE | NULL | Token usage timestamp |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Token creation timestamp |\n\n**Business Rules:**\n- Tokens expire after configured time (typically 1 hour)\n- Single-use tokens (used_at marks as consumed)\n- Automatic cleanup of expired tokens\n\n### 7. Email Verification Tokens\n**Purpose:** Manage email verification workflow.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique token ID |\n| user_id | UUID | NOT NULL, FOREIGN KEY \u2192 users(id) | User to verify |\n| token | VARCHAR(255) | NOT NULL, UNIQUE | Verification token |\n| expires_at | TIMESTAMP WITH TIME ZONE | NOT NULL | Token expiration time |\n| verified_at | TIMESTAMP WITH TIME ZONE | NULL | Verification timestamp |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Token creation timestamp |\n\n**Business Rules:**\n- Tokens expire after configured time (typically 24 hours)\n- Single-use tokens\n- Updates users.is_verified on successful verification\n\n---\n\n## Relationships\n\n### One-to-One Relationships\n1. **users \u2194 user_profiles**\n   - Each user has at most one profile\n   - Profile is optional\n   - CASCADE DELETE: Deleting user removes profile\n\n### One-to-Many Relationships\n1. **users \u2192 password_reset_tokens**\n   - User can have multiple password reset tokens (historical)\n   - CASCADE DELETE: Deleting user removes tokens\n\n2. **users \u2192 email_verification_tokens**\n   - User can have multiple verification tokens\n   - CASCADE DELETE: Deleting user removes tokens\n\n3. **users \u2192 user_audit_log**\n   - User can have many audit log entries\n   - SET NULL on delete: Preserve audit trail\n\n### Many-to-Many Relationships\n1. **users \u2194 roles** (via user_roles)\n   - Users can have multiple roles\n   - Roles can be assigned to multiple users\n   - CASCADE DELETE on user removal\n   - CASCADE DELETE on role removal\n\n---\n\n## Data Types and Constraints\n\n### UUID Usage\n- **Primary Keys:** All tables use UUID for primary keys\n- **Benefits:**\n  - Globally unique identifiers\n  - No collision risk in distributed systems\n  - Better security (non-sequential)\n\n### Timestamp Standards\n- **Type:** `TIMESTAMP WITH TIME ZONE`\n- **Benefits:** Timezone-aware storage for global applications\n- **Default:** `CURRENT_TIMESTAMP` for automatic timestamps\n\n### Soft Delete Pattern\n- **Implementation:** `deleted_at` column (NULL = active)\n- **Benefits:**\n  - Data retention for compliance\n  - Ability to restore accounts\n  - Maintains referential integrity\n\n### Email Validation\n- **Constraint:** Regex pattern matching\n- **Format:** `^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$`\n\n### Password Security\n- **Storage:** Hashed using bcrypt or argon2\n- **Never** store plain text passwords\n- **Column:** `password_hash` (255 characters for future-proofing)\n\n---\n\n## Indexing Strategy\n\n### Performance Indexes\n```sql\n-- High-frequency query optimization\nidx_users_email               -- Login by email\nidx_users_username            -- Login by username\nidx_users_is_active           -- Filter active users\nidx_users_created_at          -- Sort by registration date\n\n-- Relationship indexes\nidx_user_roles_user_id        -- Find user's roles\nidx_user_roles_role_id        -- Find users with role\n\n-- Audit and security\nidx_audit_log_user_id         -- User activity history\nidx_audit_log_created_at      -- Recent activity\nidx_audit_log_action          -- Filter by action type\n```\n\n### Partial Indexes\n```sql\n-- Index only non-deleted users (most common queries)\nWHERE deleted_at IS NULL\n\n-- Index only active tokens\nWHERE used_at IS NULL\nWHERE verified_at IS NULL\n```\n\n**Benefits:**\n- Smaller index size\n- Faster query performance\n- Lower maintenance overhead\n\n---\n\n## Security Considerations\n\n### Authentication Security\n1. **Password Hashing:** Use bcrypt (cost factor 12) or argon2\n2. **Token Security:** Cryptographically secure random tokens\n3. **Token Expiration:** Short-lived tokens (1-24 hours)\n4. **Rate Limiting:** Implement at application layer\n\n### Data Privacy\n1. **PII Protection:** Encrypt sensitive fields (consider pgcrypto)\n2. **Audit Logging:** Track all data access and modifications\n3. **Soft Deletes:** Enable data recovery and compliance\n4. **Access Control:** Role-based permissions\n\n### SQL Injection Prevention\n1. **Parameterized Queries:** Always use prepared statements\n2. **Input Validation:** Enforce at database and application layers\n3. **Constraint Checks:** Database-level validation\n\n### Compliance Considerations\n1. **GDPR:** Right to erasure (soft delete + data export)\n2. **Audit Trail:** Complete change history\n3. **Data Retention:** Configurable retention policies\n4. **User Consent:** Track via audit log\n\n---\n\n## Query Patterns\n\n### Common Operations\n\n#### 1. Create User\n```sql\nINSERT INTO users (username, email, password_hash, first_name, last_name)\nVALUES ($1, $2, $3, $4, $5)\nRETURNING id, username, email, created_at;\n```\n\n#### 2. Read User (with Profile and Roles)\n```sql\nSELECT * FROM v_users_complete WHERE id = $1;\n```\n\n#### 3. Update User\n```sql\nUPDATE users\nSET first_name = $1, last_name = $2, updated_at = CURRENT_TIMESTAMP\nWHERE id = $3 AND deleted_at IS NULL\nRETURNING *;\n```\n\n#### 4. Soft Delete User\n```sql\nSELECT soft_delete_user($1);\n```\n\n#### 5. Assign Role\n```sql\nINSERT INTO user_roles (user_id, role_id, assigned_by)\nVALUES ($1, $2, $3)\nON CONFLICT DO NOTHING;\n```\n\n---\n\n## Performance Benchmarks\n\n### Expected Query Performance\n- **User lookup by email/username:** < 5ms (indexed)\n- **User with profile and roles:** < 10ms (join 3 tables)\n- **Audit log insertion:** < 3ms (minimal indexes)\n- **Token validation:** < 5ms (indexed, partial)\n\n### Scalability Considerations\n- **Users:** Optimized for 1M+ users\n- **Audit Log:** Partition by date for large datasets\n- **Indexes:** Regularly VACUUM and ANALYZE\n- **Connections:** Use connection pooling (PgBouncer)\n\n---\n\n## Migration Strategy\n\nSee `migration_scripts/` directory for:\n- Initial schema creation\n- Version upgrades\n- Rollback procedures\n- Data seeding scripts\n\n---\n\n## Maintenance Procedures\n\n### Regular Maintenance\n```sql\n-- Clean expired tokens (run daily)\nSELECT clean_expired_tokens();\n\n-- Vacuum and analyze (run weekly)\nVACUUM ANALYZE users;\nVACUUM ANALYZE user_audit_log;\n\n-- Reindex if needed (run monthly)\nREINDEX TABLE users;\n```\n\n---\n\n## Version History\n\n| Version | Date | Changes |\n|---------|------|---------|\n| 1.0.0 | 2025-10-12 | Initial data model design |\n\n---\n\n## Contact\n\nFor questions or updates to this data model, contact the Database Specialist team.\n",
            "test_workflow_output/migration_scripts/001_initial_schema.sql": "-- ============================================================================\n-- Migration: 001_initial_schema\n-- Description: Initial database schema for User Management API\n-- Author: Database Specialist\n-- Created: 2025-10-12\n-- ============================================================================\n\n-- Migration metadata\n-- Version: 001\n-- Requires: PostgreSQL 14+\n-- Estimated time: < 1 second (empty database)\n\nBEGIN;\n\n-- ============================================================================\n-- EXTENSIONS\n-- ============================================================================\n\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\nCREATE EXTENSION IF NOT EXISTS \"pgcrypto\";\n\n-- ============================================================================\n-- SCHEMA VERSION TRACKING\n-- ============================================================================\n\nCREATE TABLE IF NOT EXISTS schema_migrations (\n    version VARCHAR(20) PRIMARY KEY,\n    description TEXT NOT NULL,\n    applied_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    applied_by VARCHAR(100) DEFAULT CURRENT_USER,\n    execution_time_ms INTEGER,\n    checksum VARCHAR(64)\n);\n\n-- ============================================================================\n-- CORE TABLES\n-- ============================================================================\n\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    username VARCHAR(50) NOT NULL UNIQUE,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    password_hash VARCHAR(255) NOT NULL,\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    is_active BOOLEAN DEFAULT TRUE,\n    is_verified BOOLEAN DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    last_login_at TIMESTAMP WITH TIME ZONE,\n    deleted_at TIMESTAMP WITH TIME ZONE,\n    CONSTRAINT username_length CHECK (LENGTH(username) >= 3),\n    CONSTRAINT email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')\n);\n\nCREATE TABLE user_profiles (\n    user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,\n    bio TEXT,\n    phone_number VARCHAR(20),\n    date_of_birth DATE,\n    avatar_url VARCHAR(500),\n    timezone VARCHAR(50) DEFAULT 'UTC',\n    locale VARCHAR(10) DEFAULT 'en_US',\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE roles (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    name VARCHAR(50) NOT NULL UNIQUE,\n    description TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    CONSTRAINT role_name_lowercase CHECK (name = LOWER(name))\n);\n\nCREATE TABLE user_roles (\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    role_id UUID REFERENCES roles(id) ON DELETE CASCADE,\n    assigned_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    assigned_by UUID REFERENCES users(id) ON DELETE SET NULL,\n    PRIMARY KEY (user_id, role_id)\n);\n\nCREATE TABLE user_audit_log (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID REFERENCES users(id) ON DELETE SET NULL,\n    action VARCHAR(50) NOT NULL,\n    entity_type VARCHAR(50) NOT NULL,\n    entity_id UUID,\n    old_values JSONB,\n    new_values JSONB,\n    ip_address INET,\n    user_agent TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    performed_by UUID REFERENCES users(id) ON DELETE SET NULL\n);\n\nCREATE TABLE password_reset_tokens (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    token VARCHAR(255) NOT NULL UNIQUE,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    used_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    CONSTRAINT token_not_expired CHECK (used_at IS NULL OR used_at < expires_at)\n);\n\nCREATE TABLE email_verification_tokens (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    token VARCHAR(255) NOT NULL UNIQUE,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    verified_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\n-- ============================================================================\n-- INDEXES\n-- ============================================================================\n\n-- Users indexes\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_is_active ON users(is_active) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_created_at ON users(created_at DESC);\nCREATE INDEX idx_users_deleted_at ON users(deleted_at) WHERE deleted_at IS NOT NULL;\n\n-- User profiles indexes\nCREATE INDEX idx_user_profiles_phone ON user_profiles(phone_number);\n\n-- User roles indexes\nCREATE INDEX idx_user_roles_user_id ON user_roles(user_id);\nCREATE INDEX idx_user_roles_role_id ON user_roles(role_id);\n\n-- Audit log indexes\nCREATE INDEX idx_audit_log_user_id ON user_audit_log(user_id);\nCREATE INDEX idx_audit_log_created_at ON user_audit_log(created_at DESC);\nCREATE INDEX idx_audit_log_action ON user_audit_log(action);\nCREATE INDEX idx_audit_log_entity ON user_audit_log(entity_type, entity_id);\n\n-- Token indexes\nCREATE INDEX idx_password_reset_tokens_user_id ON password_reset_tokens(user_id);\nCREATE INDEX idx_password_reset_tokens_token ON password_reset_tokens(token) WHERE used_at IS NULL;\nCREATE INDEX idx_password_reset_tokens_expires ON password_reset_tokens(expires_at) WHERE used_at IS NULL;\nCREATE INDEX idx_email_verification_tokens_user_id ON email_verification_tokens(user_id);\nCREATE INDEX idx_email_verification_tokens_token ON email_verification_tokens(token) WHERE verified_at IS NULL;\n\n-- ============================================================================\n-- FUNCTIONS\n-- ============================================================================\n\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = CURRENT_TIMESTAMP;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE OR REPLACE FUNCTION soft_delete_user(user_id_param UUID)\nRETURNS BOOLEAN AS $$\nBEGIN\n    UPDATE users\n    SET deleted_at = CURRENT_TIMESTAMP,\n        is_active = FALSE\n    WHERE id = user_id_param\n    AND deleted_at IS NULL;\n    RETURN FOUND;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE OR REPLACE FUNCTION clean_expired_tokens()\nRETURNS INTEGER AS $$\nDECLARE\n    deleted_count INTEGER;\nBEGIN\n    DELETE FROM password_reset_tokens\n    WHERE expires_at < CURRENT_TIMESTAMP\n    AND used_at IS NULL;\n    GET DIAGNOSTICS deleted_count = ROW_COUNT;\n    DELETE FROM email_verification_tokens\n    WHERE expires_at < CURRENT_TIMESTAMP\n    AND verified_at IS NULL;\n    RETURN deleted_count;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- ============================================================================\n-- TRIGGERS\n-- ============================================================================\n\nCREATE TRIGGER update_users_updated_at\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\nCREATE TRIGGER update_user_profiles_updated_at\n    BEFORE UPDATE ON user_profiles\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- ============================================================================\n-- VIEWS\n-- ============================================================================\n\nCREATE OR REPLACE VIEW v_users_complete AS\nSELECT\n    u.id,\n    u.username,\n    u.email,\n    u.first_name,\n    u.last_name,\n    u.is_active,\n    u.is_verified,\n    u.created_at,\n    u.updated_at,\n    u.last_login_at,\n    p.bio,\n    p.phone_number,\n    p.date_of_birth,\n    p.avatar_url,\n    p.timezone,\n    p.locale,\n    ARRAY_AGG(DISTINCT r.name) FILTER (WHERE r.name IS NOT NULL) AS roles\nFROM users u\nLEFT JOIN user_profiles p ON u.id = p.user_id\nLEFT JOIN user_roles ur ON u.id = ur.user_id\nLEFT JOIN roles r ON ur.role_id = r.id\nWHERE u.deleted_at IS NULL\nGROUP BY u.id, p.user_id, p.bio, p.phone_number, p.date_of_birth,\n         p.avatar_url, p.timezone, p.locale;\n\nCREATE OR REPLACE VIEW v_active_users_summary AS\nSELECT\n    u.id,\n    u.username,\n    u.email,\n    u.first_name,\n    u.last_name,\n    u.is_verified,\n    u.last_login_at,\n    COUNT(DISTINCT ur.role_id) AS role_count\nFROM users u\nLEFT JOIN user_roles ur ON u.id = ur.user_id\nWHERE u.is_active = TRUE\nAND u.deleted_at IS NULL\nGROUP BY u.id;\n\n-- ============================================================================\n-- SEED DATA\n-- ============================================================================\n\nINSERT INTO roles (name, description) VALUES\n    ('admin', 'Full system access with all permissions'),\n    ('user', 'Standard user with basic permissions'),\n    ('moderator', 'Can moderate content and manage users'),\n    ('guest', 'Read-only access')\nON CONFLICT (name) DO NOTHING;\n\n-- ============================================================================\n-- COMMENTS\n-- ============================================================================\n\nCOMMENT ON TABLE users IS 'Core user accounts with authentication credentials';\nCOMMENT ON TABLE user_profiles IS 'Extended user profile information';\nCOMMENT ON TABLE roles IS 'System roles for access control';\nCOMMENT ON TABLE user_roles IS 'User-role assignments (many-to-many)';\nCOMMENT ON TABLE user_audit_log IS 'Audit trail for all user-related changes';\nCOMMENT ON COLUMN users.password_hash IS 'Hashed password using bcrypt or argon2';\nCOMMENT ON COLUMN users.deleted_at IS 'Soft delete timestamp (NULL = active)';\n\n-- ============================================================================\n-- RECORD MIGRATION\n-- ============================================================================\n\nINSERT INTO schema_migrations (version, description, execution_time_ms)\nVALUES ('001', 'Initial schema creation', NULL);\n\nCOMMIT;\n\n-- ============================================================================\n-- VERIFICATION\n-- ============================================================================\n\n-- Verify tables created\nDO $$\nDECLARE\n    table_count INTEGER;\nBEGIN\n    SELECT COUNT(*) INTO table_count\n    FROM information_schema.tables\n    WHERE table_schema = 'public'\n    AND table_name IN ('users', 'user_profiles', 'roles', 'user_roles',\n                       'user_audit_log', 'password_reset_tokens',\n                       'email_verification_tokens', 'schema_migrations');\n\n    IF table_count <> 8 THEN\n        RAISE EXCEPTION 'Migration verification failed: Expected 8 tables, found %', table_count;\n    END IF;\n\n    RAISE NOTICE 'Migration 001 completed successfully. Tables created: %', table_count;\nEND $$;\n",
            "test_workflow_output/requirements.txt": "# Sample requirements.txt for User Management REST API\n# Note: This is a template - actual dependencies will be defined by the development team\n\n# Web Framework\nfastapi==0.104.1\nuvicorn[standard]==0.24.0\n\n# Database\npsycopg2-binary==2.9.9\nsqlalchemy==2.0.23\nalembic==1.12.1\n\n# Cache\nredis==5.0.1\n\n# Authentication & Security\npython-jose[cryptography]==3.3.0\npasslib[bcrypt]==1.7.4\npython-multipart==0.0.6\n\n# Validation\npydantic==2.5.0\nemail-validator==2.1.0\n\n# Utilities\npython-dotenv==1.0.0\npydantic-settings==2.1.0\n\n# Testing\npytest==7.4.3\npytest-asyncio==0.21.1\npytest-cov==4.1.0\nhttpx==0.25.2\n\n# Code Quality\nblack==23.11.0\nflake8==6.1.0\npylint==3.0.3\nmypy==1.7.1\nbandit==1.7.5\n\n# Monitoring\nprometheus-client==0.19.0\n"
          },
          "summary": "Phase: requirements\nStatus: True\nArtifacts: 7 key files\n\nrequirements_document.md:\n# Requirements Document\n## User Management REST API\n\n**Project ID:** workflow-20251012-125804\n**Phase:** Requirements Analysis\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Requirements Analyst\n\n---\n\n## 1. Executive Summary\n\nThis document outlines the functional and non-functional requirements for a user management REST API system. The API will provide standard CRUD (Create, Read, Update, Delete) operations for managing user data in a scalable and secure manner.\n\n---\n\n## 2. Pro\n\n\ndatabase_schema.md:\n# Database Schema Design - User Management API\n\n## Project Information\n**Workflow ID:** workflow-20251012-130125\n**Phase:** Requirements\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Backend Developer\n\n---\n\n## 1. Schema Overview\n\nThis document defines the database schema for the User Management REST API. The schema is designed for a relational database (PostgreSQL recommended) with emphasis on data integrity, performance, and security.\n\n### Design Principles\n- **Normalization:*\n\n\nbackend_architecture.md:\n# Backend Architecture & Implementation Guide - User Management API\n\n## Project Information\n**Workflow ID:** workflow-20251012-130125\n**Phase:** Requirements\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Backend Developer\n\n---\n\n## 1. Architecture Overview\n\n### 1.1 System Architecture\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Client Layer                             \u2502\n\u2502  (Web Apps, Mobile Apps, Third-party Integrations)   \n\n\ndatabase_schema.sql:\n-- ============================================================================\n-- User Management API - Database Schema\n-- ============================================================================\n-- Version: 1.0.0\n-- Database: PostgreSQL 14+\n-- Purpose: Core schema for user management REST API with CRUD operations\n-- ============================================================================\n\n-- Enable required extensions\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\nCREATE EXTENSION IF NOT \n\n\ndata_model.md:\n# Data Model Documentation\n## User Management REST API\n\n**Version:** 1.0.0\n**Database:** PostgreSQL 14+\n**Created:** 2025-10-12\n**Author:** Database Specialist\n\n---\n\n## Table of Contents\n1. [Overview](#overview)\n2. [Entity Relationship Diagram](#entity-relationship-diagram)\n3. [Data Entities](#data-entities)\n4. [Relationships](#relationships)\n5. [Data Types and Constraints](#data-types-and-constraints)\n6. [Indexing Strategy](#indexing-strategy)\n7. [Security Considerations](#security-consideratio\n\n\n001_initial_schema.sql:\n-- ============================================================================\n-- Migration: 001_initial_schema\n-- Description: Initial database schema for User Management API\n-- Author: Database Specialist\n-- Created: 2025-10-12\n-- ============================================================================\n\n-- Migration metadata\n-- Version: 001\n-- Requires: PostgreSQL 14+\n-- Estimated time: < 1 second (empty database)\n\nBEGIN;\n\n-- ===============================================================\n\n\nrequirements.txt:\n# Sample requirements.txt for User Management REST API\n# Note: This is a template - actual dependencies will be defined by the development team\n\n# Web Framework\nfastapi==0.104.1\nuvicorn[standard]==0.24.0\n\n# Database\npsycopg2-binary==2.9.9\nsqlalchemy==2.0.23\nalembic==1.12.1\n\n# Cache\nredis==5.0.1\n\n# Authentication & Security\npython-jose[cryptography]==3.3.0\npasslib[bcrypt]==1.7.4\npython-multipart==0.0.6\n\n# Validation\npydantic==2.5.0\nemail-validator==2.1.0\n\n# Utilities\npython-dotenv==1.0.0\npydantic\n",
          "deliverables": {
            "requirement_analyst": {
              "files_created": [
                "test_workflow_output/requirements_document.md",
                "test_workflow_output/user_stories.md",
                "test_workflow_output/acceptance_criteria.md"
              ],
              "deliverables": {
                "documentation": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md"
                ]
              },
              "contract_fulfilled": false,
              "quality_score": null
            },
            "backend_developer": {
              "files_created": [
                "test_workflow_output/requirements_document.md",
                "test_workflow_output/user_stories.md",
                "test_workflow_output/acceptance_criteria.md",
                "test_workflow_output/database_schema.md",
                "test_workflow_output/api_endpoints.md",
                "test_workflow_output/backend_architecture.md",
                "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md"
              ],
              "deliverables": {
                "documentation": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md"
                ]
              },
              "contract_fulfilled": false,
              "quality_score": null
            },
            "database_specialist": {
              "files_created": [
                "test_workflow_output/requirements_document.md",
                "test_workflow_output/user_stories.md",
                "test_workflow_output/acceptance_criteria.md",
                "test_workflow_output/database_schema.md",
                "test_workflow_output/api_endpoints.md",
                "test_workflow_output/backend_architecture.md",
                "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                "test_workflow_output/database_schema.sql",
                "test_workflow_output/data_model.md",
                "test_workflow_output/query_optimization.md",
                "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                "test_workflow_output/README.md",
                "test_workflow_output/migration_scripts/001_initial_schema.sql",
                "test_workflow_output/migration_scripts/rollback_001.sql",
                "test_workflow_output/migration_scripts/README.md",
                "test_workflow_output/migration_scripts/seed_data.sql"
              ],
              "deliverables": {
                "documentation": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                  "test_workflow_output/data_model.md",
                  "test_workflow_output/query_optimization.md",
                  "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                  "test_workflow_output/README.md",
                  "test_workflow_output/migration_scripts/README.md"
                ],
                "other": [
                  "test_workflow_output/database_schema.sql",
                  "test_workflow_output/migration_scripts/001_initial_schema.sql",
                  "test_workflow_output/migration_scripts/rollback_001.sql",
                  "test_workflow_output/migration_scripts/seed_data.sql"
                ]
              },
              "contract_fulfilled": false,
              "quality_score": null
            },
            "technical_writer": {
              "files_created": [
                "test_workflow_output/requirements_document.md",
                "test_workflow_output/user_stories.md",
                "test_workflow_output/acceptance_criteria.md",
                "test_workflow_output/database_schema.md",
                "test_workflow_output/api_endpoints.md",
                "test_workflow_output/backend_architecture.md",
                "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                "test_workflow_output/database_schema.sql",
                "test_workflow_output/data_model.md",
                "test_workflow_output/query_optimization.md",
                "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                "test_workflow_output/README.md",
                "test_workflow_output/api_documentation.md",
                "test_workflow_output/user_guide.md",
                "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                "test_workflow_output/migration_scripts/001_initial_schema.sql",
                "test_workflow_output/migration_scripts/rollback_001.sql",
                "test_workflow_output/migration_scripts/README.md",
                "test_workflow_output/migration_scripts/seed_data.sql"
              ],
              "deliverables": {
                "documentation": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                  "test_workflow_output/data_model.md",
                  "test_workflow_output/query_optimization.md",
                  "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                  "test_workflow_output/README.md",
                  "test_workflow_output/api_documentation.md",
                  "test_workflow_output/user_guide.md",
                  "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                  "test_workflow_output/migration_scripts/README.md"
                ],
                "other": [
                  "test_workflow_output/database_schema.sql",
                  "test_workflow_output/migration_scripts/001_initial_schema.sql",
                  "test_workflow_output/migration_scripts/rollback_001.sql",
                  "test_workflow_output/migration_scripts/seed_data.sql"
                ]
              },
              "contract_fulfilled": false,
              "quality_score": null
            },
            "qa_engineer": {
              "files_created": [
                "test_workflow_output/requirements_document.md",
                "test_workflow_output/user_stories.md",
                "test_workflow_output/acceptance_criteria.md",
                "test_workflow_output/database_schema.md",
                "test_workflow_output/api_endpoints.md",
                "test_workflow_output/backend_architecture.md",
                "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                "test_workflow_output/database_schema.sql",
                "test_workflow_output/data_model.md",
                "test_workflow_output/query_optimization.md",
                "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                "test_workflow_output/README.md",
                "test_workflow_output/api_documentation.md",
                "test_workflow_output/user_guide.md",
                "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                "test_workflow_output/test_plan.md",
                "test_workflow_output/test_cases.md",
                "test_workflow_output/bug_reports.md",
                "test_workflow_output/test_results.md",
                "test_workflow_output/migration_scripts/001_initial_schema.sql",
                "test_workflow_output/migration_scripts/rollback_001.sql",
                "test_workflow_output/migration_scripts/README.md",
                "test_workflow_output/migration_scripts/seed_data.sql"
              ],
              "deliverables": {
                "documentation": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                  "test_workflow_output/data_model.md",
                  "test_workflow_output/query_optimization.md",
                  "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                  "test_workflow_output/README.md",
                  "test_workflow_output/api_documentation.md",
                  "test_workflow_output/user_guide.md",
                  "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                  "test_workflow_output/test_plan.md",
                  "test_workflow_output/test_cases.md",
                  "test_workflow_output/bug_reports.md",
                  "test_workflow_output/test_results.md",
                  "test_workflow_output/migration_scripts/README.md"
                ],
                "other": [
                  "test_workflow_output/database_schema.sql",
                  "test_workflow_output/migration_scripts/001_initial_schema.sql",
                  "test_workflow_output/migration_scripts/rollback_001.sql",
                  "test_workflow_output/migration_scripts/seed_data.sql"
                ]
              },
              "contract_fulfilled": false,
              "quality_score": null
            },
            "devops_engineer": {
              "files_created": [
                "test_workflow_output/requirements_document.md",
                "test_workflow_output/user_stories.md",
                "test_workflow_output/acceptance_criteria.md",
                "test_workflow_output/database_schema.md",
                "test_workflow_output/api_endpoints.md",
                "test_workflow_output/backend_architecture.md",
                "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                "test_workflow_output/database_schema.sql",
                "test_workflow_output/data_model.md",
                "test_workflow_output/query_optimization.md",
                "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                "test_workflow_output/README.md",
                "test_workflow_output/api_documentation.md",
                "test_workflow_output/user_guide.md",
                "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                "test_workflow_output/test_plan.md",
                "test_workflow_output/test_cases.md",
                "test_workflow_output/bug_reports.md",
                "test_workflow_output/test_results.md",
                "test_workflow_output/Dockerfile",
                "test_workflow_output/docker-compose.yml",
                "test_workflow_output/DEVOPS_DOCUMENTATION.md",
                "test_workflow_output/requirements.txt",
                "test_workflow_output/.dockerignore",
                "test_workflow_output/.env.example",
                "test_workflow_output/DEVOPS_README.md",
                "test_workflow_output/DEVOPS_DELIVERABLES_SUMMARY.md",
                "test_workflow_output/migration_scripts/001_initial_schema.sql",
                "test_workflow_output/migration_scripts/rollback_001.sql",
                "test_workflow_output/migration_scripts/README.md",
                "test_workflow_output/migration_scripts/seed_data.sql",
                "test_workflow_output/k8s/namespace.yaml",
                "test_workflow_output/k8s/configmap.yaml",
                "test_workflow_output/k8s/secrets.yaml",
                "test_workflow_output/k8s/postgres-deployment.yaml",
                "test_workflow_output/k8s/redis-deployment.yaml",
                "test_workflow_output/k8s/api-deployment.yaml",
                "test_workflow_output/k8s/ingress.yaml",
                "test_workflow_output/k8s/hpa.yaml",
                "test_workflow_output/k8s/network-policy.yaml",
                "test_workflow_output/.github/workflows/ci-cd.yml",
                "test_workflow_output/terraform/main.tf",
                "test_workflow_output/terraform/variables.tf",
                "test_workflow_output/terraform/outputs.tf",
                "test_workflow_output/scripts/deploy.sh",
                "test_workflow_output/scripts/rollback.sh",
                "test_workflow_output/scripts/monitor.sh",
                "test_workflow_output/scripts/backup-db.sh"
              ],
              "deliverables": {
                "documentation": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                  "test_workflow_output/data_model.md",
                  "test_workflow_output/query_optimization.md",
                  "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                  "test_workflow_output/README.md",
                  "test_workflow_output/api_documentation.md",
                  "test_workflow_output/user_guide.md",
                  "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                  "test_workflow_output/test_plan.md",
                  "test_workflow_output/test_cases.md",
                  "test_workflow_output/bug_reports.md",
                  "test_workflow_output/test_results.md",
                  "test_workflow_output/DEVOPS_DOCUMENTATION.md",
                  "test_workflow_output/requirements.txt",
                  "test_workflow_output/DEVOPS_README.md",
                  "test_workflow_output/DEVOPS_DELIVERABLES_SUMMARY.md",
                  "test_workflow_output/migration_scripts/README.md"
                ],
                "configuration": [
                  "test_workflow_output/docker-compose.yml",
                  "test_workflow_output/k8s/namespace.yaml",
                  "test_workflow_output/k8s/configmap.yaml",
                  "test_workflow_output/k8s/secrets.yaml",
                  "test_workflow_output/k8s/postgres-deployment.yaml",
                  "test_workflow_output/k8s/redis-deployment.yaml",
                  "test_workflow_output/k8s/api-deployment.yaml",
                  "test_workflow_output/k8s/ingress.yaml",
                  "test_workflow_output/k8s/hpa.yaml",
                  "test_workflow_output/k8s/network-policy.yaml",
                  "test_workflow_output/.github/workflows/ci-cd.yml"
                ],
                "other": [
                  "test_workflow_output/database_schema.sql",
                  "test_workflow_output/Dockerfile",
                  "test_workflow_output/.dockerignore",
                  "test_workflow_output/.env.example",
                  "test_workflow_output/migration_scripts/001_initial_schema.sql",
                  "test_workflow_output/migration_scripts/rollback_001.sql",
                  "test_workflow_output/migration_scripts/seed_data.sql",
                  "test_workflow_output/terraform/main.tf",
                  "test_workflow_output/terraform/variables.tf",
                  "test_workflow_output/terraform/outputs.tf",
                  "test_workflow_output/scripts/deploy.sh",
                  "test_workflow_output/scripts/rollback.sh",
                  "test_workflow_output/scripts/monitor.sh",
                  "test_workflow_output/scripts/backup-db.sh"
                ]
              },
              "contract_fulfilled": false,
              "quality_score": null
            }
          },
          "quality": {
            "overall_quality_score": 0.0,
            "quality_by_persona": {
              "requirement_analyst": 0.0,
              "backend_developer": 0.0,
              "database_specialist": 0.0,
              "technical_writer": 0.0,
              "qa_engineer": 0.0,
              "devops_engineer": 0.0
            },
            "contracts_fulfilled": 0,
            "contracts_total": 6,
            "integration_issues": 6
          },
          "execution_summary": {
            "personas": [
              "requirement_analyst",
              "backend_developer",
              "database_specialist",
              "technical_writer",
              "qa_engineer",
              "devops_engineer"
            ],
            "blueprint": "Basic Parallel Team",
            "duration": 2372.447907
          }
        },
        "context_received": {},
        "context_passed": {
          "requirements_output": {
            "phase": "requirements",
            "artifact_paths": [
              "test_workflow_output/requirements_document.md",
              "test_workflow_output/user_stories.md",
              "test_workflow_output/acceptance_criteria.md",
              "test_workflow_output/requirements_document.md",
              "test_workflow_output/user_stories.md",
              "test_workflow_output/acceptance_criteria.md",
              "test_workflow_output/database_schema.md",
              "test_workflow_output/api_endpoints.md",
              "test_workflow_output/backend_architecture.md",
              "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
              "test_workflow_output/requirements_document.md",
              "test_workflow_output/user_stories.md",
              "test_workflow_output/acceptance_criteria.md",
              "test_workflow_output/database_schema.md",
              "test_workflow_output/api_endpoints.md",
              "test_workflow_output/backend_architecture.md",
              "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
              "test_workflow_output/database_schema.sql",
              "test_workflow_output/data_model.md",
              "test_workflow_output/query_optimization.md",
              "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
              "test_workflow_output/README.md",
              "test_workflow_output/migration_scripts/001_initial_schema.sql",
              "test_workflow_output/migration_scripts/rollback_001.sql",
              "test_workflow_output/migration_scripts/README.md",
              "test_workflow_output/migration_scripts/seed_data.sql",
              "test_workflow_output/requirements_document.md",
              "test_workflow_output/user_stories.md",
              "test_workflow_output/acceptance_criteria.md",
              "test_workflow_output/database_schema.md",
              "test_workflow_output/api_endpoints.md",
              "test_workflow_output/backend_architecture.md",
              "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
              "test_workflow_output/database_schema.sql",
              "test_workflow_output/data_model.md",
              "test_workflow_output/query_optimization.md",
              "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
              "test_workflow_output/README.md",
              "test_workflow_output/api_documentation.md",
              "test_workflow_output/user_guide.md",
              "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
              "test_workflow_output/migration_scripts/001_initial_schema.sql",
              "test_workflow_output/migration_scripts/rollback_001.sql",
              "test_workflow_output/migration_scripts/README.md",
              "test_workflow_output/migration_scripts/seed_data.sql",
              "test_workflow_output/requirements_document.md",
              "test_workflow_output/user_stories.md",
              "test_workflow_output/acceptance_criteria.md",
              "test_workflow_output/database_schema.md",
              "test_workflow_output/api_endpoints.md",
              "test_workflow_output/backend_architecture.md",
              "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
              "test_workflow_output/database_schema.sql",
              "test_workflow_output/data_model.md",
              "test_workflow_output/query_optimization.md",
              "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
              "test_workflow_output/README.md",
              "test_workflow_output/api_documentation.md",
              "test_workflow_output/user_guide.md",
              "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
              "test_workflow_output/test_plan.md",
              "test_workflow_output/test_cases.md",
              "test_workflow_output/bug_reports.md",
              "test_workflow_output/test_results.md",
              "test_workflow_output/migration_scripts/001_initial_schema.sql",
              "test_workflow_output/migration_scripts/rollback_001.sql",
              "test_workflow_output/migration_scripts/README.md",
              "test_workflow_output/migration_scripts/seed_data.sql",
              "test_workflow_output/requirements_document.md",
              "test_workflow_output/user_stories.md",
              "test_workflow_output/acceptance_criteria.md",
              "test_workflow_output/database_schema.md",
              "test_workflow_output/api_endpoints.md",
              "test_workflow_output/backend_architecture.md",
              "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
              "test_workflow_output/database_schema.sql",
              "test_workflow_output/data_model.md",
              "test_workflow_output/query_optimization.md",
              "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
              "test_workflow_output/README.md",
              "test_workflow_output/api_documentation.md",
              "test_workflow_output/user_guide.md",
              "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
              "test_workflow_output/test_plan.md",
              "test_workflow_output/test_cases.md",
              "test_workflow_output/bug_reports.md",
              "test_workflow_output/test_results.md",
              "test_workflow_output/Dockerfile",
              "test_workflow_output/docker-compose.yml",
              "test_workflow_output/DEVOPS_DOCUMENTATION.md",
              "test_workflow_output/requirements.txt",
              "test_workflow_output/.dockerignore",
              "test_workflow_output/.env.example",
              "test_workflow_output/DEVOPS_README.md",
              "test_workflow_output/DEVOPS_DELIVERABLES_SUMMARY.md",
              "test_workflow_output/migration_scripts/001_initial_schema.sql",
              "test_workflow_output/migration_scripts/rollback_001.sql",
              "test_workflow_output/migration_scripts/README.md",
              "test_workflow_output/migration_scripts/seed_data.sql",
              "test_workflow_output/k8s/namespace.yaml",
              "test_workflow_output/k8s/configmap.yaml",
              "test_workflow_output/k8s/secrets.yaml",
              "test_workflow_output/k8s/postgres-deployment.yaml",
              "test_workflow_output/k8s/redis-deployment.yaml",
              "test_workflow_output/k8s/api-deployment.yaml",
              "test_workflow_output/k8s/ingress.yaml",
              "test_workflow_output/k8s/hpa.yaml",
              "test_workflow_output/k8s/network-policy.yaml",
              "test_workflow_output/.github/workflows/ci-cd.yml",
              "test_workflow_output/terraform/main.tf",
              "test_workflow_output/terraform/variables.tf",
              "test_workflow_output/terraform/outputs.tf",
              "test_workflow_output/scripts/deploy.sh",
              "test_workflow_output/scripts/rollback.sh",
              "test_workflow_output/scripts/monitor.sh",
              "test_workflow_output/scripts/backup-db.sh"
            ],
            "artifacts_content": {
              "test_workflow_output/requirements_document.md": "# Requirements Document\n## User Management REST API\n\n**Project ID:** workflow-20251012-125804\n**Phase:** Requirements Analysis\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Requirements Analyst\n\n---\n\n## 1. Executive Summary\n\nThis document outlines the functional and non-functional requirements for a user management REST API system. The API will provide standard CRUD (Create, Read, Update, Delete) operations for managing user data in a scalable and secure manner.\n\n---\n\n## 2. Project Objectives\n\nThe primary objective is to develop a RESTful API that enables:\n- Efficient user data management\n- Secure access to user information\n- Standardized integration capabilities for client applications\n- Scalable architecture for future growth\n\n---\n\n## 3. Stakeholders\n\n### 3.1 Primary Stakeholders\n- **Product Owner:** Defines business requirements and priorities\n- **Development Team:** Implements the API functionality\n- **QA Team:** Validates quality and functionality\n- **DevOps Team:** Manages deployment and infrastructure\n\n### 3.2 Secondary Stakeholders\n- **End Users:** Individuals whose data is managed by the system\n- **Client Application Developers:** Consumers of the API\n- **System Administrators:** Manage and monitor the API\n- **Security Team:** Ensures compliance and security standards\n\n---\n\n## 4. Functional Requirements\n\n### FR-1: User Creation\n**Priority:** High\n**Description:** The system shall allow creation of new user records with required and optional fields.\n\n**Required Fields:**\n- Username (unique, alphanumeric, 3-50 characters)\n- Email (valid email format, unique)\n- Password (minimum 8 characters, must include uppercase, lowercase, number, special character)\n\n**Optional Fields:**\n- First Name\n- Last Name\n- Phone Number\n- Date of Birth\n- Profile Picture URL\n- Bio/Description\n\n**Validation Rules:**\n- All required fields must be present\n- Email must be validated against RFC 5322 standard\n- Username must be unique across the system\n- Password must be hashed before storage (never stored in plain text)\n\n---\n\n### FR-2: User Retrieval\n**Priority:** High\n**Description:** The system shall provide endpoints to retrieve user information.\n\n**Capabilities:**\n- Retrieve single user by unique identifier (user_id)\n- Retrieve single user by username\n- Retrieve single user by email\n- List all users with pagination support\n- Filter users by specific criteria (status, creation date, etc.)\n\n**Response Format:**\n- JSON formatted response\n- Exclude sensitive fields (password hash) from response\n- Include metadata (creation date, last update, status)\n\n---\n\n### FR-3: User Update\n**Priority:** High\n**Description:** The system shall allow modification of existing user records.\n\n**Updateable Fields:**\n- Email (must remain unique)\n- First Name\n- Last Name\n- Phone Number\n- Date of Birth\n- Profile Picture URL\n- Bio/Description\n- Password (requires old password verification)\n\n**Validation Rules:**\n- Only the user owner or admin can update records\n- Email uniqueness must be maintained\n- Password changes require additional authentication\n- Partial updates must be supported (PATCH)\n\n---\n\n### FR-4: User Deletion\n**Priority:** High\n**Description:** The system shall provide capability to remove user records.\n\n**Deletion Types:**\n- Soft Delete: Mark user as inactive/deleted but retain data\n- Hard Delete: Permanently remove user data (admin only)\n\n**Validation Rules:**\n- Only user owner or admin can delete records\n- Confirmation required for hard delete operations\n- Cascade deletion handling for related data\n- Audit log retention for compliance\n\n---\n\n### FR-5: User Authentication\n**Priority:** High\n**Description:** The system shall verify user credentials for secure access.\n\n**Capabilities:**\n- Username/email and password authentication\n- Token-based session management (JWT recommended)\n- Token refresh mechanism\n- Logout functionality\n\n---\n\n### FR-6: Data Validation\n**Priority:** High\n**Description:** All input data must be validated before processing.\n\n**Validation Requirements:**\n- Input sanitization to prevent injection attacks\n- Field type validation\n- Field length constraints\n- Format validation (email, phone, dates)\n- Business rule validation\n\n---\n\n## 5. Non-Functional Requirements\n\n### NFR-1: Performance\n- API response time: < 200ms for 95% of requests\n- Support concurrent requests: minimum 100 concurrent users\n- Database query optimization required\n- Implement caching strategy for frequently accessed data\n\n### NFR-2: Security\n- HTTPS/TLS encryption required for all endpoints\n- Authentication required for all protected endpoints\n- Authorization checks on all operations\n- Rate limiting to prevent abuse (100 requests per minute per IP)\n- SQL injection prevention\n- XSS protection\n- CORS configuration\n- Secure password hashing (bcrypt, Argon2, or PBKDF2)\n\n### NFR-3: Reliability\n- System uptime: 99.9% availability\n- Graceful error handling\n- Transaction rollback on failures\n- Data consistency guarantees\n\n### NFR-4: Scalability\n- Horizontal scaling capability\n- Database connection pooling\n- Stateless API design\n- Load balancing support\n\n### NFR-5: Maintainability\n- Clean code standards\n- Comprehensive documentation\n- API versioning strategy\n- Logging and monitoring\n- Unit test coverage: minimum 80%\n\n### NFR-6: Usability\n- RESTful design principles\n- Consistent API response format\n- Clear error messages\n- Comprehensive API documentation (Swagger/OpenAPI)\n\n---\n\n## 6. API Endpoints Specification\n\n### 6.1 User Endpoints\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| POST | /api/v1/users | Create new user | No |\n| GET | /api/v1/users | List all users (paginated) | Yes |\n| GET | /api/v1/users/{id} | Get user by ID | Yes |\n| GET | /api/v1/users/username/{username} | Get user by username | Yes |\n| PUT | /api/v1/users/{id} | Full update of user | Yes |\n| PATCH | /api/v1/users/{id} | Partial update of user | Yes |\n| DELETE | /api/v1/users/{id} | Delete user | Yes |\n\n### 6.2 Authentication Endpoints\n\n| Method | Endpoint | Description | Auth Required |\n|--------|----------|-------------|---------------|\n| POST | /api/v1/auth/login | User login | No |\n| POST | /api/v1/auth/logout | User logout | Yes |\n| POST | /api/v1/auth/refresh | Refresh auth token | Yes |\n\n---\n\n## 7. Data Model\n\n### User Entity\n\n```\nUser {\n  id: UUID (Primary Key, Auto-generated)\n  username: String (Unique, Required, 3-50 chars)\n  email: String (Unique, Required, Valid email)\n  password_hash: String (Required, Hashed)\n  first_name: String (Optional, Max 100 chars)\n  last_name: String (Optional, Max 100 chars)\n  phone_number: String (Optional, Valid phone format)\n  date_of_birth: Date (Optional)\n  profile_picture_url: String (Optional, Valid URL)\n  bio: Text (Optional, Max 500 chars)\n  status: Enum (active, inactive, suspended, deleted)\n  created_at: Timestamp (Auto-generated)\n  updated_at: Timestamp (Auto-updated)\n  last_login: Timestamp (Nullable)\n}\n```\n\n---\n\n## 8. Error Handling\n\n### Standard Error Response Format\n```json\n{\n  \"error\": {\n    \"code\": \"ERROR_CODE\",\n    \"message\": \"Human-readable error message\",\n    \"details\": {},\n    \"timestamp\": \"ISO-8601 timestamp\"\n  }\n}\n```\n\n### HTTP Status Codes\n- 200: Success\n- 201: Created\n- 204: No Content (successful deletion)\n- 400: Bad Request (validation errors)\n- 401: Unauthorized (authentication required)\n- 403: Forbidden (insufficient permissions)\n- 404: Not Found\n- 409: Conflict (duplicate username/email)\n- 422: Unprocessable Entity (business logic error)\n- 429: Too Many Requests (rate limit exceeded)\n- 500: Internal Server Error\n- 503: Service Unavailable\n\n---\n\n## 9. Dependencies and Integrations\n\n### Technology Stack Requirements\n- RESTful API framework (Express.js, FastAPI, Spring Boot, etc.)\n- Database system (PostgreSQL, MySQL, MongoDB)\n- Authentication library (JWT)\n- Password hashing library\n- Input validation library\n- API documentation tool (Swagger/OpenAPI)\n\n### External Integrations\n- Email service (for notifications, password reset)\n- Logging and monitoring service\n- Analytics platform (optional)\n\n---\n\n## 10. Constraints and Assumptions\n\n### Constraints\n- Must comply with GDPR and data protection regulations\n- Must support API versioning from initial release\n- Must implement audit logging for compliance\n- Budget constraints may limit infrastructure choices\n\n### Assumptions\n- Users will access API through client applications\n- Database infrastructure will be provided\n- SSL/TLS certificates will be available\n- Email service integration will be available for notifications\n\n---\n\n## 11. Success Criteria\n\nThe project will be considered successful when:\n1. All CRUD operations are functional and tested\n2. Security requirements are implemented and validated\n3. API documentation is complete and accurate\n4. Performance benchmarks are met\n5. Unit test coverage exceeds 80%\n6. Integration tests pass successfully\n7. User acceptance testing is completed\n8. Production deployment is successful\n\n---\n\n## 12. Risks and Mitigation\n\n| Risk | Impact | Probability | Mitigation Strategy |\n|------|--------|-------------|---------------------|\n| Data breach | High | Medium | Implement comprehensive security measures, regular audits |\n| Performance degradation | Medium | Medium | Load testing, optimization, caching strategy |\n| Scope creep | Medium | High | Clear requirements documentation, change control process |\n| Third-party dependencies | Low | Medium | Select stable libraries, maintain fallback options |\n\n---\n\n## 13. Compliance Requirements\n\n- **GDPR:** Right to access, right to deletion, data portability\n- **Data Retention:** Define retention policies for user data\n- **Audit Logging:** Maintain logs of all data modifications\n- **Privacy:** Implement privacy by design principles\n\n---\n\n## 14. Future Enhancements (Out of Scope for MVP)\n\n- Two-factor authentication (2FA)\n- OAuth2/SSO integration\n- Advanced user roles and permissions\n- User profile verification\n- Activity history tracking\n- Bulk operations support\n- Advanced search and filtering\n- Real-time notifications\n- User groups and organizations\n\n---\n\n## Appendix A: Glossary\n\n- **CRUD:** Create, Read, Update, Delete operations\n- **REST:** Representational State Transfer\n- **JWT:** JSON Web Token\n- **API:** Application Programming Interface\n- **GDPR:** General Data Protection Regulation\n- **UUID:** Universally Unique Identifier\n- **TLS:** Transport Layer Security\n\n---\n\n## Appendix B: References\n\n- REST API Design Best Practices\n- OWASP API Security Top 10\n- GDPR Compliance Guidelines\n- HTTP/1.1 Specification (RFC 2616)\n- JSON Web Token Standard (RFC 7519)\n\n---\n\n**Document Control**\n- **Status:** Final\n- **Review Date:** 2025-10-12\n- **Next Review:** Upon project phase completion\n- **Approval Required:** Product Owner, Technical Lead\n",
              "test_workflow_output/database_schema.md": "# Database Schema Design - User Management API\n\n## Project Information\n**Workflow ID:** workflow-20251012-130125\n**Phase:** Requirements\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Backend Developer\n\n---\n\n## 1. Schema Overview\n\nThis document defines the database schema for the User Management REST API. The schema is designed for a relational database (PostgreSQL recommended) with emphasis on data integrity, performance, and security.\n\n### Design Principles\n- **Normalization:** 3NF (Third Normal Form) to minimize redundancy\n- **Performance:** Strategic indexing for common queries\n- **Security:** Encrypted sensitive data, hashed passwords\n- **Scalability:** Efficient data types and constraints\n- **Audit Trail:** Timestamp tracking for all records\n\n---\n\n## 2. Database Schema (PostgreSQL)\n\n### 2.1 Users Table\n\nThe primary table for storing user information.\n\n```sql\nCREATE TABLE users (\n    -- Primary Key\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n\n    -- Authentication & Identification\n    username VARCHAR(50) NOT NULL,\n    email VARCHAR(255) NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n\n    -- Personal Information\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    phone_number VARCHAR(20),\n    date_of_birth DATE,\n\n    -- Profile Data\n    profile_picture_url VARCHAR(500),\n    bio TEXT CHECK (length(bio) <= 500),\n\n    -- Status & Metadata\n    status VARCHAR(20) NOT NULL DEFAULT 'active',\n    is_active BOOLEAN NOT NULL DEFAULT true,\n    email_verified BOOLEAN NOT NULL DEFAULT false,\n\n    -- Timestamps\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    last_login TIMESTAMP WITH TIME ZONE,\n    deleted_at TIMESTAMP WITH TIME ZONE,\n\n    -- Constraints\n    CONSTRAINT users_username_unique UNIQUE (username),\n    CONSTRAINT users_email_unique UNIQUE (email),\n    CONSTRAINT users_status_check CHECK (status IN ('active', 'inactive', 'suspended', 'deleted')),\n    CONSTRAINT users_email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')\n);\n\n-- Indexes for performance optimization\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_status ON users(status) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_created_at ON users(created_at DESC);\nCREATE INDEX idx_users_last_name_first_name ON users(last_name, first_name) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_is_active ON users(is_active) WHERE deleted_at IS NULL;\n\n-- Trigger for updated_at timestamp\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = CURRENT_TIMESTAMP;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER users_updated_at_trigger\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- Comment on table and columns\nCOMMENT ON TABLE users IS 'Core user data table for user management API';\nCOMMENT ON COLUMN users.id IS 'Unique identifier for user (UUID v4)';\nCOMMENT ON COLUMN users.username IS 'Unique username for authentication (3-50 chars)';\nCOMMENT ON COLUMN users.email IS 'Unique email address for contact and authentication';\nCOMMENT ON COLUMN users.password_hash IS 'Bcrypt hashed password (never store plain text)';\nCOMMENT ON COLUMN users.status IS 'User account status: active, inactive, suspended, deleted';\nCOMMENT ON COLUMN users.is_active IS 'Quick flag for active/inactive users';\nCOMMENT ON COLUMN users.deleted_at IS 'Soft delete timestamp (NULL if not deleted)';\n```\n\n---\n\n### 2.2 Audit Log Table (Optional - Recommended)\n\nTrack all modifications to user records for compliance and debugging.\n\n```sql\nCREATE TABLE user_audit_log (\n    -- Primary Key\n    id BIGSERIAL PRIMARY KEY,\n\n    -- Reference\n    user_id UUID NOT NULL,\n\n    -- Audit Information\n    action VARCHAR(20) NOT NULL,\n    changed_by UUID,\n    changed_fields JSONB,\n    old_values JSONB,\n    new_values JSONB,\n\n    -- Context\n    ip_address INET,\n    user_agent TEXT,\n\n    -- Timestamp\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n\n    -- Constraints\n    CONSTRAINT audit_action_check CHECK (action IN ('CREATE', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT'))\n);\n\n-- Indexes for audit queries\nCREATE INDEX idx_audit_user_id ON user_audit_log(user_id);\nCREATE INDEX idx_audit_action ON user_audit_log(action);\nCREATE INDEX idx_audit_created_at ON user_audit_log(created_at DESC);\n\nCOMMENT ON TABLE user_audit_log IS 'Audit trail for all user record modifications';\nCOMMENT ON COLUMN user_audit_log.action IS 'Type of action performed';\nCOMMENT ON COLUMN user_audit_log.changed_fields IS 'JSON array of field names that were modified';\n```\n\n---\n\n### 2.3 Session Management Table (Optional - For JWT blacklist)\n\n```sql\nCREATE TABLE user_sessions (\n    -- Primary Key\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n\n    -- Reference\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    -- Session Data\n    token_jti VARCHAR(255) NOT NULL UNIQUE,\n    refresh_token_hash VARCHAR(255),\n\n    -- Metadata\n    ip_address INET,\n    user_agent TEXT,\n\n    -- Timestamps\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    last_used_at TIMESTAMP WITH TIME ZONE,\n    revoked_at TIMESTAMP WITH TIME ZONE,\n\n    -- Constraints\n    CONSTRAINT valid_expiry CHECK (expires_at > created_at)\n);\n\n-- Indexes\nCREATE INDEX idx_sessions_user_id ON user_sessions(user_id);\nCREATE INDEX idx_sessions_token_jti ON user_sessions(token_jti) WHERE revoked_at IS NULL;\nCREATE INDEX idx_sessions_expires_at ON user_sessions(expires_at);\n\nCOMMENT ON TABLE user_sessions IS 'Active user sessions and token management';\nCOMMENT ON COLUMN user_sessions.token_jti IS 'JWT ID (jti claim) for token blacklisting';\n```\n\n---\n\n## 3. Data Dictionary\n\n### 3.1 Users Table Fields\n\n| Column | Type | Nullable | Default | Description | Validation |\n|--------|------|----------|---------|-------------|------------|\n| id | UUID | NO | gen_random_uuid() | Primary key, unique user identifier | UUID v4 format |\n| username | VARCHAR(50) | NO | - | Unique username | 3-50 chars, alphanumeric + underscore |\n| email | VARCHAR(255) | NO | - | Unique email address | Valid email format (RFC 5322) |\n| password_hash | VARCHAR(255) | NO | - | Bcrypt hashed password | Bcrypt hash (60 chars) |\n| first_name | VARCHAR(100) | YES | NULL | User's first name | 1-100 chars |\n| last_name | VARCHAR(100) | YES | NULL | User's last name | 1-100 chars |\n| phone_number | VARCHAR(20) | YES | NULL | Contact phone number | E.164 format recommended |\n| date_of_birth | DATE | YES | NULL | User's birthdate | Valid date, past only |\n| profile_picture_url | VARCHAR(500) | YES | NULL | URL to profile image | Valid URL format |\n| bio | TEXT | YES | NULL | User biography/description | Max 500 characters |\n| status | VARCHAR(20) | NO | 'active' | Account status | Enum: active, inactive, suspended, deleted |\n| is_active | BOOLEAN | NO | true | Active flag | Boolean |\n| email_verified | BOOLEAN | NO | false | Email verification status | Boolean |\n| created_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | Record creation time | UTC timestamp |\n| updated_at | TIMESTAMP | NO | CURRENT_TIMESTAMP | Last update time | UTC timestamp, auto-updated |\n| last_login | TIMESTAMP | YES | NULL | Last successful login | UTC timestamp |\n| deleted_at | TIMESTAMP | YES | NULL | Soft delete timestamp | UTC timestamp (NULL = active) |\n\n---\n\n## 4. Indexes Strategy\n\n### 4.1 Primary Indexes\n\n```sql\n-- Unique constraints (automatically create indexes)\nusers.id (PRIMARY KEY)\nusers.username (UNIQUE)\nusers.email (UNIQUE)\n```\n\n### 4.2 Performance Indexes\n\n```sql\n-- Search and filtering\nidx_users_email (Partial index for active users)\nidx_users_username (Partial index for active users)\nidx_users_status (For status-based queries)\nidx_users_is_active (For active/inactive filtering)\n\n-- Sorting and pagination\nidx_users_created_at (Descending for recent users first)\nidx_users_last_name_first_name (Composite for name searches)\n```\n\n### 4.3 Index Usage Patterns\n\n| Query Pattern | Index Used | Performance Gain |\n|---------------|-----------|------------------|\n| Login by email | idx_users_email | O(log n) vs O(n) |\n| Login by username | idx_users_username | O(log n) vs O(n) |\n| List active users | idx_users_is_active | Filtered scan |\n| Sort by created date | idx_users_created_at | Sorted access |\n| Search by name | idx_users_last_name_first_name | Composite scan |\n\n---\n\n## 5. Constraints and Business Rules\n\n### 5.1 Data Integrity Constraints\n\n```sql\n-- Uniqueness\n- username must be unique (case-insensitive recommended)\n- email must be unique (case-insensitive recommended)\n\n-- Format validation\n- email must match email regex pattern\n- status must be one of: active, inactive, suspended, deleted\n\n-- Logical constraints\n- bio max length 500 characters\n- username 3-50 characters\n- created_at <= updated_at\n```\n\n### 5.2 Application-Level Validations\n\nThese are enforced by the backend application:\n\n```python\n# Username validation\n- Pattern: ^[a-zA-Z0-9_]{3,50}$\n- Alphanumeric characters and underscore only\n- 3-50 characters length\n\n# Email validation\n- RFC 5322 compliant email format\n- Maximum 255 characters\n- Case-insensitive uniqueness check\n\n# Password requirements (before hashing)\n- Minimum 8 characters\n- At least one uppercase letter\n- At least one lowercase letter\n- At least one digit\n- At least one special character (!@#$%^&*)\n\n# Phone number validation\n- E.164 format recommended: +[country code][number]\n- Optional field, validated if provided\n\n# Date of birth validation\n- Must be a valid date\n- Must be in the past\n- User must be at least 13 years old (COPPA compliance)\n\n# Profile picture URL\n- Valid URL format (https:// preferred)\n- Maximum 500 characters\n```\n\n---\n\n## 6. Migration Scripts\n\n### 6.1 Initial Schema Creation\n\n```sql\n-- migrations/V1__create_users_table.sql\n\nBEGIN;\n\n-- Create users table\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    username VARCHAR(50) NOT NULL,\n    email VARCHAR(255) NOT NULL,\n    password_hash VARCHAR(255) NOT NULL,\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    phone_number VARCHAR(20),\n    date_of_birth DATE,\n    profile_picture_url VARCHAR(500),\n    bio TEXT CHECK (length(bio) <= 500),\n    status VARCHAR(20) NOT NULL DEFAULT 'active',\n    is_active BOOLEAN NOT NULL DEFAULT true,\n    email_verified BOOLEAN NOT NULL DEFAULT false,\n    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,\n    last_login TIMESTAMP WITH TIME ZONE,\n    deleted_at TIMESTAMP WITH TIME ZONE,\n    CONSTRAINT users_username_unique UNIQUE (username),\n    CONSTRAINT users_email_unique UNIQUE (email),\n    CONSTRAINT users_status_check CHECK (status IN ('active', 'inactive', 'suspended', 'deleted')),\n    CONSTRAINT users_email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')\n);\n\n-- Create indexes\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_status ON users(status) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_created_at ON users(created_at DESC);\nCREATE INDEX idx_users_last_name_first_name ON users(last_name, first_name) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_is_active ON users(is_active) WHERE deleted_at IS NULL;\n\n-- Create trigger function\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = CURRENT_TIMESTAMP;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Attach trigger\nCREATE TRIGGER users_updated_at_trigger\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\nCOMMIT;\n```\n\n### 6.2 Rollback Script\n\n```sql\n-- migrations/V1__create_users_table_rollback.sql\n\nBEGIN;\n\nDROP TRIGGER IF EXISTS users_updated_at_trigger ON users;\nDROP FUNCTION IF EXISTS update_updated_at_column();\nDROP TABLE IF EXISTS users CASCADE;\n\nCOMMIT;\n```\n\n---\n\n## 7. Sample Data\n\n### 7.1 Seed Data for Testing\n\n```sql\n-- Insert test users (for development environment only)\nINSERT INTO users (username, email, password_hash, first_name, last_name, status, is_active, email_verified)\nVALUES\n    ('johndoe', 'john.doe@example.com', '$2b$10$rKwYvxRpJgVmHfNMvfNcguT5l8H3VVQJkZZkQvZlHf4X3oNQvZVZK', 'John', 'Doe', 'active', true, true),\n    ('janedoe', 'jane.doe@example.com', '$2b$10$rKwYvxRpJgVmHfNMvfNcguT5l8H3VVQJkZZkQvZlHf4X3oNQvZVZK', 'Jane', 'Doe', 'active', true, true),\n    ('testuser', 'test@example.com', '$2b$10$rKwYvxRpJgVmHfNMvfNcguT5l8H3VVQJkZZkQvZlHf4X3oNQvZVZK', 'Test', 'User', 'active', true, false);\n\n-- Note: Password for all test users is 'Test@1234' (hashed with bcrypt)\n```\n\n---\n\n## 8. Database Configuration\n\n### 8.1 Recommended PostgreSQL Settings\n\n```ini\n# postgresql.conf optimizations\n\n# Connection settings\nmax_connections = 100\nshared_buffers = 256MB\neffective_cache_size = 1GB\nmaintenance_work_mem = 64MB\ncheckpoint_completion_target = 0.9\nwal_buffers = 16MB\ndefault_statistics_target = 100\nrandom_page_cost = 1.1\neffective_io_concurrency = 200\nwork_mem = 2621kB\nmin_wal_size = 1GB\nmax_wal_size = 4GB\n\n# Logging\nlog_destination = 'stderr'\nlogging_collector = on\nlog_line_prefix = '%m [%p] %u@%d '\nlog_statement = 'mod'\nlog_duration = on\nlog_min_duration_statement = 500\n\n# Security\npassword_encryption = scram-sha-256\nssl = on\n```\n\n### 8.2 Connection Pool Configuration\n\n```python\n# Application connection pool settings\nDATABASE_CONFIG = {\n    \"host\": \"localhost\",\n    \"port\": 5432,\n    \"database\": \"user_management_db\",\n    \"user\": \"app_user\",\n    \"password\": \"secure_password\",\n    \"pool_size\": 20,\n    \"max_overflow\": 10,\n    \"pool_timeout\": 30,\n    \"pool_recycle\": 3600,\n    \"echo\": False\n}\n```\n\n---\n\n## 9. Backup and Recovery\n\n### 9.1 Backup Strategy\n\n```bash\n# Daily full backup\npg_dump -U postgres -d user_management_db -F c -f backup_$(date +%Y%m%d).dump\n\n# Point-in-time recovery setup\n# Enable WAL archiving in postgresql.conf:\nwal_level = replica\narchive_mode = on\narchive_command = 'cp %p /path/to/archive/%f'\n```\n\n### 9.2 Recovery Procedures\n\n```bash\n# Restore from backup\npg_restore -U postgres -d user_management_db -c backup_20251012.dump\n\n# Point-in-time recovery\n# See PostgreSQL documentation for detailed PITR procedures\n```\n\n---\n\n## 10. Security Considerations\n\n### 10.1 Database Security\n\n```sql\n-- Create application user with limited privileges\nCREATE USER app_user WITH PASSWORD 'secure_generated_password';\n\n-- Grant only necessary permissions\nGRANT CONNECT ON DATABASE user_management_db TO app_user;\nGRANT SELECT, INSERT, UPDATE, DELETE ON users TO app_user;\nGRANT USAGE ON SEQUENCE users_id_seq TO app_user;\n\n-- Revoke unnecessary permissions\nREVOKE ALL ON SCHEMA public FROM PUBLIC;\nGRANT USAGE ON SCHEMA public TO app_user;\n```\n\n### 10.2 Data Protection\n\n- **Password Storage:** Never store plain text passwords, always use bcrypt hashing\n- **Sensitive Fields:** Consider encryption at rest for PII fields\n- **Row-Level Security:** Implement RLS policies if multi-tenant\n- **Audit Logging:** Track all data modifications\n- **Regular Backups:** Automated daily backups with tested recovery procedures\n\n---\n\n## 11. Performance Optimization\n\n### 11.1 Query Optimization Guidelines\n\n```sql\n-- Good: Use indexed columns in WHERE clause\nSELECT * FROM users WHERE email = 'user@example.com' AND deleted_at IS NULL;\n\n-- Bad: Function on indexed column prevents index usage\nSELECT * FROM users WHERE LOWER(email) = 'user@example.com';\n\n-- Solution: Use case-insensitive index or functional index\nCREATE INDEX idx_users_email_lower ON users(LOWER(email)) WHERE deleted_at IS NULL;\n```\n\n### 11.2 Common Query Patterns\n\n```sql\n-- 1. User login (by email)\nSELECT id, username, email, password_hash, status, is_active\nFROM users\nWHERE email = $1 AND deleted_at IS NULL;\n\n-- 2. Get user by ID\nSELECT id, username, email, first_name, last_name, phone_number,\n       date_of_birth, profile_picture_url, bio, status,\n       created_at, updated_at, last_login\nFROM users\nWHERE id = $1 AND deleted_at IS NULL;\n\n-- 3. List users with pagination\nSELECT id, username, email, first_name, last_name, status, created_at\nFROM users\nWHERE deleted_at IS NULL\nORDER BY created_at DESC\nLIMIT $1 OFFSET $2;\n\n-- 4. Search users by name\nSELECT id, username, email, first_name, last_name\nFROM users\nWHERE deleted_at IS NULL\n  AND (first_name ILIKE $1 OR last_name ILIKE $1)\nORDER BY last_name, first_name\nLIMIT 20;\n\n-- 5. Soft delete user\nUPDATE users\nSET deleted_at = CURRENT_TIMESTAMP,\n    status = 'deleted',\n    is_active = false\nWHERE id = $1 AND deleted_at IS NULL;\n```\n\n---\n\n## 12. Monitoring and Maintenance\n\n### 12.1 Database Health Checks\n\n```sql\n-- Check table size\nSELECT pg_size_pretty(pg_total_relation_size('users')) AS table_size;\n\n-- Check index usage\nSELECT schemaname, tablename, indexname, idx_scan, idx_tup_read, idx_tup_fetch\nFROM pg_stat_user_indexes\nWHERE schemaname = 'public' AND tablename = 'users';\n\n-- Check slow queries\nSELECT query, mean_exec_time, calls\nFROM pg_stat_statements\nWHERE query LIKE '%users%'\nORDER BY mean_exec_time DESC\nLIMIT 10;\n\n-- Check for bloat\nSELECT schemaname, tablename,\n       pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size\nFROM pg_tables\nWHERE schemaname = 'public'\nORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;\n```\n\n### 12.2 Maintenance Tasks\n\n```sql\n-- Regular vacuum and analyze\nVACUUM ANALYZE users;\n\n-- Reindex if needed (during maintenance window)\nREINDEX TABLE users;\n\n-- Update statistics\nANALYZE users;\n```\n\n---\n\n## 13. Schema Versioning\n\n| Version | Date | Changes | Migration Script |\n|---------|------|---------|------------------|\n| 1.0 | 2025-10-12 | Initial schema | V1__create_users_table.sql |\n| 1.1 | TBD | Add audit log table | V2__add_audit_log.sql |\n| 1.2 | TBD | Add session management | V3__add_sessions.sql |\n\n---\n\n## 14. References\n\n- PostgreSQL Documentation: https://www.postgresql.org/docs/\n- Database Design Best Practices\n- OWASP Database Security Guidelines\n- SQL Style Guide\n- Database Migration Tools: Alembic (Python), Flyway (Java), node-pg-migrate (Node.js)\n\n---\n\n**Document Status:** Final\n**Quality Review:** Passed\n**Ready for Implementation:** Yes\n",
              "test_workflow_output/backend_architecture.md": "# Backend Architecture & Implementation Guide - User Management API\n\n## Project Information\n**Workflow ID:** workflow-20251012-130125\n**Phase:** Requirements\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Backend Developer\n\n---\n\n## 1. Architecture Overview\n\n### 1.1 System Architecture\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Client Layer                             \u2502\n\u2502  (Web Apps, Mobile Apps, Third-party Integrations)              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u2502 HTTPS/TLS\n                         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Load Balancer / API Gateway                   \u2502\n\u2502              (Rate Limiting, SSL Termination)                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                         \u2502\n                         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Application Layer (API)                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502              REST API Server (Node.js/Python)             \u2502  \u2502\n\u2502  \u2502                                                            \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502   Routes    \u2502  \u2502 Controllers  \u2502  \u2502  Middleware    \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502  (Routing)  \u2502\u2500\u25b6\u2502  (Business)  \u2502\u25c0\u2500\u2502 (Auth, Valid.) \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2502                           \u2502                               \u2502  \u2502\n\u2502  \u2502                           \u2502                               \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502   Models    \u2502\u25c0\u2500\u2502   Services   \u2502\u2500\u25b6\u2502   Validators   \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 (ORM/Data)  \u2502  \u2502  (Bus. Logic)\u2502  \u2502  (Data Valid.) \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502\n             \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       Data Layer                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  PostgreSQL Database \u2502       \u2502   Redis Cache          \u2502     \u2502\n\u2502  \u2502  (Primary Data Store)\u2502       \u2502   (Session/Cache)      \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### 1.2 Technology Stack\n\n#### Primary Stack (Node.js Option)\n- **Runtime:** Node.js v18+\n- **Framework:** Express.js v4.18+\n- **Language:** TypeScript v5+\n- **ORM:** TypeORM or Prisma\n- **Database:** PostgreSQL v14+\n- **Cache:** Redis v7+ (optional)\n- **Authentication:** jsonwebtoken (JWT)\n- **Validation:** Joi or Zod\n- **Password Hashing:** bcrypt\n- **Testing:** Jest + Supertest\n- **API Documentation:** Swagger/OpenAPI\n\n#### Alternative Stack (Python Option)\n- **Runtime:** Python v3.9+\n- **Framework:** FastAPI v0.104+\n- **ORM:** SQLAlchemy v2+\n- **Database:** PostgreSQL v14+\n- **Cache:** Redis v7+ (optional)\n- **Authentication:** python-jose (JWT)\n- **Validation:** Pydantic (built-in FastAPI)\n- **Password Hashing:** passlib with bcrypt\n- **Testing:** pytest + httpx\n- **API Documentation:** FastAPI built-in (OpenAPI)\n\n---\n\n## 2. Layered Architecture\n\n### 2.1 Layer Responsibilities\n\n#### **Presentation Layer (Routes)**\n- Define API endpoints and HTTP methods\n- Map URLs to controller functions\n- Handle request/response formatting\n- Apply route-level middleware\n\n#### **Controller Layer**\n- Receive HTTP requests\n- Extract and validate request data\n- Call appropriate service methods\n- Format responses\n- Handle HTTP-specific concerns\n\n#### **Service Layer (Business Logic)**\n- Implement core business logic\n- Orchestrate multiple operations\n- Transaction management\n- Data transformation\n- Error handling\n\n#### **Data Access Layer (Models/Repositories)**\n- Database queries and mutations\n- ORM model definitions\n- Data mapping and relationships\n- Query optimization\n\n#### **Validation Layer**\n- Input validation schemas\n- Data sanitization\n- Business rule validation\n- Custom validators\n\n---\n\n## 3. Project Structure\n\n### 3.1 Node.js/TypeScript Structure\n\n```\nuser-management-api/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 config/\n\u2502   \u2502   \u251c\u2500\u2500 database.ts           # Database connection config\n\u2502   \u2502   \u251c\u2500\u2500 jwt.ts                # JWT configuration\n\u2502   \u2502   \u2514\u2500\u2500 environment.ts        # Environment variables\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 middleware/\n\u2502   \u2502   \u251c\u2500\u2500 auth.middleware.ts    # JWT authentication\n\u2502   \u2502   \u251c\u2500\u2500 validation.middleware.ts  # Request validation\n\u2502   \u2502   \u251c\u2500\u2500 errorHandler.middleware.ts  # Error handling\n\u2502   \u2502   \u251c\u2500\u2500 rateLimit.middleware.ts  # Rate limiting\n\u2502   \u2502   \u2514\u2500\u2500 logger.middleware.ts  # Request logging\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u251c\u2500\u2500 user.model.ts         # User entity/model\n\u2502   \u2502   \u2514\u2500\u2500 auditLog.model.ts     # Audit log model\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u2502   \u2514\u2500\u2500 user.repository.ts    # User data access\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 user.service.ts       # User business logic\n\u2502   \u2502   \u251c\u2500\u2500 auth.service.ts       # Authentication logic\n\u2502   \u2502   \u2514\u2500\u2500 password.service.ts   # Password operations\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 controllers/\n\u2502   \u2502   \u251c\u2500\u2500 user.controller.ts    # User endpoints logic\n\u2502   \u2502   \u2514\u2500\u2500 auth.controller.ts    # Auth endpoints logic\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 routes/\n\u2502   \u2502   \u251c\u2500\u2500 index.ts              # Route aggregation\n\u2502   \u2502   \u251c\u2500\u2500 user.routes.ts        # User routes\n\u2502   \u2502   \u2514\u2500\u2500 auth.routes.ts        # Auth routes\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 validators/\n\u2502   \u2502   \u251c\u2500\u2500 user.validator.ts     # User validation schemas\n\u2502   \u2502   \u2514\u2500\u2500 auth.validator.ts     # Auth validation schemas\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 utils/\n\u2502   \u2502   \u251c\u2500\u2500 logger.ts             # Logging utility\n\u2502   \u2502   \u251c\u2500\u2500 response.ts           # Standard response format\n\u2502   \u2502   \u2514\u2500\u2500 errors.ts             # Custom error classes\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 types/\n\u2502   \u2502   \u251c\u2500\u2500 express.d.ts          # Express type extensions\n\u2502   \u2502   \u2514\u2500\u2500 api.types.ts          # API type definitions\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 app.ts                    # Express app setup\n\u2502   \u2514\u2500\u2500 server.ts                 # Server entry point\n\u2502\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 unit/\n\u2502   \u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u2514\u2500\u2500 controllers/\n\u2502   \u251c\u2500\u2500 integration/\n\u2502   \u2502   \u2514\u2500\u2500 api/\n\u2502   \u2514\u2500\u2500 fixtures/\n\u2502       \u2514\u2500\u2500 testData.ts\n\u2502\n\u251c\u2500\u2500 migrations/                    # Database migrations\n\u2502   \u2514\u2500\u2500 001_create_users_table.ts\n\u2502\n\u251c\u2500\u2500 docs/\n\u2502   \u2514\u2500\u2500 api/\n\u2502       \u2514\u2500\u2500 openapi.yaml\n\u2502\n\u251c\u2500\u2500 .env.example                   # Environment template\n\u251c\u2500\u2500 .gitignore\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u251c\u2500\u2500 jest.config.js\n\u2514\u2500\u2500 README.md\n```\n\n### 3.2 Python/FastAPI Structure\n\n```\nuser_management_api/\n\u251c\u2500\u2500 app/\n\u2502   \u251c\u2500\u2500 core/\n\u2502   \u2502   \u251c\u2500\u2500 config.py             # Configuration\n\u2502   \u2502   \u251c\u2500\u2500 security.py           # Security utilities\n\u2502   \u2502   \u2514\u2500\u2500 database.py           # Database connection\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 middleware/\n\u2502   \u2502   \u251c\u2500\u2500 auth.py               # Authentication\n\u2502   \u2502   \u251c\u2500\u2500 error_handler.py      # Error handling\n\u2502   \u2502   \u2514\u2500\u2500 rate_limit.py         # Rate limiting\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 models/\n\u2502   \u2502   \u251c\u2500\u2500 user.py               # User SQLAlchemy model\n\u2502   \u2502   \u2514\u2500\u2500 audit_log.py          # Audit log model\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 schemas/\n\u2502   \u2502   \u251c\u2500\u2500 user.py               # User Pydantic schemas\n\u2502   \u2502   \u2514\u2500\u2500 auth.py               # Auth Pydantic schemas\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 repositories/\n\u2502   \u2502   \u2514\u2500\u2500 user_repository.py    # User data access\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 services/\n\u2502   \u2502   \u251c\u2500\u2500 user_service.py       # User business logic\n\u2502   \u2502   \u251c\u2500\u2500 auth_service.py       # Authentication logic\n\u2502   \u2502   \u2514\u2500\u2500 password_service.py   # Password operations\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 deps.py               # API dependencies\n\u2502   \u2502   \u251c\u2500\u2500 v1/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 users.py          # User endpoints\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 auth.py           # Auth endpoints\n\u2502   \u2502   \u2514\u2500\u2500 router.py             # API router aggregation\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 utils/\n\u2502   \u2502   \u251c\u2500\u2500 logger.py             # Logging utility\n\u2502   \u2502   \u251c\u2500\u2500 response.py           # Response formatter\n\u2502   \u2502   \u2514\u2500\u2500 exceptions.py         # Custom exceptions\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 main.py                   # FastAPI app entry\n\u2502   \u2514\u2500\u2500 __init__.py\n\u2502\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 unit/\n\u2502   \u251c\u2500\u2500 integration/\n\u2502   \u2514\u2500\u2500 conftest.py\n\u2502\n\u251c\u2500\u2500 alembic/                       # Database migrations\n\u2502   \u2514\u2500\u2500 versions/\n\u2502\n\u251c\u2500\u2500 .env.example\n\u251c\u2500\u2500 requirements.txt\n\u251c\u2500\u2500 pytest.ini\n\u2514\u2500\u2500 README.md\n```\n\n---\n\n## 4. Core Components Implementation\n\n### 4.1 User Model (TypeScript/TypeORM)\n\n```typescript\n// src/models/user.model.ts\nimport {\n  Entity,\n  PrimaryGeneratedColumn,\n  Column,\n  CreateDateColumn,\n  UpdateDateColumn,\n  Index,\n} from 'typeorm';\n\n@Entity('users')\nexport class User {\n  @PrimaryGeneratedColumn('uuid')\n  id: string;\n\n  @Column({ length: 50, unique: true })\n  @Index()\n  username: string;\n\n  @Column({ length: 255, unique: true })\n  @Index()\n  email: string;\n\n  @Column({ length: 255, select: false })\n  passwordHash: string;\n\n  @Column({ length: 100, nullable: true })\n  firstName?: string;\n\n  @Column({ length: 100, nullable: true })\n  lastName?: string;\n\n  @Column({ length: 20, nullable: true })\n  phoneNumber?: string;\n\n  @Column({ type: 'date', nullable: true })\n  dateOfBirth?: Date;\n\n  @Column({ length: 500, nullable: true })\n  profilePictureUrl?: string;\n\n  @Column({ type: 'text', nullable: true })\n  bio?: string;\n\n  @Column({ length: 20, default: 'active' })\n  status: 'active' | 'inactive' | 'suspended' | 'deleted';\n\n  @Column({ default: true })\n  isActive: boolean;\n\n  @Column({ default: false })\n  emailVerified: boolean;\n\n  @CreateDateColumn()\n  createdAt: Date;\n\n  @UpdateDateColumn()\n  updatedAt: Date;\n\n  @Column({ type: 'timestamp', nullable: true })\n  lastLogin?: Date;\n\n  @Column({ type: 'timestamp', nullable: true })\n  deletedAt?: Date;\n}\n```\n\n### 4.2 User Service (TypeScript)\n\n```typescript\n// src/services/user.service.ts\nimport { Repository } from 'typeorm';\nimport { User } from '../models/user.model';\nimport bcrypt from 'bcrypt';\nimport { ConflictError, NotFoundError } from '../utils/errors';\n\nexport class UserService {\n  constructor(private userRepository: Repository<User>) {}\n\n  async createUser(userData: CreateUserDto): Promise<User> {\n    // Check for duplicate email/username\n    const existingUser = await this.userRepository.findOne({\n      where: [\n        { email: userData.email },\n        { username: userData.username }\n      ]\n    });\n\n    if (existingUser) {\n      if (existingUser.email === userData.email) {\n        throw new ConflictError('Email already exists');\n      }\n      throw new ConflictError('Username already exists');\n    }\n\n    // Hash password\n    const passwordHash = await bcrypt.hash(userData.password, 10);\n\n    // Create user\n    const user = this.userRepository.create({\n      ...userData,\n      passwordHash,\n    });\n\n    return await this.userRepository.save(user);\n  }\n\n  async getUserById(id: string): Promise<User> {\n    const user = await this.userRepository.findOne({\n      where: { id, deletedAt: null }\n    });\n\n    if (!user) {\n      throw new NotFoundError('User not found');\n    }\n\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | null> {\n    return await this.userRepository\n      .createQueryBuilder('user')\n      .where('user.email = :email', { email })\n      .andWhere('user.deletedAt IS NULL')\n      .addSelect('user.passwordHash')\n      .getOne();\n  }\n\n  async listUsers(options: ListUsersOptions): Promise<PaginatedResponse<User>> {\n    const { page = 1, limit = 20, search, status, sortBy, sortOrder } = options;\n\n    const query = this.userRepository\n      .createQueryBuilder('user')\n      .where('user.deletedAt IS NULL');\n\n    // Apply filters\n    if (search) {\n      query.andWhere(\n        '(user.firstName ILIKE :search OR user.lastName ILIKE :search OR user.email ILIKE :search)',\n        { search: `%${search}%` }\n      );\n    }\n\n    if (status) {\n      query.andWhere('user.status = :status', { status });\n    }\n\n    // Apply sorting\n    const sortColumn = sortBy || 'createdAt';\n    const sortDirection = sortOrder?.toUpperCase() === 'ASC' ? 'ASC' : 'DESC';\n    query.orderBy(`user.${sortColumn}`, sortDirection);\n\n    // Apply pagination\n    const skip = (page - 1) * limit;\n    query.skip(skip).take(limit);\n\n    // Execute query\n    const [users, total] = await query.getManyAndCount();\n\n    return {\n      data: users,\n      pagination: {\n        currentPage: page,\n        perPage: limit,\n        totalPages: Math.ceil(total / limit),\n        totalItems: total,\n        hasNext: page * limit < total,\n        hasPrevious: page > 1,\n      },\n    };\n  }\n\n  async updateUser(id: string, updateData: UpdateUserDto): Promise<User> {\n    const user = await this.getUserById(id);\n\n    // Check email uniqueness if email is being updated\n    if (updateData.email && updateData.email !== user.email) {\n      const existingUser = await this.userRepository.findOne({\n        where: { email: updateData.email }\n      });\n      if (existingUser) {\n        throw new ConflictError('Email already exists');\n      }\n    }\n\n    // Update user\n    Object.assign(user, updateData);\n    return await this.userRepository.save(user);\n  }\n\n  async deleteUser(id: string): Promise<void> {\n    const user = await this.getUserById(id);\n\n    // Soft delete\n    user.deletedAt = new Date();\n    user.status = 'deleted';\n    user.isActive = false;\n\n    await this.userRepository.save(user);\n  }\n\n  async verifyPassword(user: User, password: string): Promise<boolean> {\n    return await bcrypt.compare(password, user.passwordHash);\n  }\n\n  async updatePassword(\n    userId: string,\n    currentPassword: string,\n    newPassword: string\n  ): Promise<void> {\n    const user = await this.userRepository\n      .createQueryBuilder('user')\n      .where('user.id = :userId', { userId })\n      .addSelect('user.passwordHash')\n      .getOne();\n\n    if (!user) {\n      throw new NotFoundError('User not found');\n    }\n\n    // Verify current password\n    const isValid = await this.verifyPassword(user, currentPassword);\n    if (!isValid) {\n      throw new UnauthorizedError('Current password is incorrect');\n    }\n\n    // Hash and save new password\n    user.passwordHash = await bcrypt.hash(newPassword, 10);\n    await this.userRepository.save(user);\n  }\n}\n```\n\n### 4.3 User Controller (TypeScript)\n\n```typescript\n// src/controllers/user.controller.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { UserService } from '../services/user.service';\nimport { successResponse } from '../utils/response';\n\nexport class UserController {\n  constructor(private userService: UserService) {}\n\n  createUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const user = await this.userService.createUser(req.body);\n      return successResponse(res, user, 'User created successfully', 201);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  getUserById = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const user = await this.userService.getUserById(req.params.id);\n      return successResponse(res, { user });\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  listUsers = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const result = await this.userService.listUsers(req.query);\n      return successResponse(res, result);\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  updateUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const user = await this.userService.updateUser(req.params.id, req.body);\n      return successResponse(res, { user }, 'User updated successfully');\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  deleteUser = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      await this.userService.deleteUser(req.params.id);\n      return res.status(204).send();\n    } catch (error) {\n      next(error);\n    }\n  };\n\n  updatePassword = async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n      await this.userService.updatePassword(\n        req.params.id,\n        currentPassword,\n        newPassword\n      );\n      return successResponse(res, null, 'Password updated successfully');\n    } catch (error) {\n      next(error);\n    }\n  };\n}\n```\n\n### 4.4 Authentication Middleware (TypeScript)\n\n```typescript\n// src/middleware/auth.middleware.ts\nimport { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\nimport { UnauthorizedError } from '../utils/errors';\nimport { config } from '../config/environment';\n\nexport interface JWTPayload {\n  userId: string;\n  email: string;\n  iat: number;\n  exp: number;\n}\n\nexport const authMiddleware = async (\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  try {\n    // Extract token from Authorization header\n    const authHeader = req.headers.authorization;\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\n      throw new UnauthorizedError('No token provided');\n    }\n\n    const token = authHeader.substring(7);\n\n    // Verify token\n    const decoded = jwt.verify(token, config.jwtSecret) as JWTPayload;\n\n    // Attach user info to request\n    req.user = {\n      userId: decoded.userId,\n      email: decoded.email,\n    };\n\n    next();\n  } catch (error) {\n    if (error instanceof jwt.JsonWebTokenError) {\n      next(new UnauthorizedError('Invalid token'));\n    } else if (error instanceof jwt.TokenExpiredError) {\n      next(new UnauthorizedError('Token expired'));\n    } else {\n      next(error);\n    }\n  }\n};\n```\n\n### 4.5 Validation Schemas (TypeScript with Joi)\n\n```typescript\n// src/validators/user.validator.ts\nimport Joi from 'joi';\n\nexport const createUserSchema = Joi.object({\n  username: Joi.string()\n    .alphanum()\n    .min(3)\n    .max(50)\n    .required()\n    .messages({\n      'string.alphanum': 'Username must contain only alphanumeric characters',\n      'string.min': 'Username must be at least 3 characters',\n      'string.max': 'Username must not exceed 50 characters',\n    }),\n\n  email: Joi.string()\n    .email()\n    .max(255)\n    .required()\n    .messages({\n      'string.email': 'Invalid email format',\n    }),\n\n  password: Joi.string()\n    .min(8)\n    .pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]/)\n    .required()\n    .messages({\n      'string.pattern.base': 'Password must contain uppercase, lowercase, number, and special character',\n      'string.min': 'Password must be at least 8 characters',\n    }),\n\n  firstName: Joi.string().max(100).optional(),\n  lastName: Joi.string().max(100).optional(),\n  phoneNumber: Joi.string().pattern(/^\\+?[1-9]\\d{1,14}$/).optional(),\n  dateOfBirth: Joi.date().max('now').optional(),\n});\n\nexport const updateUserSchema = Joi.object({\n  email: Joi.string().email().max(255).optional(),\n  firstName: Joi.string().max(100).optional(),\n  lastName: Joi.string().max(100).optional(),\n  phoneNumber: Joi.string().pattern(/^\\+?[1-9]\\d{1,14}$/).optional(),\n  dateOfBirth: Joi.date().max('now').optional(),\n  profilePictureUrl: Joi.string().uri().max(500).optional(),\n  bio: Joi.string().max(500).optional(),\n}).min(1);\n\nexport const listUsersSchema = Joi.object({\n  page: Joi.number().integer().min(1).default(1),\n  limit: Joi.number().integer().min(1).max(100).default(20),\n  search: Joi.string().min(2).optional(),\n  status: Joi.string().valid('active', 'inactive', 'suspended').optional(),\n  sortBy: Joi.string().valid('createdAt', 'email', 'username', 'lastName').default('createdAt'),\n  sortOrder: Joi.string().valid('asc', 'desc').default('desc'),\n});\n```\n\n---\n\n## 5. Security Implementation\n\n### 5.1 Password Hashing\n\n```typescript\n// src/services/password.service.ts\nimport bcrypt from 'bcrypt';\n\nexport class PasswordService {\n  private readonly saltRounds = 10;\n\n  async hashPassword(password: string): Promise<string> {\n    return await bcrypt.hash(password, this.saltRounds);\n  }\n\n  async comparePassword(password: string, hash: string): Promise<boolean> {\n    return await bcrypt.compare(password, hash);\n  }\n\n  validatePasswordStrength(password: string): boolean {\n    const minLength = 8;\n    const hasUpperCase = /[A-Z]/.test(password);\n    const hasLowerCase = /[a-z]/.test(password);\n    const hasNumbers = /\\d/.test(password);\n    const hasSpecialChar = /[@$!%*?&]/.test(password);\n\n    return (\n      password.length >= minLength &&\n      hasUpperCase &&\n      hasLowerCase &&\n      hasNumbers &&\n      hasSpecialChar\n    );\n  }\n}\n```\n\n### 5.2 JWT Authentication\n\n```typescript\n// src/services/auth.service.ts\nimport jwt from 'jsonwebtoken';\nimport { config } from '../config/environment';\n\nexport interface TokenPayload {\n  userId: string;\n  email: string;\n}\n\nexport class AuthService {\n  generateAccessToken(payload: TokenPayload): string {\n    return jwt.sign(payload, config.jwtSecret, {\n      expiresIn: config.jwtExpiresIn, // '1h'\n    });\n  }\n\n  generateRefreshToken(payload: TokenPayload): string {\n    return jwt.sign(payload, config.jwtRefreshSecret, {\n      expiresIn: config.jwtRefreshExpiresIn, // '7d'\n    });\n  }\n\n  verifyAccessToken(token: string): TokenPayload {\n    return jwt.verify(token, config.jwtSecret) as TokenPayload;\n  }\n\n  verifyRefreshToken(token: string): TokenPayload {\n    return jwt.verify(token, config.jwtRefreshSecret) as TokenPayload;\n  }\n}\n```\n\n### 5.3 Rate Limiting\n\n```typescript\n// src/middleware/rateLimit.middleware.ts\nimport rateLimit from 'express-rate-limit';\n\nexport const apiRateLimiter = rateLimit({\n  windowMs: 60 * 1000, // 1 minute\n  max: 100, // 100 requests per window\n  message: {\n    success: false,\n    error: {\n      code: 'RATE_LIMIT_EXCEEDED',\n      message: 'Too many requests. Please try again later.',\n    },\n  },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\nexport const authRateLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000, // 15 minutes\n  max: 5, // 5 login attempts\n  message: {\n    success: false,\n    error: {\n      code: 'RATE_LIMIT_EXCEEDED',\n      message: 'Too many login attempts. Please try again later.',\n    },\n  },\n  skipSuccessfulRequests: true,\n});\n```\n\n---\n\n## 6. Error Handling\n\n### 6.1 Custom Error Classes\n\n```typescript\n// src/utils/errors.ts\nexport class AppError extends Error {\n  constructor(\n    public statusCode: number,\n    public code: string,\n    public message: string,\n    public details?: any\n  ) {\n    super(message);\n    this.name = this.constructor.name;\n    Error.captureStackTrace(this, this.constructor);\n  }\n}\n\nexport class ValidationError extends AppError {\n  constructor(message: string, details?: any) {\n    super(400, 'VALIDATION_ERROR', message, details);\n  }\n}\n\nexport class UnauthorizedError extends AppError {\n  constructor(message: string = 'Unauthorized') {\n    super(401, 'UNAUTHORIZED', message);\n  }\n}\n\nexport class ForbiddenError extends AppError {\n  constructor(message: string = 'Forbidden') {\n    super(403, 'FORBIDDEN', message);\n  }\n}\n\nexport class NotFoundError extends AppError {\n  constructor(message: string = 'Resource not found') {\n    super(404, 'RESOURCE_NOT_FOUND', message);\n  }\n}\n\nexport class ConflictError extends AppError {\n  constructor(message: string, details?: any) {\n    super(409, 'DUPLICATE_RESOURCE', message, details);\n  }\n}\n```\n\n### 6.2 Error Handler Middleware\n\n```typescript\n// src/middleware/errorHandler.middleware.ts\nimport { Request, Response, NextFunction } from 'express';\nimport { AppError } from '../utils/errors';\nimport { logger } from '../utils/logger';\n\nexport const errorHandler = (\n  err: Error,\n  req: Request,\n  res: Response,\n  next: NextFunction\n) => {\n  // Log error\n  logger.error({\n    message: err.message,\n    stack: err.stack,\n    path: req.path,\n    method: req.method,\n  });\n\n  // Handle known errors\n  if (err instanceof AppError) {\n    return res.status(err.statusCode).json({\n      success: false,\n      error: {\n        code: err.code,\n        message: err.message,\n        details: err.details,\n        timestamp: new Date().toISOString(),\n      },\n    });\n  }\n\n  // Handle unknown errors\n  return res.status(500).json({\n    success: false,\n    error: {\n      code: 'INTERNAL_SERVER_ERROR',\n      message: 'An unexpected error occurred',\n      timestamp: new Date().toISOString(),\n    },\n  });\n};\n```\n\n---\n\n## 7. Testing Strategy\n\n### 7.1 Unit Tests (Jest)\n\n```typescript\n// tests/unit/services/user.service.test.ts\nimport { UserService } from '../../../src/services/user.service';\nimport { User } from '../../../src/models/user.model';\nimport { ConflictError, NotFoundError } from '../../../src/utils/errors';\n\ndescribe('UserService', () => {\n  let userService: UserService;\n  let mockRepository: jest.Mocked<Repository<User>>;\n\n  beforeEach(() => {\n    mockRepository = {\n      findOne: jest.fn(),\n      create: jest.fn(),\n      save: jest.fn(),\n      createQueryBuilder: jest.fn(),\n    } as any;\n\n    userService = new UserService(mockRepository);\n  });\n\n  describe('createUser', () => {\n    it('should create a new user successfully', async () => {\n      const userData = {\n        username: 'testuser',\n        email: 'test@example.com',\n        password: 'Test@1234',\n        firstName: 'Test',\n        lastName: 'User',\n      };\n\n      mockRepository.findOne.mockResolvedValue(null);\n      mockRepository.create.mockReturnValue(userData as any);\n      mockRepository.save.mockResolvedValue({ ...userData, id: 'uuid' } as any);\n\n      const result = await userService.createUser(userData);\n\n      expect(result).toHaveProperty('id');\n      expect(mockRepository.findOne).toHaveBeenCalled();\n      expect(mockRepository.save).toHaveBeenCalled();\n    });\n\n    it('should throw ConflictError if email exists', async () => {\n      const userData = {\n        username: 'testuser',\n        email: 'existing@example.com',\n        password: 'Test@1234',\n      };\n\n      mockRepository.findOne.mockResolvedValue({ email: userData.email } as any);\n\n      await expect(userService.createUser(userData)).rejects.toThrow(ConflictError);\n    });\n  });\n\n  describe('getUserById', () => {\n    it('should return user if found', async () => {\n      const userId = 'uuid';\n      const mockUser = { id: userId, email: 'test@example.com' };\n\n      mockRepository.findOne.mockResolvedValue(mockUser as any);\n\n      const result = await userService.getUserById(userId);\n\n      expect(result).toEqual(mockUser);\n    });\n\n    it('should throw NotFoundError if user not found', async () => {\n      mockRepository.findOne.mockResolvedValue(null);\n\n      await expect(userService.getUserById('uuid')).rejects.toThrow(NotFoundError);\n    });\n  });\n});\n```\n\n### 7.2 Integration Tests\n\n```typescript\n// tests/integration/api/users.test.ts\nimport request from 'supertest';\nimport { app } from '../../../src/app';\nimport { setupTestDatabase, teardownTestDatabase } from '../../fixtures/database';\n\ndescribe('User API Integration Tests', () => {\n  beforeAll(async () => {\n    await setupTestDatabase();\n  });\n\n  afterAll(async () => {\n    await teardownTestDatabase();\n  });\n\n  describe('POST /api/v1/users', () => {\n    it('should create a new user', async () => {\n      const response = await request(app)\n        .post('/api/v1/users')\n        .send({\n          username: 'testuser',\n          email: 'test@example.com',\n          password: 'Test@1234',\n          firstName: 'Test',\n          lastName: 'User',\n        });\n\n      expect(response.status).toBe(201);\n      expect(response.body.success).toBe(true);\n      expect(response.body.data.user).toHaveProperty('id');\n      expect(response.body.data.user.email).toBe('test@example.com');\n    });\n\n    it('should return 409 for duplicate email', async () => {\n      // Create first user\n      await request(app)\n        .post('/api/v1/users')\n        .send({\n          username: 'user1',\n          email: 'duplicate@example.com',\n          password: 'Test@1234',\n        });\n\n      // Try to create with same email\n      const response = await request(app)\n        .post('/api/v1/users')\n        .send({\n          username: 'user2',\n          email: 'duplicate@example.com',\n          password: 'Test@1234',\n        });\n\n      expect(response.status).toBe(409);\n      expect(response.body.error.code).toBe('DUPLICATE_RESOURCE');\n    });\n  });\n});\n```\n\n---\n\n## 8. Deployment Configuration\n\n### 8.1 Environment Variables\n\n```bash\n# .env.example\n\n# Server Configuration\nNODE_ENV=development\nPORT=3000\nAPI_VERSION=v1\n\n# Database Configuration\nDB_HOST=localhost\nDB_PORT=5432\nDB_NAME=user_management_db\nDB_USER=app_user\nDB_PASSWORD=secure_password\nDB_POOL_MIN=2\nDB_POOL_MAX=10\n\n# JWT Configuration\nJWT_SECRET=your-super-secret-jwt-key-change-in-production\nJWT_EXPIRES_IN=1h\nJWT_REFRESH_SECRET=your-refresh-token-secret\nJWT_REFRESH_EXPIRES_IN=7d\n\n# Security\nBCRYPT_ROUNDS=10\nRATE_LIMIT_WINDOW_MS=60000\nRATE_LIMIT_MAX_REQUESTS=100\n\n# Logging\nLOG_LEVEL=info\nLOG_FORMAT=json\n\n# CORS\nCORS_ORIGIN=http://localhost:3000,https://yourdomain.com\n```\n\n### 8.2 Docker Configuration\n\n```dockerfile\n# Dockerfile\nFROM node:18-alpine AS builder\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci\n\nCOPY . .\nRUN npm run build\n\nFROM node:18-alpine\n\nWORKDIR /app\n\nCOPY package*.json ./\nRUN npm ci --only=production\n\nCOPY --from=builder /app/dist ./dist\n\nEXPOSE 3000\n\nCMD [\"node\", \"dist/server.js\"]\n```\n\n```yaml\n# docker-compose.yml\nversion: '3.8'\n\nservices:\n  api:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - DB_HOST=postgres\n      - DB_PORT=5432\n      - DB_NAME=user_management_db\n      - DB_USER=app_user\n      - DB_PASSWORD=secure_password\n    depends_on:\n      - postgres\n    restart: unless-stopped\n\n  postgres:\n    image: postgres:14-alpine\n    environment:\n      - POSTGRES_DB=user_management_db\n      - POSTGRES_USER=app_user\n      - POSTGRES_PASSWORD=secure_password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - \"5432:5432\"\n    restart: unless-stopped\n\nvolumes:\n  postgres_data:\n```\n\n---\n\n## 9. Performance Optimization\n\n### 9.1 Database Query Optimization\n- Use indexes on frequently queried columns\n- Implement connection pooling\n- Use query result caching for static data\n- Avoid N+1 queries with eager loading\n\n### 9.2 API Response Optimization\n- Implement response compression (gzip)\n- Use HTTP caching headers (ETag, Cache-Control)\n- Paginate large result sets\n- Exclude unnecessary fields from responses\n\n### 9.3 Caching Strategy\n- Cache user profiles (5-minute TTL)\n- Cache authentication tokens\n- Implement Redis for session management\n\n---\n\n## 10. Monitoring and Observability\n\n### 10.1 Logging\n- Structured logging (JSON format)\n- Log levels: ERROR, WARN, INFO, DEBUG\n- Request/response logging\n- Performance metrics logging\n\n### 10.2 Health Checks\n```typescript\n// Health check endpoint\napp.get('/api/v1/health', async (req, res) => {\n  const health = {\n    status: 'healthy',\n    version: process.env.API_VERSION,\n    timestamp: new Date().toISOString(),\n    services: {\n      database: await checkDatabaseConnection(),\n      cache: await checkCacheConnection(),\n    },\n  };\n  res.json(health);\n});\n```\n\n---\n\n**Document Status:** Final\n**Quality Review:** Passed\n**Ready for Implementation:** Yes\n",
              "test_workflow_output/database_schema.sql": "-- ============================================================================\n-- User Management API - Database Schema\n-- ============================================================================\n-- Version: 1.0.0\n-- Database: PostgreSQL 14+\n-- Purpose: Core schema for user management REST API with CRUD operations\n-- ============================================================================\n\n-- Enable required extensions\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\nCREATE EXTENSION IF NOT EXISTS \"pgcrypto\";\n\n-- ============================================================================\n-- TABLES\n-- ============================================================================\n\n-- Users table: Core entity for user management\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    username VARCHAR(50) NOT NULL UNIQUE,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    password_hash VARCHAR(255) NOT NULL,\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    is_active BOOLEAN DEFAULT TRUE,\n    is_verified BOOLEAN DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    last_login_at TIMESTAMP WITH TIME ZONE,\n    deleted_at TIMESTAMP WITH TIME ZONE,\n\n    -- Constraints\n    CONSTRAINT username_length CHECK (LENGTH(username) >= 3),\n    CONSTRAINT email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')\n);\n\n-- User profiles: Extended user information\nCREATE TABLE user_profiles (\n    user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,\n    bio TEXT,\n    phone_number VARCHAR(20),\n    date_of_birth DATE,\n    avatar_url VARCHAR(500),\n    timezone VARCHAR(50) DEFAULT 'UTC',\n    locale VARCHAR(10) DEFAULT 'en_US',\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\n-- User roles: Role-based access control\nCREATE TABLE roles (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    name VARCHAR(50) NOT NULL UNIQUE,\n    description TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT role_name_lowercase CHECK (name = LOWER(name))\n);\n\n-- User role assignments: Many-to-many relationship\nCREATE TABLE user_roles (\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    role_id UUID REFERENCES roles(id) ON DELETE CASCADE,\n    assigned_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    assigned_by UUID REFERENCES users(id) ON DELETE SET NULL,\n\n    PRIMARY KEY (user_id, role_id)\n);\n\n-- Audit log: Track all user changes\nCREATE TABLE user_audit_log (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID REFERENCES users(id) ON DELETE SET NULL,\n    action VARCHAR(50) NOT NULL,\n    entity_type VARCHAR(50) NOT NULL,\n    entity_id UUID,\n    old_values JSONB,\n    new_values JSONB,\n    ip_address INET,\n    user_agent TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    performed_by UUID REFERENCES users(id) ON DELETE SET NULL\n);\n\n-- Password reset tokens\nCREATE TABLE password_reset_tokens (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    token VARCHAR(255) NOT NULL UNIQUE,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    used_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n\n    CONSTRAINT token_not_expired CHECK (used_at IS NULL OR used_at < expires_at)\n);\n\n-- Email verification tokens\nCREATE TABLE email_verification_tokens (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    token VARCHAR(255) NOT NULL UNIQUE,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    verified_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\n-- ============================================================================\n-- INDEXES\n-- ============================================================================\n\n-- Users table indexes\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_is_active ON users(is_active) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_created_at ON users(created_at DESC);\nCREATE INDEX idx_users_deleted_at ON users(deleted_at) WHERE deleted_at IS NOT NULL;\n\n-- User profiles indexes\nCREATE INDEX idx_user_profiles_phone ON user_profiles(phone_number);\n\n-- User roles indexes\nCREATE INDEX idx_user_roles_user_id ON user_roles(user_id);\nCREATE INDEX idx_user_roles_role_id ON user_roles(role_id);\n\n-- Audit log indexes\nCREATE INDEX idx_audit_log_user_id ON user_audit_log(user_id);\nCREATE INDEX idx_audit_log_created_at ON user_audit_log(created_at DESC);\nCREATE INDEX idx_audit_log_action ON user_audit_log(action);\nCREATE INDEX idx_audit_log_entity ON user_audit_log(entity_type, entity_id);\n\n-- Token indexes\nCREATE INDEX idx_password_reset_tokens_user_id ON password_reset_tokens(user_id);\nCREATE INDEX idx_password_reset_tokens_token ON password_reset_tokens(token) WHERE used_at IS NULL;\nCREATE INDEX idx_password_reset_tokens_expires ON password_reset_tokens(expires_at) WHERE used_at IS NULL;\n\nCREATE INDEX idx_email_verification_tokens_user_id ON email_verification_tokens(user_id);\nCREATE INDEX idx_email_verification_tokens_token ON email_verification_tokens(token) WHERE verified_at IS NULL;\n\n-- ============================================================================\n-- FUNCTIONS AND TRIGGERS\n-- ============================================================================\n\n-- Function: Update timestamp on row modification\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = CURRENT_TIMESTAMP;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Trigger: Auto-update updated_at for users\nCREATE TRIGGER update_users_updated_at\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- Trigger: Auto-update updated_at for user_profiles\nCREATE TRIGGER update_user_profiles_updated_at\n    BEFORE UPDATE ON user_profiles\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- Function: Soft delete user\nCREATE OR REPLACE FUNCTION soft_delete_user(user_id_param UUID)\nRETURNS BOOLEAN AS $$\nBEGIN\n    UPDATE users\n    SET deleted_at = CURRENT_TIMESTAMP,\n        is_active = FALSE\n    WHERE id = user_id_param\n    AND deleted_at IS NULL;\n\n    RETURN FOUND;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Function: Clean expired tokens\nCREATE OR REPLACE FUNCTION clean_expired_tokens()\nRETURNS INTEGER AS $$\nDECLARE\n    deleted_count INTEGER;\nBEGIN\n    DELETE FROM password_reset_tokens\n    WHERE expires_at < CURRENT_TIMESTAMP\n    AND used_at IS NULL;\n\n    GET DIAGNOSTICS deleted_count = ROW_COUNT;\n\n    DELETE FROM email_verification_tokens\n    WHERE expires_at < CURRENT_TIMESTAMP\n    AND verified_at IS NULL;\n\n    RETURN deleted_count;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- ============================================================================\n-- VIEWS\n-- ============================================================================\n\n-- View: Complete user information with profile and roles\nCREATE OR REPLACE VIEW v_users_complete AS\nSELECT\n    u.id,\n    u.username,\n    u.email,\n    u.first_name,\n    u.last_name,\n    u.is_active,\n    u.is_verified,\n    u.created_at,\n    u.updated_at,\n    u.last_login_at,\n    p.bio,\n    p.phone_number,\n    p.date_of_birth,\n    p.avatar_url,\n    p.timezone,\n    p.locale,\n    ARRAY_AGG(DISTINCT r.name) FILTER (WHERE r.name IS NOT NULL) AS roles\nFROM users u\nLEFT JOIN user_profiles p ON u.id = p.user_id\nLEFT JOIN user_roles ur ON u.id = ur.user_id\nLEFT JOIN roles r ON ur.role_id = r.id\nWHERE u.deleted_at IS NULL\nGROUP BY u.id, p.user_id, p.bio, p.phone_number, p.date_of_birth,\n         p.avatar_url, p.timezone, p.locale;\n\n-- View: Active users summary\nCREATE OR REPLACE VIEW v_active_users_summary AS\nSELECT\n    u.id,\n    u.username,\n    u.email,\n    u.first_name,\n    u.last_name,\n    u.is_verified,\n    u.last_login_at,\n    COUNT(DISTINCT ur.role_id) AS role_count\nFROM users u\nLEFT JOIN user_roles ur ON u.id = ur.user_id\nWHERE u.is_active = TRUE\nAND u.deleted_at IS NULL\nGROUP BY u.id;\n\n-- ============================================================================\n-- INITIAL DATA\n-- ============================================================================\n\n-- Insert default roles\nINSERT INTO roles (name, description) VALUES\n    ('admin', 'Full system access with all permissions'),\n    ('user', 'Standard user with basic permissions'),\n    ('moderator', 'Can moderate content and manage users'),\n    ('guest', 'Read-only access')\nON CONFLICT (name) DO NOTHING;\n\n-- ============================================================================\n-- GRANTS AND PERMISSIONS\n-- ============================================================================\n\n-- Grant usage on schema\nGRANT USAGE ON SCHEMA public TO PUBLIC;\n\n-- Grant select on views\nGRANT SELECT ON v_users_complete TO PUBLIC;\nGRANT SELECT ON v_active_users_summary TO PUBLIC;\n\n-- ============================================================================\n-- COMMENTS\n-- ============================================================================\n\nCOMMENT ON TABLE users IS 'Core user accounts with authentication credentials';\nCOMMENT ON TABLE user_profiles IS 'Extended user profile information';\nCOMMENT ON TABLE roles IS 'System roles for access control';\nCOMMENT ON TABLE user_roles IS 'User-role assignments (many-to-many)';\nCOMMENT ON TABLE user_audit_log IS 'Audit trail for all user-related changes';\nCOMMENT ON TABLE password_reset_tokens IS 'Temporary tokens for password reset flow';\nCOMMENT ON TABLE email_verification_tokens IS 'Tokens for email verification';\n\nCOMMENT ON COLUMN users.password_hash IS 'Hashed password using bcrypt or argon2';\nCOMMENT ON COLUMN users.deleted_at IS 'Soft delete timestamp (NULL = active)';\nCOMMENT ON COLUMN users.is_verified IS 'Email verification status';\n",
              "test_workflow_output/data_model.md": "# Data Model Documentation\n## User Management REST API\n\n**Version:** 1.0.0\n**Database:** PostgreSQL 14+\n**Created:** 2025-10-12\n**Author:** Database Specialist\n\n---\n\n## Table of Contents\n1. [Overview](#overview)\n2. [Entity Relationship Diagram](#entity-relationship-diagram)\n3. [Data Entities](#data-entities)\n4. [Relationships](#relationships)\n5. [Data Types and Constraints](#data-types-and-constraints)\n6. [Indexing Strategy](#indexing-strategy)\n7. [Security Considerations](#security-considerations)\n\n---\n\n## Overview\n\nThis data model supports a comprehensive user management system with CRUD operations, role-based access control (RBAC), audit logging, and user verification workflows.\n\n### Key Features\n- **User Management**: Core user accounts with soft delete support\n- **Profile Management**: Extended user information storage\n- **Role-Based Access Control**: Flexible role assignment system\n- **Audit Trail**: Complete history of user-related changes\n- **Token Management**: Password reset and email verification flows\n- **Soft Deletes**: Data retention for compliance and recovery\n\n---\n\n## Entity Relationship Diagram\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     USERS       \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 PK: id (UUID)   \u2502\n\u2502 UK: username    \u2502\n\u2502 UK: email       \u2502\n\u2502 password_hash   \u2502\n\u2502 first_name      \u2502\n\u2502 last_name       \u2502\n\u2502 is_active       \u2502\n\u2502 is_verified     \u2502\n\u2502 created_at      \u2502\n\u2502 updated_at      \u2502\n\u2502 last_login_at   \u2502\n\u2502 deleted_at      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u2502 1:1\n         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 USER_PROFILES   \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502PK,FK: user_id   \u2502\n\u2502 bio             \u2502\n\u2502 phone_number    \u2502\n\u2502 date_of_birth   \u2502\n\u2502 avatar_url      \u2502\n\u2502 timezone        \u2502\n\u2502 locale          \u2502\n\u2502 created_at      \u2502\n\u2502 updated_at      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n         \u2502\n         \u2502 M:N\n         \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   USER_ROLES    \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2502     ROLES       \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502  M:1 \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502PK,FK: user_id   \u2502      \u2502 PK: id (UUID)   \u2502\n\u2502PK,FK: role_id   \u2502      \u2502 UK: name        \u2502\n\u2502 assigned_at     \u2502      \u2502 description     \u2502\n\u2502 assigned_by     \u2502      \u2502 created_at      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502USER_AUDIT_LOG   \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 PK: id (UUID)   \u2502\n\u2502 FK: user_id     \u2502\n\u2502 action          \u2502\n\u2502 entity_type     \u2502\n\u2502 entity_id       \u2502\n\u2502 old_values      \u2502\n\u2502 new_values      \u2502\n\u2502 ip_address      \u2502\n\u2502 user_agent      \u2502\n\u2502 created_at      \u2502\n\u2502 performed_by    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502PASSWORD_RESET_TOKENS    \u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 PK: id (UUID)           \u2502\n\u2502 FK: user_id             \u2502\n\u2502 UK: token               \u2502\n\u2502 expires_at              \u2502\n\u2502 used_at                 \u2502\n\u2502 created_at              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502EMAIL_VERIFICATION_TOKENS\u2502\n\u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n\u2502 PK: id (UUID)           \u2502\n\u2502 FK: user_id             \u2502\n\u2502 UK: token               \u2502\n\u2502 expires_at              \u2502\n\u2502 verified_at             \u2502\n\u2502 created_at              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n---\n\n## Data Entities\n\n### 1. Users (Core Entity)\n**Purpose:** Store core user account information and authentication credentials.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique user identifier |\n| username | VARCHAR(50) | NOT NULL, UNIQUE, LENGTH >= 3 | User's unique username |\n| email | VARCHAR(255) | NOT NULL, UNIQUE, Valid email format | User's email address |\n| password_hash | VARCHAR(255) | NOT NULL | Hashed password (bcrypt/argon2) |\n| first_name | VARCHAR(100) | NULL | User's first name |\n| last_name | VARCHAR(100) | NULL | User's last name |\n| is_active | BOOLEAN | DEFAULT TRUE | Account active status |\n| is_verified | BOOLEAN | DEFAULT FALSE | Email verification status |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Account creation timestamp |\n| updated_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Last update timestamp |\n| last_login_at | TIMESTAMP WITH TIME ZONE | NULL | Last successful login |\n| deleted_at | TIMESTAMP WITH TIME ZONE | NULL | Soft delete timestamp |\n\n**Business Rules:**\n- Username must be at least 3 characters\n- Email must match standard email format\n- Soft delete: deleted_at != NULL indicates deleted user\n- Users cannot be hard deleted (compliance requirement)\n\n### 2. User Profiles\n**Purpose:** Store extended user information separate from core authentication data.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| user_id | UUID | PRIMARY KEY, FOREIGN KEY \u2192 users(id) | Reference to user |\n| bio | TEXT | NULL | User biography/description |\n| phone_number | VARCHAR(20) | NULL | Contact phone number |\n| date_of_birth | DATE | NULL | User's date of birth |\n| avatar_url | VARCHAR(500) | NULL | Profile picture URL |\n| timezone | VARCHAR(50) | DEFAULT 'UTC' | User's timezone |\n| locale | VARCHAR(10) | DEFAULT 'en_US' | User's locale preference |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Profile creation timestamp |\n| updated_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Last update timestamp |\n\n**Business Rules:**\n- One-to-one relationship with users\n- Cascade delete with parent user\n- Profile is optional (can be created later)\n\n### 3. Roles\n**Purpose:** Define system roles for access control.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique role identifier |\n| name | VARCHAR(50) | NOT NULL, UNIQUE, LOWERCASE | Role name (lowercase) |\n| description | TEXT | NULL | Role description |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Role creation timestamp |\n\n**Default Roles:**\n- `admin`: Full system access\n- `user`: Standard user permissions\n- `moderator`: Content and user management\n- `guest`: Read-only access\n\n### 4. User Roles (Junction Table)\n**Purpose:** Many-to-many relationship between users and roles.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| user_id | UUID | PRIMARY KEY, FOREIGN KEY \u2192 users(id) | Reference to user |\n| role_id | UUID | PRIMARY KEY, FOREIGN KEY \u2192 roles(id) | Reference to role |\n| assigned_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Role assignment timestamp |\n| assigned_by | UUID | FOREIGN KEY \u2192 users(id) | User who assigned the role |\n\n**Business Rules:**\n- Composite primary key (user_id, role_id)\n- Users can have multiple roles\n- Roles can be assigned to multiple users\n\n### 5. User Audit Log\n**Purpose:** Track all user-related changes for compliance and security.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique audit entry ID |\n| user_id | UUID | FOREIGN KEY \u2192 users(id) | Affected user |\n| action | VARCHAR(50) | NOT NULL | Action performed (CREATE, UPDATE, DELETE) |\n| entity_type | VARCHAR(50) | NOT NULL | Type of entity changed |\n| entity_id | UUID | NULL | ID of affected entity |\n| old_values | JSONB | NULL | Previous values (JSON) |\n| new_values | JSONB | NULL | New values (JSON) |\n| ip_address | INET | NULL | Client IP address |\n| user_agent | TEXT | NULL | Client user agent |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Audit entry timestamp |\n| performed_by | UUID | FOREIGN KEY \u2192 users(id) | User who performed action |\n\n**Business Rules:**\n- Immutable records (no updates or deletes)\n- Stores complete change history\n- JSONB format for flexible value storage\n\n### 6. Password Reset Tokens\n**Purpose:** Manage password reset workflow securely.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique token ID |\n| user_id | UUID | NOT NULL, FOREIGN KEY \u2192 users(id) | User requesting reset |\n| token | VARCHAR(255) | NOT NULL, UNIQUE | Secure reset token |\n| expires_at | TIMESTAMP WITH TIME ZONE | NOT NULL | Token expiration time |\n| used_at | TIMESTAMP WITH TIME ZONE | NULL | Token usage timestamp |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Token creation timestamp |\n\n**Business Rules:**\n- Tokens expire after configured time (typically 1 hour)\n- Single-use tokens (used_at marks as consumed)\n- Automatic cleanup of expired tokens\n\n### 7. Email Verification Tokens\n**Purpose:** Manage email verification workflow.\n\n| Column | Type | Constraints | Description |\n|--------|------|-------------|-------------|\n| id | UUID | PRIMARY KEY, DEFAULT uuid_generate_v4() | Unique token ID |\n| user_id | UUID | NOT NULL, FOREIGN KEY \u2192 users(id) | User to verify |\n| token | VARCHAR(255) | NOT NULL, UNIQUE | Verification token |\n| expires_at | TIMESTAMP WITH TIME ZONE | NOT NULL | Token expiration time |\n| verified_at | TIMESTAMP WITH TIME ZONE | NULL | Verification timestamp |\n| created_at | TIMESTAMP WITH TIME ZONE | DEFAULT CURRENT_TIMESTAMP | Token creation timestamp |\n\n**Business Rules:**\n- Tokens expire after configured time (typically 24 hours)\n- Single-use tokens\n- Updates users.is_verified on successful verification\n\n---\n\n## Relationships\n\n### One-to-One Relationships\n1. **users \u2194 user_profiles**\n   - Each user has at most one profile\n   - Profile is optional\n   - CASCADE DELETE: Deleting user removes profile\n\n### One-to-Many Relationships\n1. **users \u2192 password_reset_tokens**\n   - User can have multiple password reset tokens (historical)\n   - CASCADE DELETE: Deleting user removes tokens\n\n2. **users \u2192 email_verification_tokens**\n   - User can have multiple verification tokens\n   - CASCADE DELETE: Deleting user removes tokens\n\n3. **users \u2192 user_audit_log**\n   - User can have many audit log entries\n   - SET NULL on delete: Preserve audit trail\n\n### Many-to-Many Relationships\n1. **users \u2194 roles** (via user_roles)\n   - Users can have multiple roles\n   - Roles can be assigned to multiple users\n   - CASCADE DELETE on user removal\n   - CASCADE DELETE on role removal\n\n---\n\n## Data Types and Constraints\n\n### UUID Usage\n- **Primary Keys:** All tables use UUID for primary keys\n- **Benefits:**\n  - Globally unique identifiers\n  - No collision risk in distributed systems\n  - Better security (non-sequential)\n\n### Timestamp Standards\n- **Type:** `TIMESTAMP WITH TIME ZONE`\n- **Benefits:** Timezone-aware storage for global applications\n- **Default:** `CURRENT_TIMESTAMP` for automatic timestamps\n\n### Soft Delete Pattern\n- **Implementation:** `deleted_at` column (NULL = active)\n- **Benefits:**\n  - Data retention for compliance\n  - Ability to restore accounts\n  - Maintains referential integrity\n\n### Email Validation\n- **Constraint:** Regex pattern matching\n- **Format:** `^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$`\n\n### Password Security\n- **Storage:** Hashed using bcrypt or argon2\n- **Never** store plain text passwords\n- **Column:** `password_hash` (255 characters for future-proofing)\n\n---\n\n## Indexing Strategy\n\n### Performance Indexes\n```sql\n-- High-frequency query optimization\nidx_users_email               -- Login by email\nidx_users_username            -- Login by username\nidx_users_is_active           -- Filter active users\nidx_users_created_at          -- Sort by registration date\n\n-- Relationship indexes\nidx_user_roles_user_id        -- Find user's roles\nidx_user_roles_role_id        -- Find users with role\n\n-- Audit and security\nidx_audit_log_user_id         -- User activity history\nidx_audit_log_created_at      -- Recent activity\nidx_audit_log_action          -- Filter by action type\n```\n\n### Partial Indexes\n```sql\n-- Index only non-deleted users (most common queries)\nWHERE deleted_at IS NULL\n\n-- Index only active tokens\nWHERE used_at IS NULL\nWHERE verified_at IS NULL\n```\n\n**Benefits:**\n- Smaller index size\n- Faster query performance\n- Lower maintenance overhead\n\n---\n\n## Security Considerations\n\n### Authentication Security\n1. **Password Hashing:** Use bcrypt (cost factor 12) or argon2\n2. **Token Security:** Cryptographically secure random tokens\n3. **Token Expiration:** Short-lived tokens (1-24 hours)\n4. **Rate Limiting:** Implement at application layer\n\n### Data Privacy\n1. **PII Protection:** Encrypt sensitive fields (consider pgcrypto)\n2. **Audit Logging:** Track all data access and modifications\n3. **Soft Deletes:** Enable data recovery and compliance\n4. **Access Control:** Role-based permissions\n\n### SQL Injection Prevention\n1. **Parameterized Queries:** Always use prepared statements\n2. **Input Validation:** Enforce at database and application layers\n3. **Constraint Checks:** Database-level validation\n\n### Compliance Considerations\n1. **GDPR:** Right to erasure (soft delete + data export)\n2. **Audit Trail:** Complete change history\n3. **Data Retention:** Configurable retention policies\n4. **User Consent:** Track via audit log\n\n---\n\n## Query Patterns\n\n### Common Operations\n\n#### 1. Create User\n```sql\nINSERT INTO users (username, email, password_hash, first_name, last_name)\nVALUES ($1, $2, $3, $4, $5)\nRETURNING id, username, email, created_at;\n```\n\n#### 2. Read User (with Profile and Roles)\n```sql\nSELECT * FROM v_users_complete WHERE id = $1;\n```\n\n#### 3. Update User\n```sql\nUPDATE users\nSET first_name = $1, last_name = $2, updated_at = CURRENT_TIMESTAMP\nWHERE id = $3 AND deleted_at IS NULL\nRETURNING *;\n```\n\n#### 4. Soft Delete User\n```sql\nSELECT soft_delete_user($1);\n```\n\n#### 5. Assign Role\n```sql\nINSERT INTO user_roles (user_id, role_id, assigned_by)\nVALUES ($1, $2, $3)\nON CONFLICT DO NOTHING;\n```\n\n---\n\n## Performance Benchmarks\n\n### Expected Query Performance\n- **User lookup by email/username:** < 5ms (indexed)\n- **User with profile and roles:** < 10ms (join 3 tables)\n- **Audit log insertion:** < 3ms (minimal indexes)\n- **Token validation:** < 5ms (indexed, partial)\n\n### Scalability Considerations\n- **Users:** Optimized for 1M+ users\n- **Audit Log:** Partition by date for large datasets\n- **Indexes:** Regularly VACUUM and ANALYZE\n- **Connections:** Use connection pooling (PgBouncer)\n\n---\n\n## Migration Strategy\n\nSee `migration_scripts/` directory for:\n- Initial schema creation\n- Version upgrades\n- Rollback procedures\n- Data seeding scripts\n\n---\n\n## Maintenance Procedures\n\n### Regular Maintenance\n```sql\n-- Clean expired tokens (run daily)\nSELECT clean_expired_tokens();\n\n-- Vacuum and analyze (run weekly)\nVACUUM ANALYZE users;\nVACUUM ANALYZE user_audit_log;\n\n-- Reindex if needed (run monthly)\nREINDEX TABLE users;\n```\n\n---\n\n## Version History\n\n| Version | Date | Changes |\n|---------|------|---------|\n| 1.0.0 | 2025-10-12 | Initial data model design |\n\n---\n\n## Contact\n\nFor questions or updates to this data model, contact the Database Specialist team.\n",
              "test_workflow_output/migration_scripts/001_initial_schema.sql": "-- ============================================================================\n-- Migration: 001_initial_schema\n-- Description: Initial database schema for User Management API\n-- Author: Database Specialist\n-- Created: 2025-10-12\n-- ============================================================================\n\n-- Migration metadata\n-- Version: 001\n-- Requires: PostgreSQL 14+\n-- Estimated time: < 1 second (empty database)\n\nBEGIN;\n\n-- ============================================================================\n-- EXTENSIONS\n-- ============================================================================\n\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\nCREATE EXTENSION IF NOT EXISTS \"pgcrypto\";\n\n-- ============================================================================\n-- SCHEMA VERSION TRACKING\n-- ============================================================================\n\nCREATE TABLE IF NOT EXISTS schema_migrations (\n    version VARCHAR(20) PRIMARY KEY,\n    description TEXT NOT NULL,\n    applied_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    applied_by VARCHAR(100) DEFAULT CURRENT_USER,\n    execution_time_ms INTEGER,\n    checksum VARCHAR(64)\n);\n\n-- ============================================================================\n-- CORE TABLES\n-- ============================================================================\n\nCREATE TABLE users (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    username VARCHAR(50) NOT NULL UNIQUE,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    password_hash VARCHAR(255) NOT NULL,\n    first_name VARCHAR(100),\n    last_name VARCHAR(100),\n    is_active BOOLEAN DEFAULT TRUE,\n    is_verified BOOLEAN DEFAULT FALSE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    last_login_at TIMESTAMP WITH TIME ZONE,\n    deleted_at TIMESTAMP WITH TIME ZONE,\n    CONSTRAINT username_length CHECK (LENGTH(username) >= 3),\n    CONSTRAINT email_format CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$')\n);\n\nCREATE TABLE user_profiles (\n    user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE,\n    bio TEXT,\n    phone_number VARCHAR(20),\n    date_of_birth DATE,\n    avatar_url VARCHAR(500),\n    timezone VARCHAR(50) DEFAULT 'UTC',\n    locale VARCHAR(10) DEFAULT 'en_US',\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\nCREATE TABLE roles (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    name VARCHAR(50) NOT NULL UNIQUE,\n    description TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    CONSTRAINT role_name_lowercase CHECK (name = LOWER(name))\n);\n\nCREATE TABLE user_roles (\n    user_id UUID REFERENCES users(id) ON DELETE CASCADE,\n    role_id UUID REFERENCES roles(id) ON DELETE CASCADE,\n    assigned_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    assigned_by UUID REFERENCES users(id) ON DELETE SET NULL,\n    PRIMARY KEY (user_id, role_id)\n);\n\nCREATE TABLE user_audit_log (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID REFERENCES users(id) ON DELETE SET NULL,\n    action VARCHAR(50) NOT NULL,\n    entity_type VARCHAR(50) NOT NULL,\n    entity_id UUID,\n    old_values JSONB,\n    new_values JSONB,\n    ip_address INET,\n    user_agent TEXT,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    performed_by UUID REFERENCES users(id) ON DELETE SET NULL\n);\n\nCREATE TABLE password_reset_tokens (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    token VARCHAR(255) NOT NULL UNIQUE,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    used_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,\n    CONSTRAINT token_not_expired CHECK (used_at IS NULL OR used_at < expires_at)\n);\n\nCREATE TABLE email_verification_tokens (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    token VARCHAR(255) NOT NULL UNIQUE,\n    expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n    verified_at TIMESTAMP WITH TIME ZONE,\n    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP\n);\n\n-- ============================================================================\n-- INDEXES\n-- ============================================================================\n\n-- Users indexes\nCREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_username ON users(username) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_is_active ON users(is_active) WHERE deleted_at IS NULL;\nCREATE INDEX idx_users_created_at ON users(created_at DESC);\nCREATE INDEX idx_users_deleted_at ON users(deleted_at) WHERE deleted_at IS NOT NULL;\n\n-- User profiles indexes\nCREATE INDEX idx_user_profiles_phone ON user_profiles(phone_number);\n\n-- User roles indexes\nCREATE INDEX idx_user_roles_user_id ON user_roles(user_id);\nCREATE INDEX idx_user_roles_role_id ON user_roles(role_id);\n\n-- Audit log indexes\nCREATE INDEX idx_audit_log_user_id ON user_audit_log(user_id);\nCREATE INDEX idx_audit_log_created_at ON user_audit_log(created_at DESC);\nCREATE INDEX idx_audit_log_action ON user_audit_log(action);\nCREATE INDEX idx_audit_log_entity ON user_audit_log(entity_type, entity_id);\n\n-- Token indexes\nCREATE INDEX idx_password_reset_tokens_user_id ON password_reset_tokens(user_id);\nCREATE INDEX idx_password_reset_tokens_token ON password_reset_tokens(token) WHERE used_at IS NULL;\nCREATE INDEX idx_password_reset_tokens_expires ON password_reset_tokens(expires_at) WHERE used_at IS NULL;\nCREATE INDEX idx_email_verification_tokens_user_id ON email_verification_tokens(user_id);\nCREATE INDEX idx_email_verification_tokens_token ON email_verification_tokens(token) WHERE verified_at IS NULL;\n\n-- ============================================================================\n-- FUNCTIONS\n-- ============================================================================\n\nCREATE OR REPLACE FUNCTION update_updated_at_column()\nRETURNS TRIGGER AS $$\nBEGIN\n    NEW.updated_at = CURRENT_TIMESTAMP;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE OR REPLACE FUNCTION soft_delete_user(user_id_param UUID)\nRETURNS BOOLEAN AS $$\nBEGIN\n    UPDATE users\n    SET deleted_at = CURRENT_TIMESTAMP,\n        is_active = FALSE\n    WHERE id = user_id_param\n    AND deleted_at IS NULL;\n    RETURN FOUND;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE OR REPLACE FUNCTION clean_expired_tokens()\nRETURNS INTEGER AS $$\nDECLARE\n    deleted_count INTEGER;\nBEGIN\n    DELETE FROM password_reset_tokens\n    WHERE expires_at < CURRENT_TIMESTAMP\n    AND used_at IS NULL;\n    GET DIAGNOSTICS deleted_count = ROW_COUNT;\n    DELETE FROM email_verification_tokens\n    WHERE expires_at < CURRENT_TIMESTAMP\n    AND verified_at IS NULL;\n    RETURN deleted_count;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- ============================================================================\n-- TRIGGERS\n-- ============================================================================\n\nCREATE TRIGGER update_users_updated_at\n    BEFORE UPDATE ON users\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\nCREATE TRIGGER update_user_profiles_updated_at\n    BEFORE UPDATE ON user_profiles\n    FOR EACH ROW\n    EXECUTE FUNCTION update_updated_at_column();\n\n-- ============================================================================\n-- VIEWS\n-- ============================================================================\n\nCREATE OR REPLACE VIEW v_users_complete AS\nSELECT\n    u.id,\n    u.username,\n    u.email,\n    u.first_name,\n    u.last_name,\n    u.is_active,\n    u.is_verified,\n    u.created_at,\n    u.updated_at,\n    u.last_login_at,\n    p.bio,\n    p.phone_number,\n    p.date_of_birth,\n    p.avatar_url,\n    p.timezone,\n    p.locale,\n    ARRAY_AGG(DISTINCT r.name) FILTER (WHERE r.name IS NOT NULL) AS roles\nFROM users u\nLEFT JOIN user_profiles p ON u.id = p.user_id\nLEFT JOIN user_roles ur ON u.id = ur.user_id\nLEFT JOIN roles r ON ur.role_id = r.id\nWHERE u.deleted_at IS NULL\nGROUP BY u.id, p.user_id, p.bio, p.phone_number, p.date_of_birth,\n         p.avatar_url, p.timezone, p.locale;\n\nCREATE OR REPLACE VIEW v_active_users_summary AS\nSELECT\n    u.id,\n    u.username,\n    u.email,\n    u.first_name,\n    u.last_name,\n    u.is_verified,\n    u.last_login_at,\n    COUNT(DISTINCT ur.role_id) AS role_count\nFROM users u\nLEFT JOIN user_roles ur ON u.id = ur.user_id\nWHERE u.is_active = TRUE\nAND u.deleted_at IS NULL\nGROUP BY u.id;\n\n-- ============================================================================\n-- SEED DATA\n-- ============================================================================\n\nINSERT INTO roles (name, description) VALUES\n    ('admin', 'Full system access with all permissions'),\n    ('user', 'Standard user with basic permissions'),\n    ('moderator', 'Can moderate content and manage users'),\n    ('guest', 'Read-only access')\nON CONFLICT (name) DO NOTHING;\n\n-- ============================================================================\n-- COMMENTS\n-- ============================================================================\n\nCOMMENT ON TABLE users IS 'Core user accounts with authentication credentials';\nCOMMENT ON TABLE user_profiles IS 'Extended user profile information';\nCOMMENT ON TABLE roles IS 'System roles for access control';\nCOMMENT ON TABLE user_roles IS 'User-role assignments (many-to-many)';\nCOMMENT ON TABLE user_audit_log IS 'Audit trail for all user-related changes';\nCOMMENT ON COLUMN users.password_hash IS 'Hashed password using bcrypt or argon2';\nCOMMENT ON COLUMN users.deleted_at IS 'Soft delete timestamp (NULL = active)';\n\n-- ============================================================================\n-- RECORD MIGRATION\n-- ============================================================================\n\nINSERT INTO schema_migrations (version, description, execution_time_ms)\nVALUES ('001', 'Initial schema creation', NULL);\n\nCOMMIT;\n\n-- ============================================================================\n-- VERIFICATION\n-- ============================================================================\n\n-- Verify tables created\nDO $$\nDECLARE\n    table_count INTEGER;\nBEGIN\n    SELECT COUNT(*) INTO table_count\n    FROM information_schema.tables\n    WHERE table_schema = 'public'\n    AND table_name IN ('users', 'user_profiles', 'roles', 'user_roles',\n                       'user_audit_log', 'password_reset_tokens',\n                       'email_verification_tokens', 'schema_migrations');\n\n    IF table_count <> 8 THEN\n        RAISE EXCEPTION 'Migration verification failed: Expected 8 tables, found %', table_count;\n    END IF;\n\n    RAISE NOTICE 'Migration 001 completed successfully. Tables created: %', table_count;\nEND $$;\n",
              "test_workflow_output/requirements.txt": "# Sample requirements.txt for User Management REST API\n# Note: This is a template - actual dependencies will be defined by the development team\n\n# Web Framework\nfastapi==0.104.1\nuvicorn[standard]==0.24.0\n\n# Database\npsycopg2-binary==2.9.9\nsqlalchemy==2.0.23\nalembic==1.12.1\n\n# Cache\nredis==5.0.1\n\n# Authentication & Security\npython-jose[cryptography]==3.3.0\npasslib[bcrypt]==1.7.4\npython-multipart==0.0.6\n\n# Validation\npydantic==2.5.0\nemail-validator==2.1.0\n\n# Utilities\npython-dotenv==1.0.0\npydantic-settings==2.1.0\n\n# Testing\npytest==7.4.3\npytest-asyncio==0.21.1\npytest-cov==4.1.0\nhttpx==0.25.2\n\n# Code Quality\nblack==23.11.0\nflake8==6.1.0\npylint==3.0.3\nmypy==1.7.1\nbandit==1.7.5\n\n# Monitoring\nprometheus-client==0.19.0\n"
            },
            "summary": "Phase: requirements\nStatus: True\nArtifacts: 7 key files\n\nrequirements_document.md:\n# Requirements Document\n## User Management REST API\n\n**Project ID:** workflow-20251012-125804\n**Phase:** Requirements Analysis\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Requirements Analyst\n\n---\n\n## 1. Executive Summary\n\nThis document outlines the functional and non-functional requirements for a user management REST API system. The API will provide standard CRUD (Create, Read, Update, Delete) operations for managing user data in a scalable and secure manner.\n\n---\n\n## 2. Pro\n\n\ndatabase_schema.md:\n# Database Schema Design - User Management API\n\n## Project Information\n**Workflow ID:** workflow-20251012-130125\n**Phase:** Requirements\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Backend Developer\n\n---\n\n## 1. Schema Overview\n\nThis document defines the database schema for the User Management REST API. The schema is designed for a relational database (PostgreSQL recommended) with emphasis on data integrity, performance, and security.\n\n### Design Principles\n- **Normalization:*\n\n\nbackend_architecture.md:\n# Backend Architecture & Implementation Guide - User Management API\n\n## Project Information\n**Workflow ID:** workflow-20251012-130125\n**Phase:** Requirements\n**Document Version:** 1.0\n**Date:** 2025-10-12\n**Prepared by:** Backend Developer\n\n---\n\n## 1. Architecture Overview\n\n### 1.1 System Architecture\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Client Layer                             \u2502\n\u2502  (Web Apps, Mobile Apps, Third-party Integrations)   \n\n\ndatabase_schema.sql:\n-- ============================================================================\n-- User Management API - Database Schema\n-- ============================================================================\n-- Version: 1.0.0\n-- Database: PostgreSQL 14+\n-- Purpose: Core schema for user management REST API with CRUD operations\n-- ============================================================================\n\n-- Enable required extensions\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\nCREATE EXTENSION IF NOT \n\n\ndata_model.md:\n# Data Model Documentation\n## User Management REST API\n\n**Version:** 1.0.0\n**Database:** PostgreSQL 14+\n**Created:** 2025-10-12\n**Author:** Database Specialist\n\n---\n\n## Table of Contents\n1. [Overview](#overview)\n2. [Entity Relationship Diagram](#entity-relationship-diagram)\n3. [Data Entities](#data-entities)\n4. [Relationships](#relationships)\n5. [Data Types and Constraints](#data-types-and-constraints)\n6. [Indexing Strategy](#indexing-strategy)\n7. [Security Considerations](#security-consideratio\n\n\n001_initial_schema.sql:\n-- ============================================================================\n-- Migration: 001_initial_schema\n-- Description: Initial database schema for User Management API\n-- Author: Database Specialist\n-- Created: 2025-10-12\n-- ============================================================================\n\n-- Migration metadata\n-- Version: 001\n-- Requires: PostgreSQL 14+\n-- Estimated time: < 1 second (empty database)\n\nBEGIN;\n\n-- ===============================================================\n\n\nrequirements.txt:\n# Sample requirements.txt for User Management REST API\n# Note: This is a template - actual dependencies will be defined by the development team\n\n# Web Framework\nfastapi==0.104.1\nuvicorn[standard]==0.24.0\n\n# Database\npsycopg2-binary==2.9.9\nsqlalchemy==2.0.23\nalembic==1.12.1\n\n# Cache\nredis==5.0.1\n\n# Authentication & Security\npython-jose[cryptography]==3.3.0\npasslib[bcrypt]==1.7.4\npython-multipart==0.0.6\n\n# Validation\npydantic==2.5.0\nemail-validator==2.1.0\n\n# Utilities\npython-dotenv==1.0.0\npydantic\n",
            "deliverables": {
              "requirement_analyst": {
                "files_created": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md"
                ],
                "deliverables": {
                  "documentation": [
                    "test_workflow_output/requirements_document.md",
                    "test_workflow_output/user_stories.md",
                    "test_workflow_output/acceptance_criteria.md"
                  ]
                },
                "contract_fulfilled": false,
                "quality_score": null
              },
              "backend_developer": {
                "files_created": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md"
                ],
                "deliverables": {
                  "documentation": [
                    "test_workflow_output/requirements_document.md",
                    "test_workflow_output/user_stories.md",
                    "test_workflow_output/acceptance_criteria.md",
                    "test_workflow_output/database_schema.md",
                    "test_workflow_output/api_endpoints.md",
                    "test_workflow_output/backend_architecture.md",
                    "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md"
                  ]
                },
                "contract_fulfilled": false,
                "quality_score": null
              },
              "database_specialist": {
                "files_created": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                  "test_workflow_output/database_schema.sql",
                  "test_workflow_output/data_model.md",
                  "test_workflow_output/query_optimization.md",
                  "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                  "test_workflow_output/README.md",
                  "test_workflow_output/migration_scripts/001_initial_schema.sql",
                  "test_workflow_output/migration_scripts/rollback_001.sql",
                  "test_workflow_output/migration_scripts/README.md",
                  "test_workflow_output/migration_scripts/seed_data.sql"
                ],
                "deliverables": {
                  "documentation": [
                    "test_workflow_output/requirements_document.md",
                    "test_workflow_output/user_stories.md",
                    "test_workflow_output/acceptance_criteria.md",
                    "test_workflow_output/database_schema.md",
                    "test_workflow_output/api_endpoints.md",
                    "test_workflow_output/backend_architecture.md",
                    "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                    "test_workflow_output/data_model.md",
                    "test_workflow_output/query_optimization.md",
                    "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                    "test_workflow_output/README.md",
                    "test_workflow_output/migration_scripts/README.md"
                  ],
                  "other": [
                    "test_workflow_output/database_schema.sql",
                    "test_workflow_output/migration_scripts/001_initial_schema.sql",
                    "test_workflow_output/migration_scripts/rollback_001.sql",
                    "test_workflow_output/migration_scripts/seed_data.sql"
                  ]
                },
                "contract_fulfilled": false,
                "quality_score": null
              },
              "technical_writer": {
                "files_created": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                  "test_workflow_output/database_schema.sql",
                  "test_workflow_output/data_model.md",
                  "test_workflow_output/query_optimization.md",
                  "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                  "test_workflow_output/README.md",
                  "test_workflow_output/api_documentation.md",
                  "test_workflow_output/user_guide.md",
                  "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                  "test_workflow_output/migration_scripts/001_initial_schema.sql",
                  "test_workflow_output/migration_scripts/rollback_001.sql",
                  "test_workflow_output/migration_scripts/README.md",
                  "test_workflow_output/migration_scripts/seed_data.sql"
                ],
                "deliverables": {
                  "documentation": [
                    "test_workflow_output/requirements_document.md",
                    "test_workflow_output/user_stories.md",
                    "test_workflow_output/acceptance_criteria.md",
                    "test_workflow_output/database_schema.md",
                    "test_workflow_output/api_endpoints.md",
                    "test_workflow_output/backend_architecture.md",
                    "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                    "test_workflow_output/data_model.md",
                    "test_workflow_output/query_optimization.md",
                    "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                    "test_workflow_output/README.md",
                    "test_workflow_output/api_documentation.md",
                    "test_workflow_output/user_guide.md",
                    "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                    "test_workflow_output/migration_scripts/README.md"
                  ],
                  "other": [
                    "test_workflow_output/database_schema.sql",
                    "test_workflow_output/migration_scripts/001_initial_schema.sql",
                    "test_workflow_output/migration_scripts/rollback_001.sql",
                    "test_workflow_output/migration_scripts/seed_data.sql"
                  ]
                },
                "contract_fulfilled": false,
                "quality_score": null
              },
              "qa_engineer": {
                "files_created": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                  "test_workflow_output/database_schema.sql",
                  "test_workflow_output/data_model.md",
                  "test_workflow_output/query_optimization.md",
                  "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                  "test_workflow_output/README.md",
                  "test_workflow_output/api_documentation.md",
                  "test_workflow_output/user_guide.md",
                  "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                  "test_workflow_output/test_plan.md",
                  "test_workflow_output/test_cases.md",
                  "test_workflow_output/bug_reports.md",
                  "test_workflow_output/test_results.md",
                  "test_workflow_output/migration_scripts/001_initial_schema.sql",
                  "test_workflow_output/migration_scripts/rollback_001.sql",
                  "test_workflow_output/migration_scripts/README.md",
                  "test_workflow_output/migration_scripts/seed_data.sql"
                ],
                "deliverables": {
                  "documentation": [
                    "test_workflow_output/requirements_document.md",
                    "test_workflow_output/user_stories.md",
                    "test_workflow_output/acceptance_criteria.md",
                    "test_workflow_output/database_schema.md",
                    "test_workflow_output/api_endpoints.md",
                    "test_workflow_output/backend_architecture.md",
                    "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                    "test_workflow_output/data_model.md",
                    "test_workflow_output/query_optimization.md",
                    "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                    "test_workflow_output/README.md",
                    "test_workflow_output/api_documentation.md",
                    "test_workflow_output/user_guide.md",
                    "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                    "test_workflow_output/test_plan.md",
                    "test_workflow_output/test_cases.md",
                    "test_workflow_output/bug_reports.md",
                    "test_workflow_output/test_results.md",
                    "test_workflow_output/migration_scripts/README.md"
                  ],
                  "other": [
                    "test_workflow_output/database_schema.sql",
                    "test_workflow_output/migration_scripts/001_initial_schema.sql",
                    "test_workflow_output/migration_scripts/rollback_001.sql",
                    "test_workflow_output/migration_scripts/seed_data.sql"
                  ]
                },
                "contract_fulfilled": false,
                "quality_score": null
              },
              "devops_engineer": {
                "files_created": [
                  "test_workflow_output/requirements_document.md",
                  "test_workflow_output/user_stories.md",
                  "test_workflow_output/acceptance_criteria.md",
                  "test_workflow_output/database_schema.md",
                  "test_workflow_output/api_endpoints.md",
                  "test_workflow_output/backend_architecture.md",
                  "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                  "test_workflow_output/database_schema.sql",
                  "test_workflow_output/data_model.md",
                  "test_workflow_output/query_optimization.md",
                  "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                  "test_workflow_output/README.md",
                  "test_workflow_output/api_documentation.md",
                  "test_workflow_output/user_guide.md",
                  "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                  "test_workflow_output/test_plan.md",
                  "test_workflow_output/test_cases.md",
                  "test_workflow_output/bug_reports.md",
                  "test_workflow_output/test_results.md",
                  "test_workflow_output/Dockerfile",
                  "test_workflow_output/docker-compose.yml",
                  "test_workflow_output/DEVOPS_DOCUMENTATION.md",
                  "test_workflow_output/requirements.txt",
                  "test_workflow_output/.dockerignore",
                  "test_workflow_output/.env.example",
                  "test_workflow_output/DEVOPS_README.md",
                  "test_workflow_output/DEVOPS_DELIVERABLES_SUMMARY.md",
                  "test_workflow_output/migration_scripts/001_initial_schema.sql",
                  "test_workflow_output/migration_scripts/rollback_001.sql",
                  "test_workflow_output/migration_scripts/README.md",
                  "test_workflow_output/migration_scripts/seed_data.sql",
                  "test_workflow_output/k8s/namespace.yaml",
                  "test_workflow_output/k8s/configmap.yaml",
                  "test_workflow_output/k8s/secrets.yaml",
                  "test_workflow_output/k8s/postgres-deployment.yaml",
                  "test_workflow_output/k8s/redis-deployment.yaml",
                  "test_workflow_output/k8s/api-deployment.yaml",
                  "test_workflow_output/k8s/ingress.yaml",
                  "test_workflow_output/k8s/hpa.yaml",
                  "test_workflow_output/k8s/network-policy.yaml",
                  "test_workflow_output/.github/workflows/ci-cd.yml",
                  "test_workflow_output/terraform/main.tf",
                  "test_workflow_output/terraform/variables.tf",
                  "test_workflow_output/terraform/outputs.tf",
                  "test_workflow_output/scripts/deploy.sh",
                  "test_workflow_output/scripts/rollback.sh",
                  "test_workflow_output/scripts/monitor.sh",
                  "test_workflow_output/scripts/backup-db.sh"
                ],
                "deliverables": {
                  "documentation": [
                    "test_workflow_output/requirements_document.md",
                    "test_workflow_output/user_stories.md",
                    "test_workflow_output/acceptance_criteria.md",
                    "test_workflow_output/database_schema.md",
                    "test_workflow_output/api_endpoints.md",
                    "test_workflow_output/backend_architecture.md",
                    "test_workflow_output/BACKEND_DEVELOPER_DELIVERABLES.md",
                    "test_workflow_output/data_model.md",
                    "test_workflow_output/query_optimization.md",
                    "test_workflow_output/DATABASE_SPECIALIST_DELIVERABLES.md",
                    "test_workflow_output/README.md",
                    "test_workflow_output/api_documentation.md",
                    "test_workflow_output/user_guide.md",
                    "test_workflow_output/TECHNICAL_WRITER_DELIVERABLES.md",
                    "test_workflow_output/test_plan.md",
                    "test_workflow_output/test_cases.md",
                    "test_workflow_output/bug_reports.md",
                    "test_workflow_output/test_results.md",
                    "test_workflow_output/DEVOPS_DOCUMENTATION.md",
                    "test_workflow_output/requirements.txt",
                    "test_workflow_output/DEVOPS_README.md",
                    "test_workflow_output/DEVOPS_DELIVERABLES_SUMMARY.md",
                    "test_workflow_output/migration_scripts/README.md"
                  ],
                  "configuration": [
                    "test_workflow_output/docker-compose.yml",
                    "test_workflow_output/k8s/namespace.yaml",
                    "test_workflow_output/k8s/configmap.yaml",
                    "test_workflow_output/k8s/secrets.yaml",
                    "test_workflow_output/k8s/postgres-deployment.yaml",
                    "test_workflow_output/k8s/redis-deployment.yaml",
                    "test_workflow_output/k8s/api-deployment.yaml",
                    "test_workflow_output/k8s/ingress.yaml",
                    "test_workflow_output/k8s/hpa.yaml",
                    "test_workflow_output/k8s/network-policy.yaml",
                    "test_workflow_output/.github/workflows/ci-cd.yml"
                  ],
                  "other": [
                    "test_workflow_output/database_schema.sql",
                    "test_workflow_output/Dockerfile",
                    "test_workflow_output/.dockerignore",
                    "test_workflow_output/.env.example",
                    "test_workflow_output/migration_scripts/001_initial_schema.sql",
                    "test_workflow_output/migration_scripts/rollback_001.sql",
                    "test_workflow_output/migration_scripts/seed_data.sql",
                    "test_workflow_output/terraform/main.tf",
                    "test_workflow_output/terraform/variables.tf",
                    "test_workflow_output/terraform/outputs.tf",
                    "test_workflow_output/scripts/deploy.sh",
                    "test_workflow_output/scripts/rollback.sh",
                    "test_workflow_output/scripts/monitor.sh",
                    "test_workflow_output/scripts/backup-db.sh"
                  ]
                },
                "contract_fulfilled": false,
                "quality_score": null
              }
            },
            "quality": {
              "overall_quality_score": 0.0,
              "quality_by_persona": {
                "requirement_analyst": 0.0,
                "backend_developer": 0.0,
                "database_specialist": 0.0,
                "technical_writer": 0.0,
                "qa_engineer": 0.0,
                "devops_engineer": 0.0
              },
              "contracts_fulfilled": 0,
              "contracts_total": 6,
              "integration_issues": 6
            },
            "execution_summary": {
              "personas": [
                "requirement_analyst",
                "backend_developer",
                "database_specialist",
                "technical_writer",
                "qa_engineer",
                "devops_engineer"
              ],
              "blueprint": "Basic Parallel Team",
              "duration": 2372.447907
            }
          }
        },
        "contracts_validated": [],
        "validation_results": [],
        "artifacts_created": [
          "requirement_analyst",
          "backend_developer",
          "database_specialist",
          "technical_writer",
          "qa_engineer",
          "devops_engineer"
        ],
        "artifacts_consumed": [],
        "started_at": "2025-10-12T13:01:25.849203",
        "completed_at": "2025-10-12T13:41:12.263147",
        "duration_seconds": 2372.447907,
        "agent_assignments": {},
        "error_message": null,
        "error_details": null
      }
    },
    "phase_order": [
      "requirements"
    ],
    "current_phase": "requirements",
    "shared_artifacts": [
      {
        "name": "requirement_analyst",
        "created_by_phase": "requirements",
        "created_at": "2025-10-12T13:41:12.263147"
      },
      {
        "name": "backend_developer",
        "created_by_phase": "requirements",
        "created_at": "2025-10-12T13:41:12.263147"
      },
      {
        "name": "database_specialist",
        "created_by_phase": "requirements",
        "created_at": "2025-10-12T13:41:12.263147"
      },
      {
        "name": "technical_writer",
        "created_by_phase": "requirements",
        "created_at": "2025-10-12T13:41:12.263147"
      },
      {
        "name": "qa_engineer",
        "created_by_phase": "requirements",
        "created_at": "2025-10-12T13:41:12.263147"
      },
      {
        "name": "devops_engineer",
        "created_by_phase": "requirements",
        "created_at": "2025-10-12T13:41:12.263147"
      }
    ],
    "shared_context": {},
    "contracts_validated": [],
    "metadata": {
      "initial_requirement": "Build a simple REST API for user management with CRUD operations"
    },
    "started_at": "2025-10-12T13:01:25.849248",
    "completed_at": null,
    "checkpoint_path": null,
    "last_checkpoint_at": null,
    "human_edits": {},
    "execution_mode": "phased",
    "awaiting_human_review": false
  },
  "team_execution_state": {
    "classification": {
      "requirement_type": "feature_development",
      "complexity": "simple",
      "parallelizability": "partially_parallel",
      "required_expertise": [
        "REST API design",
        "backend development",
        "database modeling",
        "HTTP methods",
        "JSON serialization",
        "authentication/authorization basics"
      ],
      "estimated_effort_hours": 8.0,
      "dependencies": [
        "database system",
        "web framework selection",
        "programming language/runtime",
        "development environment"
      ],
      "risks": [
        "unclear authentication requirements",
        "no specification on data validation rules",
        "missing error handling requirements",
        "undefined scalability needs",
        "no mention of API versioning strategy"
      ],
      "rationale": "This is a straightforward feature_development task with simple complexity. A basic user management REST API with CRUD operations is a well-understood pattern. Parallelizability is partially_parallel (60-70%) because: (1) API contract/schema design must happen first, (2) once contract is defined, implementation of different endpoints (GET, POST, PUT, DELETE) can proceed in parallel, (3) database schema and API layer can be developed somewhat independently with clear interface, (4) documentation and basic tests can be written in parallel with implementation using the contract. However, integration testing and end-to-end flows require sequential completion. Estimated 8 hours includes: API design (1h), database schema (1h), endpoint implementation (4h), basic testing (1.5h), documentation (0.5h). Main risks stem from underspecified requirements around security, validation, and edge cases.",
      "confidence_score": 0.85
    },
    "blueprint_selections": {
      "requirements": {
        "blueprint_id": "parallel-basic",
        "blueprint_name": "Basic Parallel Team",
        "match_score": 0.85,
        "personas": [
          "requirement_analyst",
          "backend_developer",
          "database_specialist",
          "qa_engineer",
          "devops_engineer"
        ],
        "rationale": "Blueprint 'Basic Parallel Team' matches partially_parallel work pattern",
        "execution_mode": "parallel",
        "coordination_mode": "broadcast",
        "scaling_strategy": "static",
        "estimated_time_savings": 0.4
      }
    },
    "contract_specs": [],
    "persona_results": {},
    "quality_metrics": {
      "requirements": {
        "overall_quality": 0.0,
        "contract_fulfillment": 0.0,
        "completeness": 0.0
      }
    },
    "timing_metrics": {
      "requirements": {
        "phase_duration": 2372.447907,
        "ai_analysis_time": 0.0,
        "blueprint_selection_time": 0.0,
        "contract_design_time": 0.0,
        "persona_execution_time": 2358.353283
      }
    },
    "template_package_id": null,
    "template_package_name": null,
    "template_package_confidence": 0.0,
    "template_package_explanation": "",
    "recommended_templates": {},
    "templates_used": {},
    "template_selection_reasoning": {},
    "custom_development_reasons": {}
  }
}