apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: sunday-production

resources:
- ../base/namespace.yaml
- ../base/configmap.yaml
- ../base/secret.yaml
- ../base/backend-deployment.yaml
- ../base/frontend-deployment.yaml
- ../base/postgres-deployment.yaml
- ../base/redis-deployment.yaml
- ../base/ingress.yaml
- elasticsearch-deployment.yaml
- clickhouse-deployment.yaml
- backup-cronjob.yaml

patchesStrategicMerge:
- production-patches.yaml

replicas:
- name: backend-deployment
  count: 5
- name: frontend-deployment
  count: 3
- name: postgres-statefulset
  count: 1
- name: redis-statefulset
  count: 1

images:
- name: ghcr.io/sunday-com/sunday/backend
  newTag: IMAGE_TAG
- name: ghcr.io/sunday-com/sunday/frontend
  newTag: IMAGE_TAG

configMapGenerator:
- name: production-config
  literals:
  - NODE_ENV=production
  - LOG_LEVEL=warn
  - RATE_LIMIT_MAX=1000

secretGenerator:
- name: production-secrets
  envs:
  - .env.production