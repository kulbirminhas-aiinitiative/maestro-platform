apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: sunday-staging

resources:
- ../base/namespace.yaml
- ../base/configmap.yaml
- ../base/secret.yaml
- ../base/backend-deployment.yaml
- ../base/frontend-deployment.yaml
- ../base/postgres-deployment.yaml
- ../base/redis-deployment.yaml
- ../base/ingress.yaml

patchesStrategicMerge:
- staging-patches.yaml

replicas:
- name: backend-deployment
  count: 2
- name: frontend-deployment
  count: 1
- name: postgres-statefulset
  count: 1
- name: redis-statefulset
  count: 1

images:
- name: ghcr.io/sunday-com/sunday/backend
  newTag: main
- name: ghcr.io/sunday-com/sunday/frontend
  newTag: main

configMapGenerator:
- name: staging-config
  literals:
  - NODE_ENV=staging
  - LOG_LEVEL=debug
  - RATE_LIMIT_MAX=500

secretGenerator:
- name: staging-secrets
  envs:
  - .env.staging