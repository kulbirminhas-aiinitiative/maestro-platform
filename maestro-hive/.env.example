# =============================================================================
# Maestro DAG Workflow Platform - Environment Configuration
# =============================================================================
# Copy this file to .env and update with your actual credentials
# DO NOT commit .env file to version control!
# =============================================================================

# -----------------------------------------------------------------------------
# PostgreSQL Database Configuration
# -----------------------------------------------------------------------------
# Primary database for workflow persistence, execution tracking, and state management

POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=maestro_workflows
POSTGRES_USER=maestro
POSTGRES_PASSWORD=maestro_dev

# Database connection pool settings (optional, defaults shown)
DB_POOL_SIZE=10
DB_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# SQLite fallback (for development only - NOT recommended for production)
USE_SQLITE=false
SQLITE_PATH=maestro_workflows.db

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
# Used for state management, caching, and real-time coordination

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
# REDIS_PASSWORD=          # Uncomment if Redis requires authentication

# Redis connection settings
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=5
REDIS_SOCKET_CONNECT_TIMEOUT=5

# Use mock Redis for testing (NOT for production)
USE_MOCK_REDIS=false

# -----------------------------------------------------------------------------
# DAG API Server Configuration
# -----------------------------------------------------------------------------
# REST API and WebSocket server for workflow management

DAG_API_HOST=0.0.0.0
DAG_API_PORT=5001
DAG_API_LOG_LEVEL=info

# CORS settings (adjust for production)
CORS_ALLOW_ORIGINS=*
CORS_ALLOW_CREDENTIALS=false

# -----------------------------------------------------------------------------
# Workflow Execution Configuration
# -----------------------------------------------------------------------------

# Timeout for individual persona/AI execution (seconds)
# Increased to 3600s (60 min) for production-quality AI work
PERSONA_EXECUTION_TIMEOUT=3600

# Timeout for entire workflow execution (seconds)
WORKFLOW_EXECUTION_TIMEOUT=7200

# Maximum retry attempts for failed nodes
MAX_NODE_RETRIES=3

# Circuit breaker settings
CIRCUIT_BREAKER_FAILURE_THRESHOLD=3
CIRCUIT_BREAKER_TIMEOUT=300

# -----------------------------------------------------------------------------
# ContractManager Configuration
# -----------------------------------------------------------------------------

# Enable contract validation at phase boundaries
ENABLE_CONTRACTS=true

# Contract validation mode: strict, permissive, disabled
CONTRACT_VALIDATION_MODE=permissive

# Artifact validation at phase boundaries
ENABLE_ARTIFACT_VALIDATION=true

# -----------------------------------------------------------------------------
# Claude CLI Configuration
# -----------------------------------------------------------------------------
# Used for AI persona execution

CLAUDE_CLI_PATH=claude
CLAUDE_CLI_TIMEOUT=3600

# Tools allowed for AI personas (comma-separated)
CLAUDE_ALLOWED_TOOLS=Write,Edit,Read,Bash

# Auto-accept tool permissions (for automation)
CLAUDE_SKIP_PERMISSIONS=true

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

LOG_LEVEL=INFO
LOG_FORMAT=%(asctime)s - %(name)s - %(levelname)s - %(message)s

# Log file paths (optional)
# LOG_FILE_PATH=logs/maestro.log
# ERROR_LOG_PATH=logs/maestro_errors.log

# -----------------------------------------------------------------------------
# WebSocket Configuration
# -----------------------------------------------------------------------------

# Maximum connections per workflow
WS_MAX_CONNECTIONS_PER_WORKFLOW=100

# Maximum total WebSocket connections
WS_MAX_TOTAL_CONNECTIONS=1000

# WebSocket ping interval (seconds)
WS_PING_INTERVAL=30

# -----------------------------------------------------------------------------
# Development & Testing
# -----------------------------------------------------------------------------

# Environment mode
ENVIRONMENT=development    # Options: development, staging, production

# Enable debug mode
DEBUG=false

# Mock external services for testing
MOCK_EXTERNAL_SERVICES=false

# -----------------------------------------------------------------------------
# Security (Production Settings)
# -----------------------------------------------------------------------------

# Secret key for session management (generate with: openssl rand -hex 32)
# SECRET_KEY=your-secret-key-here

# API authentication (if enabled)
# API_KEY=your-api-key-here
# JWT_SECRET=your-jwt-secret-here

# TLS/SSL settings (production)
# SSL_CERT_PATH=/path/to/cert.pem
# SSL_KEY_PATH=/path/to/key.pem

# =============================================================================
# NOTES:
# =============================================================================
# 1. PostgreSQL Setup:
#    - Create user: sudo -u postgres psql -c "CREATE USER maestro WITH PASSWORD 'maestro_dev' CREATEDB;"
#    - Create database: sudo -u postgres psql -c "CREATE DATABASE maestro_workflows OWNER maestro;"
#    - Grant privileges: sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE maestro_workflows TO maestro;"
#
# 2. Redis Setup:
#    - Install: sudo yum install redis (Amazon Linux) or apt-get install redis (Ubuntu)
#    - Start: sudo systemctl start redis
#    - Enable: sudo systemctl enable redis
#    - Test: redis-cli ping (should return PONG)
#
# 3. For production deployment:
#    - Use strong passwords (not defaults shown here)
#    - Enable SSL/TLS for database connections
#    - Set up proper authentication for Redis
#    - Use environment-specific .env files (.env.production, .env.staging)
#    - Never commit .env files to version control
#
# 4. Database connection string format:
#    postgresql://username:password@host:port/database
#    Example: postgresql://maestro:maestro_dev@localhost:5432/maestro_workflows
# =============================================================================
