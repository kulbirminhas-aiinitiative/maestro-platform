# Quality Fabric Configuration
# Defines the quality strategy and integration settings for Maestro

quality_fabric:
  # Connection settings
  url: http://localhost:8000
  timeout: 30  # seconds
  retry_attempts: 3
  retry_delay: 5  # seconds

  # Authentication (if required)
  auth:
    enabled: false
    type: bearer  # bearer, basic, api_key
    # token is read from QUALITY_FABRIC_TOKEN env var

# Test Strategy Configuration
test_strategy:
  # Unit Testing
  unit:
    enabled: true
    framework: pytest
    coverage_threshold: 80  # minimum coverage percentage
    fail_on_coverage_drop: true
    timeout: 300  # seconds per test file
    parallelism: auto  # auto, or number of workers
    markers:
      - unit
      - fast
    exclude_patterns:
      - "**/test_integration_*"
      - "**/test_e2e_*"

  # Integration Testing
  integration:
    enabled: true
    framework: pytest
    timeout: 600  # seconds
    parallelism: 2
    markers:
      - integration
      - slow
    requires:
      - quality-fabric
      - database
    environment:
      TEST_ENV: integration
      USE_MOCKS: "false"

  # End-to-End Testing
  e2e:
    enabled: true
    framework: playwright
    headless: true
    timeout: 900  # seconds
    browser: chromium  # chromium, firefox, webkit
    base_url: http://localhost:3000
    markers:
      - e2e
    artifacts:
      screenshots: on-failure
      videos: retain-on-failure
      traces: retain-on-failure

  # Contract Testing
  contract:
    enabled: true
    framework: pact
    provider_url: http://localhost:8000
    consumer_name: maestro-hive
    broker_url: null  # set if using Pact Broker

  # Performance Testing
  performance:
    enabled: false
    framework: locust
    target_url: http://localhost:8000
    users: 10
    spawn_rate: 2
    run_time: 60  # seconds
    thresholds:
      p95_response_time: 500  # ms
      error_rate: 0.01  # 1%

# Quality Gates Configuration
quality_gates:
  # Pre-commit gates
  pre_commit:
    - name: lint
      command: "ruff check ."
      fail_on_error: true

    - name: format_check
      command: "black --check ."
      fail_on_error: false

    - name: type_check
      command: "mypy src/"
      fail_on_error: false

  # Pre-merge gates (CI)
  pre_merge:
    - name: unit_tests
      type: test
      test_type: unit
      required: true
      coverage_delta: -2  # allow 2% coverage drop

    - name: integration_tests
      type: test
      test_type: integration
      required: true

    - name: security_scan
      type: security
      tool: bandit
      severity: medium
      fail_on_findings: true

  # Pre-deploy gates
  pre_deploy:
    - name: e2e_tests
      type: test
      test_type: e2e
      required: true

    - name: performance_baseline
      type: performance
      required: false
      thresholds:
        latency_p99: 1000
        throughput: 100

# Coverage Configuration
coverage:
  enabled: true
  tool: coverage.py
  report_formats:
    - json
    - html
    - xml
  thresholds:
    line: 80
    branch: 70
    function: 85
  exclude_patterns:
    - "*/tests/*"
    - "*/__init__.py"
    - "*/migrations/*"
  fail_under: 75

# Reporting Configuration
reporting:
  enabled: true
  formats:
    - junit_xml
    - json
  output_dir: ./test-results
  upload:
    enabled: false
    endpoint: null

# SDLC Phase Integration
sdlc:
  phases:
    development:
      required_gates:
        - lint
        - unit_tests
      optional_gates:
        - type_check

    review:
      required_gates:
        - unit_tests
        - integration_tests
        - security_scan
      optional_gates:
        - contract_tests

    staging:
      required_gates:
        - unit_tests
        - integration_tests
        - e2e_tests
      optional_gates:
        - performance_baseline

    production:
      required_gates:
        - all_tests_pass
        - security_clear
        - coverage_met
      optional_gates:
        - performance_verified

# Persona Validation
persona_validation:
  enabled: true
  personas:
    qa_engineer:
      required_artifacts:
        - test_plan
        - test_cases
        - coverage_report
      gates:
        - coverage >= 80%
        - no_critical_bugs

    developer:
      required_artifacts:
        - code
        - unit_tests
      gates:
        - lint_pass
        - tests_pass

    security_engineer:
      required_artifacts:
        - security_scan_report
        - vulnerability_assessment
      gates:
        - no_high_vulnerabilities
        - dependency_audit_pass

# Notifications
notifications:
  enabled: false
  channels:
    slack:
      webhook_url: null
      on_failure: true
      on_success: false

    email:
      enabled: false
      recipients: []
      on_failure: true

# Logging
logging:
  level: INFO
  format: "%(asctime)s [%(levelname)s] %(name)s: %(message)s"
  file: ./logs/quality-fabric.log
  max_size: 10MB
  backup_count: 5
